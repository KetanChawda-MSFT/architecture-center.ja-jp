---
title: Active Directory Domain Services (AD DS) を Azure に拡張する
description: >-
  Active Directory の承認を使用するセキュリティ保護されたハイブリッド ネットワーク アーキテクチャを Azure に実装する方法。

  ガイダンス,vpn gateway,expressroute,ロード バランサー,仮想ネットワーク,active directory
author: telmosampaio
ms.date: 11/28/2016
pnp.series.title: Identity management
pnp.series.prev: azure-ad
pnp.series.next: adds-forest
ms.openlocfilehash: 007d244f29bf11c6e2bd703c7f4f245d22c02f0f
ms.sourcegitcommit: c441fd165e6bebbbbbc19854ec6f3676be9c3b25
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/30/2018
---
# <a name="extend-active-directory-domain-services-ad-ds-to-azure"></a><span data-ttu-id="061a5-104">Active Directory Domain Services (AD DS) を Azure に拡張する</span><span class="sxs-lookup"><span data-stu-id="061a5-104">Extend Active Directory Domain Services (AD DS) to Azure</span></span>

<span data-ttu-id="061a5-105">この参照アーキテクチャでは、Active Directory 環境を Azure に拡張し、[Active Directory Domain Services (AD DS)][active-directory-domain-services] を使用して分散認証サービスを提供する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="061a5-105">This reference architecture shows how to extend your Active Directory environment to Azure to provide distributed authentication services using [Active Directory Domain Services (AD DS)][active-directory-domain-services].</span></span>  [<span data-ttu-id="061a5-106">**こちらのソリューションをデプロイしてください**。</span><span class="sxs-lookup"><span data-stu-id="061a5-106">**Deploy this solution**.</span></span>](#deploy-the-solution)

<span data-ttu-id="061a5-107">[![0]][0]</span><span class="sxs-lookup"><span data-stu-id="061a5-107">[![0]][0]</span></span> 

<span data-ttu-id="061a5-108">"*このアーキテクチャの [Visio ファイル][visio-download]をダウンロードします。*"</span><span class="sxs-lookup"><span data-stu-id="061a5-108">*Download a [Visio file][visio-download] of this architecture.*</span></span>

<span data-ttu-id="061a5-109">AD DS は、ユーザー、コンピューター、アプリケーション、またはセキュリティ ドメインに含まれるその他の ID の認証に使用します。</span><span class="sxs-lookup"><span data-stu-id="061a5-109">AD DS is used to authenticate user, computer, application, or other identities that are included in a security domain.</span></span> <span data-ttu-id="061a5-110">オンプレミスでホストできますが、アプリケーションがオンプレミスと Azure で部分的にホストされる場合は、Azure でこの機能をレプリケートする方が効率的です。</span><span class="sxs-lookup"><span data-stu-id="061a5-110">It can be hosted on-premises, but if your application is hosted partly on-premises and partly in Azure, it may be more efficient to replicate this functionality in Azure.</span></span> <span data-ttu-id="061a5-111">これにより、クラウドからオンプレミスで実行されている AD DS に返される認証要求とローカルの承認要求の送信が原因の待機時間を削減できます。</span><span class="sxs-lookup"><span data-stu-id="061a5-111">This can reduce the latency caused by sending authentication and local authorization requests from the cloud back to AD DS running on-premises.</span></span> 

<span data-ttu-id="061a5-112">このアーキテクチャは、オンプレミス ネットワークと Azure 仮想ネットワークが VPN または ExpressRoute によって接続されている場合によく使用されます。</span><span class="sxs-lookup"><span data-stu-id="061a5-112">This architecture is commonly used when the on-premises network and the Azure virtual network are connected by a VPN or ExpressRoute connection.</span></span> <span data-ttu-id="061a5-113">また、このアーキテクチャは、双方向レプリケーションをサポートします。つまり、オンプレミスまたはクラウドで変更を行うことができ、両方のソースの一貫性が確保されます。</span><span class="sxs-lookup"><span data-stu-id="061a5-113">This architecture also supports bidirectional replication, meaning changes can be made either on-premises or in the cloud, and both sources will be kept consistent.</span></span> <span data-ttu-id="061a5-114">このアーキテクチャの一般的な用途には、オンプレミスと Azure 間で機能が配布されるハイブリッド アプリケーション、および Active Directory を使用して認証を実行するアプリケーションとサービスがあります。</span><span class="sxs-lookup"><span data-stu-id="061a5-114">Typical uses for this architecture include hybrid applications in which functionality is distributed between on-premises and Azure, and applications and services that perform authentication using Active Directory.</span></span>

<span data-ttu-id="061a5-115">その他の考慮事項については、「[オンプレミスの Active Directory を Azure と統合するためのソリューションの選択][considerations]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="061a5-115">For additional considerations, see [Choose a solution for integrating on-premises Active Directory with Azure][considerations].</span></span> 

## <a name="architecture"></a><span data-ttu-id="061a5-116">アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="061a5-116">Architecture</span></span> 

<span data-ttu-id="061a5-117">このアーキテクチャは、「[DMZ between Azure and the Internet][implementing-a-secure-hybrid-network-architecture-with-internet-access]」(Azure とインターネット間の DMZ) に示すアーキテクチャを拡張します。</span><span class="sxs-lookup"><span data-stu-id="061a5-117">This architecture extends the architecture shown in [DMZ between Azure and the Internet][implementing-a-secure-hybrid-network-architecture-with-internet-access].</span></span> <span data-ttu-id="061a5-118">アーキテクチャに含まれるコンポーネントを次に示します。</span><span class="sxs-lookup"><span data-stu-id="061a5-118">It has the following components.</span></span>

* <span data-ttu-id="061a5-119">**オンプレミス ネットワーク**。</span><span class="sxs-lookup"><span data-stu-id="061a5-119">**On-premises network**.</span></span> <span data-ttu-id="061a5-120">オンプレミス ネットワークには、オンプレミスにあるコンポーネントの認証と承認を実行できるローカルの Active Directory サーバーが含まれています。</span><span class="sxs-lookup"><span data-stu-id="061a5-120">The on-premises network includes local Active Directory servers that can perform authentication and authorization for components located on-premises.</span></span>
* <span data-ttu-id="061a5-121">**Active Directory サーバー**。</span><span class="sxs-lookup"><span data-stu-id="061a5-121">**Active Directory servers**.</span></span> <span data-ttu-id="061a5-122">クラウドで VM として実行されているディレクトリ サービス (AD DS) を実装するドメイン コントローラーです。</span><span class="sxs-lookup"><span data-stu-id="061a5-122">These are domain controllers implementing directory services (AD DS) running as VMs in the cloud.</span></span> <span data-ttu-id="061a5-123">このようなサーバーは、Azure 仮想ネットワークで実行されるコンポーネントの認証を提供できます。</span><span class="sxs-lookup"><span data-stu-id="061a5-123">These servers can provide authentication of components running in your Azure virtual network.</span></span>
* <span data-ttu-id="061a5-124">**Active Directory サブネット**。</span><span class="sxs-lookup"><span data-stu-id="061a5-124">**Active Directory subnet**.</span></span> <span data-ttu-id="061a5-125">AD DS サーバーは、個別のサブネットでホストされます。</span><span class="sxs-lookup"><span data-stu-id="061a5-125">The AD DS servers are hosted in a separate subnet.</span></span> <span data-ttu-id="061a5-126">ネットワーク セキュリティ グループ (NSG) ルールによって AD DS サーバーが保護され、予期しないソースからのトラフィックに対するファイアウォールが提供されます。</span><span class="sxs-lookup"><span data-stu-id="061a5-126">Network security group (NSG) rules protect the AD DS servers and provide a firewall against traffic from unexpected sources.</span></span>
* <span data-ttu-id="061a5-127">**Azure ゲートウェイと Active Directory 同期**。</span><span class="sxs-lookup"><span data-stu-id="061a5-127">**Azure Gateway and Active Directory synchronization**.</span></span> <span data-ttu-id="061a5-128">Azure ゲートウェイによって、オンプレミス ネットワークと Azure VNet の間に接続が提供されます。</span><span class="sxs-lookup"><span data-stu-id="061a5-128">The Azure gateway provides a connection between the on-premises network and the Azure VNet.</span></span> <span data-ttu-id="061a5-129">[VPN 接続][azure-vpn-gateway]または [Azure ExpressRoute][azure-expressroute] を使用できます。</span><span class="sxs-lookup"><span data-stu-id="061a5-129">This can be a [VPN connection][azure-vpn-gateway] or [Azure ExpressRoute][azure-expressroute].</span></span> <span data-ttu-id="061a5-130">クラウドおよびオンプレミスの Active Directory サーバー間のすべての同期要求はゲートウェイを経由します。</span><span class="sxs-lookup"><span data-stu-id="061a5-130">All synchronization requests between the Active Directory servers in the cloud and on-premises pass through the gateway.</span></span> <span data-ttu-id="061a5-131">Azure に渡すオンプレミスのトラフィックのルーティングは、ユーザー定義ルート (UDR) によって処理されます。</span><span class="sxs-lookup"><span data-stu-id="061a5-131">User-defined routes (UDRs) handle routing for on-premises traffic that passes to Azure.</span></span> <span data-ttu-id="061a5-132">Active Directory サーバーとの間のトラフィックは、このシナリオで使用するネットワーク仮想アプライアンス (NVA) を経由しません。</span><span class="sxs-lookup"><span data-stu-id="061a5-132">Traffic to and from the Active Directory servers does not pass through the network virtual appliances (NVAs) used in this scenario.</span></span>

<span data-ttu-id="061a5-133">UDR と NVA の設定について詳しくは、「[Implementing a secure hybrid network architecture in Azure][implementing-a-secure-hybrid-network-architecture]」(セキュリティ保護されたハイブリッド ネットワーク アーキテクチャを Azure に実装する) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="061a5-133">For more information about configuring UDRs and the NVAs, see [Implementing a secure hybrid network architecture in Azure][implementing-a-secure-hybrid-network-architecture].</span></span> 

## <a name="recommendations"></a><span data-ttu-id="061a5-134">Recommendations</span><span class="sxs-lookup"><span data-stu-id="061a5-134">Recommendations</span></span>

<span data-ttu-id="061a5-135">ほとんどのシナリオには、次の推奨事項が適用されます。</span><span class="sxs-lookup"><span data-stu-id="061a5-135">The following recommendations apply for most scenarios.</span></span> <span data-ttu-id="061a5-136">これらの推奨事項には、優先される特定の要件がない限り、従ってください。</span><span class="sxs-lookup"><span data-stu-id="061a5-136">Follow these recommendations unless you have a specific requirement that overrides them.</span></span> 

### <a name="vm-recommendations"></a><span data-ttu-id="061a5-137">VM の推奨事項</span><span class="sxs-lookup"><span data-stu-id="061a5-137">VM recommendations</span></span>

<span data-ttu-id="061a5-138">認証要求に必要なボリュームに基づいて、[VM サイズ][vm-windows-sizes]の要件を決定します。</span><span class="sxs-lookup"><span data-stu-id="061a5-138">Determine your [VM size][vm-windows-sizes] requirements based on the expected volume of authentication requests.</span></span> <span data-ttu-id="061a5-139">AD DS をオンプレミスでホストしているコンピューターの仕様を始点として使用し、それに合わせて Azure VM サイズを指定します。</span><span class="sxs-lookup"><span data-stu-id="061a5-139">Use the specifications of the machines hosting AD DS on premises as a starting point, and match them with the Azure VM sizes.</span></span> <span data-ttu-id="061a5-140">デプロイ後は、使用率を監視し、VM における実際の負荷に基づいてスケールアップまたはスケールダウンします。</span><span class="sxs-lookup"><span data-stu-id="061a5-140">Once deployed, monitor utilization and scale up or down based on the actual load on the VMs.</span></span> <span data-ttu-id="061a5-141">AD DS ドメイン コントローラーのサイジングついて詳しくは、「[Capacity Planning for Active Directory Domain Services][capacity-planning-for-adds]」(Active Directory Domain Services のキャパシティ プランニング) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="061a5-141">For more information about sizing AD DS domain controllers, see [Capacity Planning for Active Directory Domain Services][capacity-planning-for-adds].</span></span>

<span data-ttu-id="061a5-142">Active Directory 用の データベース、ログ、および SYSVOL を格納するための個別の仮想データ ディスクを作成します。</span><span class="sxs-lookup"><span data-stu-id="061a5-142">Create a separate virtual data disk for storing the database, logs, and SYSVOL for Active Directory.</span></span> <span data-ttu-id="061a5-143">オペレーティング システムと同じディスクにこれらの項目を格納しないでください。</span><span class="sxs-lookup"><span data-stu-id="061a5-143">Do not store these items on the same disk as the operating system.</span></span> <span data-ttu-id="061a5-144">既定では、VM に接続されたデータ ディスクにはライト スルー キャッシュが使用されています。</span><span class="sxs-lookup"><span data-stu-id="061a5-144">Note that by default, data disks that are attached to a VM use write-through caching.</span></span> <span data-ttu-id="061a5-145">ただし、このキャッシュ形式は AD DS の要件と矛盾する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="061a5-145">However, this form of caching can conflict with the requirements of AD DS.</span></span> <span data-ttu-id="061a5-146">そのため、データ ディスクの *[ホスト キャッシュ設定]* を *[なし]* に設定します。</span><span class="sxs-lookup"><span data-stu-id="061a5-146">For this reason, set the *Host Cache Preference* setting on the data disk to *None*.</span></span> <span data-ttu-id="061a5-147">詳しくは、「[Windows Server AD DS データベースと SYSVOL の配置][adds-data-disks]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="061a5-147">For more information, see [Placement of the Windows Server AD DS database and SYSVOL][adds-data-disks].</span></span>

<span data-ttu-id="061a5-148">ドメイン コントローラーとして、AD DS を実行する VM を少なくとも 2 つデプロイし、[可用性セット][availability-set]に追加します。</span><span class="sxs-lookup"><span data-stu-id="061a5-148">Deploy at least two VMs running AD DS as domain controllers and add them to an [availability set][availability-set].</span></span>

### <a name="networking-recommendations"></a><span data-ttu-id="061a5-149">ネットワークの推奨事項</span><span class="sxs-lookup"><span data-stu-id="061a5-149">Networking recommendations</span></span>

<span data-ttu-id="061a5-150">ドメイン ネーム サービス (DNS) の完全なサポートを実現するには、静的なプライベート IP アドレスを使用して各 AD DS サーバの VM ネットワーク インターフェイス (NIC) を構成します。</span><span class="sxs-lookup"><span data-stu-id="061a5-150">Configure the VM network interface (NIC) for each AD DS server with a static private IP address for full domain name service (DNS) support.</span></span> <span data-ttu-id="061a5-151">詳しくは、「[Azure Portal を使用して仮想マシンのプライベート IP アドレスを構成する][set-a-static-ip-address]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="061a5-151">For more information, see [How to set a static private IP address in the Azure portal][set-a-static-ip-address].</span></span>

> [!NOTE]
> <span data-ttu-id="061a5-152">パブリック IP アドレスを使用して AD DS の VM NIC を構成しないでください。</span><span class="sxs-lookup"><span data-stu-id="061a5-152">Do not configure the VM NIC for any AD DS with a public IP address.</span></span> <span data-ttu-id="061a5-153">詳しくは、「[セキュリティに関する考慮事項][security-considerations]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="061a5-153">See [Security considerations][security-considerations] for more details.</span></span>
> 
> 

<span data-ttu-id="061a5-154">Active Directory サブネット NSG には、オンプレミスからの受信トラフィックを許可するルールが必要です。</span><span class="sxs-lookup"><span data-stu-id="061a5-154">The Active Directory subnet NSG requires rules to permit incoming traffic from on-premises.</span></span> <span data-ttu-id="061a5-155">AD DS で使用されるポートについて詳しくは、「[Active Directory and Active Directory Domain Services Port Requirements][ad-ds-ports]」(Active Directory と Active Directory Domain Services のポート要件) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="061a5-155">For detailed information on the ports used by AD DS, see [Active Directory and Active Directory Domain Services Port Requirements][ad-ds-ports].</span></span> <span data-ttu-id="061a5-156">また、UDR テーブルは、このアーキテクチャで使用される NVA を使用して AD DS トラフィックをルーティングしません。</span><span class="sxs-lookup"><span data-stu-id="061a5-156">Also, ensure the UDR tables do not route AD DS traffic through the NVAs used in this architecture.</span></span> 

### <a name="active-directory-site"></a><span data-ttu-id="061a5-157">Active Directory サイト</span><span class="sxs-lookup"><span data-stu-id="061a5-157">Active Directory site</span></span>

<span data-ttu-id="061a5-158">AD DS では、サイトは物理的な場所、ネットワーク、またはデバイスの集合を表します。</span><span class="sxs-lookup"><span data-stu-id="061a5-158">In AD DS, a site represents a physical location, network, or collection of devices.</span></span> <span data-ttu-id="061a5-159">AD DS サイトは、互いに近くにあり、高速ネットワークによって接続される AD DS オブジェクトをグループ化することによって AD DS データベース レプリケーションを管理するために使用します。</span><span class="sxs-lookup"><span data-stu-id="061a5-159">AD DS sites are used to manage AD DS database replication by grouping together AD DS objects that are located close to one another and are connected by a high speed network.</span></span> <span data-ttu-id="061a5-160">AD DS には、サイト間で AD DS データベースをレプリケートするための最適な戦略を選択するロジックが含まれます。</span><span class="sxs-lookup"><span data-stu-id="061a5-160">AD DS includes logic to select the best strategy for replacating the AD DS database between sites.</span></span>

<span data-ttu-id="061a5-161">アプリケーション用に定義されたサブネットを含む AD DS サイトを Azure で作成することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="061a5-161">We recommend that you create an AD DS site including the subnets defined for your application in Azure.</span></span> <span data-ttu-id="061a5-162">続いて、オンプレミスの AD DS サイト間のサイト リンクを構成します。AD DS は最も効率的なデータベース レプリケーションを自動的に実行します。</span><span class="sxs-lookup"><span data-stu-id="061a5-162">Then, configure a site link between your on-premises AD DS sites, and AD DS will automatically perform the most efficient database replication possible.</span></span> <span data-ttu-id="061a5-163">このデータベース レプリケーションには、初期構成以外の構成が多少必要です。</span><span class="sxs-lookup"><span data-stu-id="061a5-163">Note that this database replication requires little beyond the initial configuration.</span></span>

### <a name="active-directory-operations-masters"></a><span data-ttu-id="061a5-164">Active Directory 操作マスター</span><span class="sxs-lookup"><span data-stu-id="061a5-164">Active Directory operations masters</span></span>

<span data-ttu-id="061a5-165">操作マスターの役割は、レプリケートされた AD DS データベースのインスタンス間の整合性チェックをサポートする AD DS ドメイン コントローラーに割り当てることができます。</span><span class="sxs-lookup"><span data-stu-id="061a5-165">The operations masters role can be assigned to AD DS domain controllers to support consistency checking between instances of replicated AD DS databases.</span></span> <span data-ttu-id="061a5-166">操作マスターの役割は 5 つあります。スキーマ マスター、ドメイン名前付けマスター、相対識別子マスター、プライマリ ドメイン コントローラー マスター エミュレーター、インフラストラクチャ マスターです。</span><span class="sxs-lookup"><span data-stu-id="061a5-166">There are five operations master roles: schema master, domain naming master, relative identifier master, primary domain controller master emulator, and infrastructure master.</span></span> <span data-ttu-id="061a5-167">これらの役割について詳しくは、「[What are Operations Masters?][ad-ds-operations-masters]」(操作マスターとは) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="061a5-167">For more information about these roles, see [What are Operations Masters?][ad-ds-operations-masters].</span></span>

<span data-ttu-id="061a5-168">Azure にデプロイされたドメイン コントローラーには操作マスターの役割を割り当てないことを推奨します。</span><span class="sxs-lookup"><span data-stu-id="061a5-168">We recommend you do not assign operations masters roles to the domain controllers deployed in Azure.</span></span>

### <a name="monitoring"></a><span data-ttu-id="061a5-169">監視</span><span class="sxs-lookup"><span data-stu-id="061a5-169">Monitoring</span></span>

<span data-ttu-id="061a5-170">ドメイン コントローラー VM のリソースおよび AD DS を監視し、問題を迅速に修正するためのプランを作成します。</span><span class="sxs-lookup"><span data-stu-id="061a5-170">Monitor the resources of the domain controller VMs as well as the AD DS Services and create a plan to quickly correct any problems.</span></span> <span data-ttu-id="061a5-171">詳しくは、「[Monitoring Active Directory][monitoring_ad]」(Active Directory の監視) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="061a5-171">For more information, see [Monitoring Active Directory][monitoring_ad].</span></span> <span data-ttu-id="061a5-172">[Microsoft Systems Center][microsoft_systems_center] などのツールを監視サーバーにインストールして (アーキテクチャの図を参照)、これらのタスクを実行することもできます。</span><span class="sxs-lookup"><span data-stu-id="061a5-172">You can also install tools such as [Microsoft Systems Center][microsoft_systems_center] on the monitoring server (see the architecture diagram) to help perform these tasks.</span></span>  

## <a name="scalability-considerations"></a><span data-ttu-id="061a5-173">スケーラビリティに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="061a5-173">Scalability considerations</span></span>

<span data-ttu-id="061a5-174">AD DS は、拡張性を確保するために設計されています。</span><span class="sxs-lookup"><span data-stu-id="061a5-174">AD DS is designed for scalability.</span></span> <span data-ttu-id="061a5-175">要求を AD DS ドメイン コントローラーに送信するようにロード バランサーやトラフィック コントローラーを構成する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="061a5-175">You don't need to configure a load balancer or traffic controller to direct requests to AD DS domain controllers.</span></span> <span data-ttu-id="061a5-176">拡張性に関する唯一の考慮事項は、AD DS を実行する、ネットワーク負荷の要件に対応したサイズの VM を構成し、VM 上の負荷を監視し、必要に応じてスケールアップまたはスケールダウンすることです。</span><span class="sxs-lookup"><span data-stu-id="061a5-176">The only scalability consideration is to configure the VMs running AD DS with the correct size for your network load requirements, monitor the load on the VMs, and scale up or down as necessary.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="061a5-177">可用性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="061a5-177">Availability considerations</span></span>

<span data-ttu-id="061a5-178">AD DS を実行する VM をデプロイして[可用性セット][availability-set]を作成します。</span><span class="sxs-lookup"><span data-stu-id="061a5-178">Deploy the VMs running AD DS into an [availability set][availability-set].</span></span> <span data-ttu-id="061a5-179">また、少なくとも 1 つのサーバー (要件に応じて、可能であればそれ以上の数のサーバー) に[スタンバイ操作マスター][standby-operations-masters]の役割を割り当てることを検討します。</span><span class="sxs-lookup"><span data-stu-id="061a5-179">Also, consider assigning the role of [standby operations master][standby-operations-masters] to at least one server, and possibly more depending on your requirements.</span></span> <span data-ttu-id="061a5-180">スタンバイ操作マスターは、フェールオーバー時にプライマリ操作マスター サーバーの代わりに使用可能な操作マスターのアクティブ コピーです。</span><span class="sxs-lookup"><span data-stu-id="061a5-180">A standby operations master is an active copy of the operations master that can be used in place of the primary operations masters server during fail over.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="061a5-181">管理容易性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="061a5-181">Manageability considerations</span></span>

<span data-ttu-id="061a5-182">AD DS の定期的なバックアップを実行します。</span><span class="sxs-lookup"><span data-stu-id="061a5-182">Perform regular AD DS backups.</span></span> <span data-ttu-id="061a5-183">定期的なバックアップの代わりに、ドメイン コントローラーの VHD ファイルを単にコピーしないでください。これは、VHD 上の AD DS データベース ファイルをコピーすると、ファイルの状態に不整合が生じる可能性があり、データベースを再起動できなくなるためです。</span><span class="sxs-lookup"><span data-stu-id="061a5-183">Don't simply copy the VHD files of domain controllers instead of performing regular backups, because the AD DS database file on the VHD may not be in a consistent state when it's copied, making it impossible to restart the database.</span></span>

<span data-ttu-id="061a5-184">Azure Portal を使用してドメイン コントローラー VM をシャットダウンしないでください。</span><span class="sxs-lookup"><span data-stu-id="061a5-184">Do not shut down a domain controller VM using Azure portal.</span></span> <span data-ttu-id="061a5-185">代わりに、ゲスト オペレーティング システムをシャットダウンして再起動します。</span><span class="sxs-lookup"><span data-stu-id="061a5-185">Instead, shut down and restart from the guest operating system.</span></span> <span data-ttu-id="061a5-186">Portal を使用してシャットダウンすると、VM の割り当てが解除され、Active Directory リポジトリの `VM-GenerationID` と `invocationID` の両方がリセットされます。</span><span class="sxs-lookup"><span data-stu-id="061a5-186">Shutting down through the portal causes the VM to be deallocated, which resets both the `VM-GenerationID` and the `invocationID` of the Active Directory repository.</span></span> <span data-ttu-id="061a5-187">これにより、AD DS 相対識別子 (RID) プールが破棄され、SYSVOL が権限なしとしてマークされます。また、ドメイン コントローラーの再構成が必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="061a5-187">This discards the AD DS relative identifier (RID) pool and marks SYSVOL as nonauthoritative, and may require reconfiguration of the domain controller.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="061a5-188">セキュリティに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="061a5-188">Security considerations</span></span>

<span data-ttu-id="061a5-189">AD DS サーバーは認証サービスを提供するため、攻撃の最適なターゲットとなります。</span><span class="sxs-lookup"><span data-stu-id="061a5-189">AD DS servers provide authentication services and are an attractive target for attacks.</span></span> <span data-ttu-id="061a5-190">サーバーを保護するには、ファイアウォールとして機能する NSG を使用する個別のサブネットに AD DS サーバーを配置して、直接インターネットに接続しないようにします。</span><span class="sxs-lookup"><span data-stu-id="061a5-190">To secure them, prevent direct Internet connectivity by placing the AD DS servers in a separate subnet with an NSG acting as a firewall.</span></span> <span data-ttu-id="061a5-191">認証、承認、サーバーの同期に必要なポートを除く、AD DS サーバー上のポートをすべて閉じてください。</span><span class="sxs-lookup"><span data-stu-id="061a5-191">Close all ports on the AD DS servers except those necessary for authentication, authorization, and server synchronization.</span></span> <span data-ttu-id="061a5-192">詳しくは、「[Active Directory and Active Directory Domain Services Port Requirements][ad-ds-ports]」(Active Directory と Active Directory Domain Services のポート要件) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="061a5-192">For more information, see [Active Directory and Active Directory Domain Services Port Requirements][ad-ds-ports].</span></span>

<span data-ttu-id="061a5-193">「[Implementing a secure hybrid network architecture with Internet access in Azure][implementing-a-secure-hybrid-network-architecture-with-internet-access]」(インターネットへのアクセスが可能なセキュリティ保護されたハイブリッド ネットワーク アーキテクチャを Azure に実装する) に示すように、サブネットと NVA のペアを使用して、サーバーの周囲に追加のセキュリティ境界を実装することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="061a5-193">Consider implementing an additional security perimeter around servers with a pair of subnets and NVAs, as described in [Implementing a secure hybrid network architecture with Internet access in Azure][implementing-a-secure-hybrid-network-architecture-with-internet-access].</span></span>

<span data-ttu-id="061a5-194">BitLocker または Azure Disk Encryption を使用して、AD DS データベースをホストするディスクを暗号化します。</span><span class="sxs-lookup"><span data-stu-id="061a5-194">Use either BitLocker or Azure disk encryption to encrypt the disk hosting the AD DS database.</span></span>

## <a name="deploy-the-solution"></a><span data-ttu-id="061a5-195">ソリューションのデプロイ方法</span><span class="sxs-lookup"><span data-stu-id="061a5-195">Deploy the solution</span></span>

<span data-ttu-id="061a5-196">この参照用アーキテクチャをデプロイするためのソリューションは、[GitHub][github] で入手できます。</span><span class="sxs-lookup"><span data-stu-id="061a5-196">A solution is available on [GitHub][github] to deploy this reference architecture.</span></span> <span data-ttu-id="061a5-197">このソリューションをデプロイする Powershell スクリプトを実行するには、最新バージョンの [Azure CLI][azure-powershell] が必要です。</span><span class="sxs-lookup"><span data-stu-id="061a5-197">You will need the latest version of the [Azure CLI][azure-powershell] to run the Powershell script that deploys the solution.</span></span> <span data-ttu-id="061a5-198">参照アーキテクチャをデプロイするには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="061a5-198">To deploy the reference architecture, follow these steps:</span></span>

1. <span data-ttu-id="061a5-199">[GitHub][github] からローカル マシンにソリューション フォルダーをダウンロードまたは複製します。</span><span class="sxs-lookup"><span data-stu-id="061a5-199">Download or clone the solution folder from [GitHub][github] to your local machine.</span></span>

2. <span data-ttu-id="061a5-200">Azure CLI を開き、ローカルのソリューション フォルダーに移動します。</span><span class="sxs-lookup"><span data-stu-id="061a5-200">Open the Azure CLI and navigate to the local solution folder.</span></span>

3. <span data-ttu-id="061a5-201">次のコマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="061a5-201">Run the following command:</span></span>
    ```Powershell
    .\Deploy-ReferenceArchitecture.ps1 <subscription id> <location> <mode>
    ```
    <span data-ttu-id="061a5-202">`<subscription id>` は、Azure サブスクリプション ID に置き換えてください。</span><span class="sxs-lookup"><span data-stu-id="061a5-202">Replace `<subscription id>` with your Azure subscription ID.</span></span>
    <span data-ttu-id="061a5-203">`<location>` には、Azure リージョン (`eastus` や `westus` など) を指定します。</span><span class="sxs-lookup"><span data-stu-id="061a5-203">For `<location>`, specify an Azure region, such as `eastus` or `westus`.</span></span>
    <span data-ttu-id="061a5-204">`<mode>` パラメーターは、デプロイの細分性を制御します。このパラメーターの値は次のいずれかになります。</span><span class="sxs-lookup"><span data-stu-id="061a5-204">The `<mode>` parameter controls the granularity of the deployment, and can be one of the following values:</span></span>
    * <span data-ttu-id="061a5-205">`Onpremise`: シミュレートされたオンプレミスの環境をデプロイします。</span><span class="sxs-lookup"><span data-stu-id="061a5-205">`Onpremise`: deploys the simulated on-premises environment.</span></span>
    * <span data-ttu-id="061a5-206">`Infrastructure`: Azure に VNet インフラストラクチャとジャンプ ボックスをデプロイします。</span><span class="sxs-lookup"><span data-stu-id="061a5-206">`Infrastructure`: deploys the VNet infrastructure and jump box in Azure.</span></span>
    * <span data-ttu-id="061a5-207">`CreateVpn`: Azure 仮想ネットワーク ゲートウェイをデプロイして、シミュレートされたオンプレミス ネットワークに接続します。</span><span class="sxs-lookup"><span data-stu-id="061a5-207">`CreateVpn`: deploys the Azure virtual network gateway and connects it to the simulated on-premises network.</span></span>
    * <span data-ttu-id="061a5-208">`AzureADDS`: Azure で AD DS サーバーとして機能する VM をデプロイし、Active Directory をそれらの VM にデプロイして、ドメインをデプロイします。</span><span class="sxs-lookup"><span data-stu-id="061a5-208">`AzureADDS`: deploys the VMs acting as AD DS servers, deploys Active Directory to these VMs, and deploys the domain in Azure.</span></span>
    * <span data-ttu-id="061a5-209">`Workload`: パブリック DMZ とプライベート DMZ およびワークロードの階層をデプロイします。</span><span class="sxs-lookup"><span data-stu-id="061a5-209">`Workload`: deploys the public and private DMZs and the workload tier.</span></span>
    * <span data-ttu-id="061a5-210">`All`: 上記のすべてをデプロイします。</span><span class="sxs-lookup"><span data-stu-id="061a5-210">`All`: deploys all of the preceding deployments.</span></span> <span data-ttu-id="061a5-211">**これは、既存のオンプレミス ネットワークがない状況で、テストまたは評価用に前述の完全な参照アーキテクチャをデプロイする場合に推奨されるオプションです。**</span><span class="sxs-lookup"><span data-stu-id="061a5-211">**This is the recommended option if If you do not have an existing on-premises network but you want to deploy the complete reference architecture described above for testing or evaluation.**</span></span>

4. <span data-ttu-id="061a5-212">デプロイが完了するまで待ちます。</span><span class="sxs-lookup"><span data-stu-id="061a5-212">Wait for the deployment to complete.</span></span> <span data-ttu-id="061a5-213">`All` のデプロイを指定した場合は、数時間かかります。</span><span class="sxs-lookup"><span data-stu-id="061a5-213">If you are deploying the `All` deployment, it will take several hours.</span></span>

## <a name="next-steps"></a><span data-ttu-id="061a5-214">次の手順</span><span class="sxs-lookup"><span data-stu-id="061a5-214">Next steps</span></span>

* <span data-ttu-id="061a5-215">Azure で [AD DS リソース フォレストを作成する][adds-resource-forest]ためのベスト プラクティスを学習します。</span><span class="sxs-lookup"><span data-stu-id="061a5-215">Learn the best practices for [creating an AD DS resource forest][adds-resource-forest] in Azure.</span></span>
* <span data-ttu-id="061a5-216">Azure で [Active Directory フェデレーション サービス (AD FS) インフラストラクチャを作成する][adfs]ためのベスト プラクティスを学習します。</span><span class="sxs-lookup"><span data-stu-id="061a5-216">Learn the best practices for [creating an Active Directory Federation Services (AD FS) infrastructure][adfs] in Azure.</span></span>

<!-- links -->
[adds-resource-forest]: adds-forest.md
[adfs]: adfs.md

[implementing-a-secure-hybrid-network-architecture]: ../dmz/secure-vnet-hybrid.md
[implementing-a-secure-hybrid-network-architecture-with-internet-access]: ../dmz/secure-vnet-dmz.md

[active-directory-domain-services]: https://technet.microsoft.com/library/dd448614.aspx
[adds-data-disks]: https://msdn.microsoft.com/library/azure/jj156090.aspx#BKMK_PlaceDB
[ad-ds-operations-masters]: https://technet.microsoft.com/library/cc779716(v=ws.10).aspx
[ad-ds-ports]: https://technet.microsoft.com/library/dd772723(v=ws.11).aspx
[availability-set]: /azure/virtual-machines/virtual-machines-windows-create-availability-set
[azure-expressroute]: https://azure.microsoft.com/documentation/articles/expressroute-introduction/
[azure-powershell]: /powershell/azureps-cmdlets-docs
[azure-vpn-gateway]: https://azure.microsoft.com/documentation/articles/vpn-gateway-about-vpngateways/
[capacity-planning-for-adds]: http://social.technet.microsoft.com/wiki/contents/articles/14355.capacity-planning-for-active-directory-domain-services.aspx
[considerations]: ./considerations.md
[GitHub]: https://github.com/mspnp/reference-architectures/tree/master/identity/adds-extend-domain
[microsoft_systems_center]: https://www.microsoft.com/server-cloud/products/system-center-2016/
[monitoring_ad]: https://msdn.microsoft.com/library/bb727046.aspx
[security-considerations]: #security-considerations
[set-a-static-ip-address]: https://azure.microsoft.com/documentation/articles/virtual-networks-static-private-ip-arm-pportal/
[standby-operations-masters]: https://technet.microsoft.com/library/cc794737(v=ws.10).aspx
[visio-download]: https://archcenter.blob.core.windows.net/cdn/identity-architectures.vsdx
[vm-windows-sizes]: /azure/virtual-machines/virtual-machines-windows-sizes

[0]: ./images/adds-extend-domain.png "Active Directory を使用するセキュリティ保護されたハイブリッド ネットワーク アーキテクチャ"
