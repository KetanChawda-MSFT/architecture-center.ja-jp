---
title: 'Azure 仮想データセンター: ネットワークの観点'
description: Azure で仮想データセンターを構築する方法について説明します
author: tracsman
manager: rossort
tags: azure-resource-manager
ms.service: virtual-network
ms.date: 09/24/2018
ms.author: jonor
ms.openlocfilehash: b10930ac6d6458872d8b626825d21bd0bed2b807
ms.sourcegitcommit: 16bc6a91b6b9565ca3bcc72d6eb27c2c4ae935e4
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/28/2018
ms.locfileid: "52550463"
---
# <a name="azure-virtual-datacenter-a-network-perspective"></a>Azure 仮想データセンター: ネットワークの観点

## <a name="overview"></a>概要
オンプレミスのアプリケーションを Azure に移行すると、大きな変更がなくても、セキュリティで保護されたコスト効率の高いインフラストラクチャのメリットが組織にもたらされます。 このアプローチは**リフト アンド シフト**と呼ばれます。 クラウド コンピューティングで俊敏性を最大限に活用するには、Azure の機能を利用するように企業のアーキテクチャを進化させる必要があります。 Microsoft Azure では、ハイパースケールのサービスとインフラストラクチャ、エンタープライズ レベルの機能と信頼性、ハイブリッド接続のための多くの選択肢が提供されています。 

お客様は、これらのクラウド サービスにインターネット経由でアクセスするか、プライベート ネットワーク接続を提供する Azure ExpressRoute を使ってアクセスするかを選択できます。 Microsoft Azure プラットフォームを使用すると、インフラストラクチャをクラウドにシームレスに拡張し、多層アーキテクチャを構築できます。 また、Microsoft のパートナーも、Azure で実行するために最適化されたセキュリティ サービスと仮想アプライアンスにより、強化された機能を提供しています。

この記事では、多くのお客様がクラウドへの一括移行を検討するときに直面する、アーキテクチャのスケール、パフォーマンス、セキュリティに関する問題を解決するパターンと設計の概要について説明します。 組織のさまざまな IT ロールをシステムの管理とガバナンスに組み込む方法の概要についても説明します。 セキュリティ要件とコストの最適化に注目します。

## <a name="what-is-a-virtual-datacenter"></a>仮想データセンターとは
当初、クラウド ソリューションは、パブリック領域で単一の比較的独立したアプリケーションをホストするように設計されていました。 この方法は、数年間はうまくいっていました。 その後、クラウド ソリューションの利点が明らかになり、複数の大規模なワークロードがクラウドでホストされるようになりました。 クラウド サービスのライフ サイクル全体を通じて、1 つ以上のリージョンでのデプロイのセキュリティ、信頼性、パフォーマンス、コストの問題に対処することが不可欠になりました。

次のクラウド配置ダイアグラムでは、**赤色のボックス**にセキュリティ ギャップの例を示しています。 **黄色のボックス**は、ワークロード間での最適化ネットワーク仮想アプライアンスの余地を示しています。

[![0]][0]

仮想データセンター (VDC) は、エンタープライズ ワークロードをサポートするためのスケーリングの必要性から生まれました。 また、パブリック クラウドで大規模なアプリケーションをサポートするときに発生する問題にも対処します。

VDC は、クラウドのアプリケーション ワークロードであるだけでありません。 ネットワーク、セキュリティ、管理、インフラストラクチャでもあります。 たとえば、DNS やディレクトリ サービスなどです。 通常は、オンプレミスのネットワークまたはデータセンターへのプライベート接続を提供します。 Azure に移行するワークロードの増加に伴って、これらのワークロードが配置されるサポート インフラストラクチャおよびオブジェクトについて考えることが重要になります。 データ フロー、セキュリティ モデル、コンプライアンスに関する課題が異なり、個別に管理する必要がある多数の**ワークロード アイランド**の増殖を防ぐために、リソースの構成方法について慎重に考える必要があります。

仮想データセンターは、共通のサポート機能とインフラストラクチャを備えた、独立していながら関連性のあるエンティティの集まりです。 ワークロードを統合された VDC と見なすことで、コンポーネントとデータ フローの一元化によるスケール メリットと最適化されたセキュリティによってコストを削減できます。 また、運用、管理、コンプライアンス監査も容易になります。

> [!NOTE]  
> VDC は独立した Azure 製品では**ない**ことを理解しておくことが重要です。 厳しい要件を満たすためのさまざまな機能の組み合わせです。 VDC は、クラウドのリソースと能力を最大限にするための、ワークロードと Azure の使用方法についての考え方です。 したがって、仮想データセンターでは、組織のロールと責任範囲を考慮した Azure での IT サービスの構築方法について、モジュール方式のアプローチが採用されています。

VDC は、企業が次のシナリオでワークロードとアプリケーションを Azure に移行する際に役立ちます。

-   関連する複数のワークロードをホストする。
-   オンプレミス環境から Azure にワークロードを移行する。
-   複数のワークロード間に、共有または一元化されたセキュリティとアクセスの要件を実装する。
-   大企業向けに Azure DevOps と一元化された IT を適切に組み合わせる。

VDC の利点を実現する鍵となるのは、次のような Azure の機能を組み合わせた集中型トポロジ (ハブとスポーク) です。 

- [Azure Virtual Network][VNet] 
- [ネットワーク セキュリティ グループ (NSG)][NSG]
- [仮想ネットワーク ピアリング][VNetPeering] 
- [ユーザー定義ルート (UDR)][UDR]
- [ロールベースのアクセス制御 (RBAC)][RBAC] を使用した Azure ID サービス 
- (必要に応じて) [Azure Firewall][AzFW]、[Azure DNS][DNS]、[Azure Front Door][AFD]、[Azure Virtual WAN][vWAN]

## <a name="who-should-implement-a-virtual-datacenter"></a>仮想データセンターを実装する必要があるお客様
多くのワークロードを Azure に移行する必要がある Azure のお客様は、共通リソースを使用することによってメリットが得られます。 規模によっては、単一アプリケーションであっても、VDC の構築に使用されるパターンとコンポーネントを使用することでメリットが得られます。

組織に一元化された IT、ネットワーク、セキュリティ、またはコンプライアンスのチームや部門がある場合、VDC を使用することで、ポリシー ポイントと職務の分離を適用できます。 また、基になる共通コンポーネントの統一性を確保しながら、要件に適した最大限の自由と制御をアプリケーション チームに提供できます。

Azure DevOps を検討している組織では、VDC の概念を利用して、Azure リソースの承認済みのポケットを提供し、そのグループ内での完全な制御を確保できます。 グループは、サブスクリプション、または共通サブスクリプションのリソース グループです。 ネットワークとセキュリティの境界では、ハブの仮想ネットワークおよびリソース グループの一元化されたポリシーによる定義に従ってコンプライアンスが維持されます。

## <a name="considerations-when-you-implement-a-virtual-datacenter"></a>仮想データセンターの実装時の考慮事項
VDC を設計するときは、考慮すべき非常に重要な問題がいくつかあります。

-   ID とディレクトリ サービス
-   セキュリティ インフラストラクチャ
-   クラウドへの接続
-   クラウド内の接続

### <a name="identity-and-directory-services"></a>ID とディレクトリ サービス
ID とディレクトリ サービスは、オンプレミスとクラウドの両方のすべてのデータセンターの重要な側面です。 ID は、VDC 内のサービスへのアクセスと承認のすべての側面に関連しています。 承認されたユーザーとプロセスだけが Azure アカウントおよびリソースにアクセスできるようにするために、Azure では複数の種類の資格情報が認証に使用されます。 これには、Azure アカウントにアクセスするためのパスワード、暗号化キー、デジタル署名、証明書が含まれます。 

[Azure Multi-Factor Authentication][MFA] は、Azure サービスにアクセスする際の追加のセキュリティ レイヤーです。 簡単な検証オプションを使用して強力な認証が提供されます。 お客様は好みの方法を選択できます。 オプションとして、電話、テキスト メッセージ、モバイル アプリの通知があります。 

大企業では、VDC 内または VDC 間での個々の ID とその認証、承認、ロール、権限の管理について説明する ID 管理プロセスを定義する必要があります。 このプロセスの目的は、コスト、ダウンタイム、繰り返し実行される手動タスクを削減し、セキュリティと生産性を向上させることです。

企業や組織では、さまざまな基幹業務向けのサービスの要求の厳しい組み合わせが必要になる場合があります。 また、多くの場合、従業員には、関与するプロジェクトごとに異なるロールが割り当てられます。 VDC では、適切なガバナンスでシステムを実行するために、それぞれ特定のロール定義を使用するさまざまなチーム間の良好な協力が必要です。 責任、アクセス、権限のマトリックスは複雑になる可能性があります。 VDC の ID 管理は、[Azure Active Directory (Azure AD)][AAD] とロールベースのアクセス制御 (RBAC) を使用して実装されます。

ディレクトリ サービスは、日常的な項目とネットワーク リソースを検索、管理、整理するための共有情報インフラストラクチャです。 これらのリソースには、ボリューム、フォルダー、ファイル、プリンター、ユーザー、グループ、デバイス、その他のオブジェクトが含まれます。 ネットワーク上の各リソースは、ディレクトリ サーバーによってオブジェクトと見なされます。 リソースに関する情報は、そのリソースまたはオブジェクトに関連付けられた属性のコレクションとして格納されます。

すべての Microsoft オンライン ビジネス サービスは、サインインや他の ID のニーズに対応するために、Azure Active Directory (Azure AD) に依存しています。 Azure Active Directory は、統合的で可用性の高い ID とアクセス管理のクラウド ソリューションであり、コアのディレクトリ サービス、高度な ID ガバナンス、およびアプリケーション アクセス管理を組み合わせたものです。 Azure AD をオンプレミスの Active Directory と統合することで、クラウドベースのアプリケーションとローカルでホストされているオンプレミス アプリケーションのシングル サインオンを有効にすることができます。 オンプレミスの Active Directory のユーザー属性は、Azure AD に自動的に同期できます。

1 人のグローバル管理者が、VDC 実装のすべてのアクセス許可を割り当てる必要があるわけではありません。 代わりに、特定の各部門、またはディレクトリ サービス内のユーザーまたはサービスのグループが、VDC 内の各自のリソースを管理するために必要なアクセス許可を持つことができます。 アクセス許可を構成するにはバランスが必要です。 アクセス許可が多すぎると、パフォーマンス効率が低下します。 アクセス許可が少なすぎたり緩すぎたりすると、セキュリティ リスクが高まります。 Azure のロールベースのアクセス制御 (RBAC) は、VDC リソースのきめ細かいアクセス管理を実現することで、この問題への対処を支援します。

#### <a name="security-infrastructure"></a>セキュリティ インフラストラクチャ
このセキュリティ インフラストラクチャは、VDC 固有の仮想ネットワーク セグメントでのトラフィックの分離と、VDC 全体にわたるイングレス/エグレス フローを制御する方法を指します。 Azure は、デプロイ間の許可されていない意図しないトラフィックを防ぐマルチテナント アーキテクチャに基づいています。 Azure では、仮想ネットワークの分離、アクセス制御リスト (ACL)、ロード バランサー、IP フィルター、トラフィック フロー ポリシーが使用されます。 ネットワーク アドレス変換 (NAT) は、内部ネットワーク トラフィックを外部トラフィックから分離します。

Azure ファブリックは、テナントのワークロードにインフラストラクチャ リソースを割り当て、仮想マシン (VM) との間の通信を管理します。 Azure ハイパーバイザーは、VM 間のメモリおよびプロセスの分離を強制し、ネットワーク トラフィックをゲスト OS テナントに安全にルーティングします。

#### <a name="connectivity-to-the-cloud"></a>クラウドへの接続
VDC 実装には、顧客、パートナー、社内ユーザーにサービスを提供するために、外部ネットワークとの接続が必要です。 通常、インターネットへの接続だけでなく、オンプレミスのネットワークとデータセンターへの接続も必要になります。

[Azure Firewall][AzFW] または他の種類のネットワーク仮想アプライアンス (NVA)、[ユーザー定義ルート][UDR]を使用したカスタム ルーティング ポリシー、[ネットワーク セキュリティ グループ][NSG]を使用したネットワーク フィルタリングを使って、パブリック インターネットと双方向にアクセスできるサービスを制御できます。 インターネットに接続するすべてのリソースを、[Azure DDoS Protection Standard][DDOS] で保護することもお勧めします。

多くの場合、企業では VDC 実装をオンプレミスのデータセンターや他のリソースに接続する必要があります。 そのため、Azure とオンプレミス ネットワーク間の接続は、効果的なアーキテクチャを設計するときに不可欠な要素となります。 Azure で VDC 実装とオンプレミス間の相互接続を作成するには、インターネット経由とプライベート直接接続の 2 とおりの方法があります。

[Azure サイト間 VPN][VPN] では、パブリック インターネットを介して企業のオンプレミス ネットワークを VDC 実装に接続します。 VPN 経由のトラフィックは、IPSec と IKE トンネリングを使用して暗号化されます。 Azure サイト間接続は柔軟性があり、すばやく作成できます。 この VPN では、すべての接続がインターネット経由で行われるため、追加の調達は不要です。

多くの VPN 接続において、[Azure Virtual WAN][vWAN] は、Azure を介してブランチ間接続を最適化し、自動化するネットワーク サービスです。 Virtual WAN を使用すると、ブランチ デバイスを接続および構成して Azure と通信できます。 この接続は、手動で行うことも、Virtual WAN パートナーを通じて推奨プロバイダー デバイスを使用して行うこともできます。 推奨プロバイダー デバイスは使いやすく、接続の簡素化と構成管理を実現できます。 Azure WAN の組み込みダッシュボードでは、トラブルシューティングに必要な分析情報が即座に提供されるので時間を節約できます。 また、ダッシュボードを使用して、大規模なサイト間接続を簡単に表示できます。

Azure の接続サービスである [ExpressRoute][ExR] を使用すると、企業のオンプレミス ネットワークと VDC 実装間のプライベート接続が可能になります。 一貫した待機時間に加え、強固なセキュリティ、信頼性、最大 10 Gbps の速度が実現されます。 ExpressRoute のお客様はプライベート接続に関連付けられたコンプライアンス ルールの利点が得られるので、ExpressRoute は VDC 実装に適しています。 より広い帯域幅が必要なお客様の場合、[ExpressRoute Direct][ExRD] を使用すると、100 Gbps の Microsoft ルーターに直接接続できます。

通常、ExpressRoute 接続のデプロイでは、ExpressRoute サービス プロバイダーと連携する必要があります。 短時間で使い始める必要があるお客様の場合、最初にサイト間 VPN を使用して、VDC とオンプレミスのリソース間の接続を確立するのが一般的です。 その後、サービス プロバイダーとの物理的な相互接続が完了したら、ExpressRoute 接続に移行します。

#### <a name="connectivity-within-the-cloud"></a>クラウド内の接続
[仮想ネットワーク][VNet]と[仮想ネットワーク ピアリング][VNetPeering]は、VDC 内の基本的なネットワーク接続サービスです。 仮想ネットワークでは、VDC リソースの自然な分離境界が保証されます。 仮想ネットワーク ピアリングは、同じ Azure リージョン内またはリージョンをまたがるさまざまな仮想ネットワーク間の相互通信を可能にします。 仮想ネットワーク内および仮想ネットワーク間のトラフィック制御は、アクセス制御リストを使用して指定された一連のセキュリティ規則に適合する必要があります。 [ネットワーク セキュリティ グループ][NSG]、[ネットワーク仮想アプライアンス (NVA)][NVA]、[ユーザー定義ルートのカスタム ルーティング テーブル][UDR]に関する情報をご覧ください。

## <a name="virtual-datacenter-overview"></a>仮想データセンターの概要

### <a name="topology"></a>トポロジ
**ハブとスポーク**は、単一の Azure リージョン内の仮想データセンターを拡張するためのモデルです。

[![1]][1]

ハブは、異なるゾーン (インターネット、オンプレミス、スポーク) 間のイングレスまたはエグレス トラフィックを制御および検査する中央ネットワーク ゾーンです。 ハブとスポークのトポロジでは、IT 部門は一元化された場所でセキュリティ ポリシーを効率的に適用できます。 また、構成の誤りや露出の可能性も低減されます。

ハブには、スポークによって消費される共通のサービス コンポーネントが含まれます。 共通の中央サービスの例を次に示します。

-   信頼されていないネットワークからアクセスするサード パーティがスポーク内のワークロードにアクセスする前のユーザー認証に必要な Windows Active Directory インフラストラクチャ。 これには、関連する Active Directory フェデレーション サービス (AD FS) が含まれます。
-   オンプレミスおよびインターネット上のリソースにアクセスするための、スポーク内のワークロードの名前付けを解決する DNS サービス ([Azure DNS][DNS] が使用されていない場合)。
-   ワークロードにシングル サインオンを実装するための公開キー基盤 (PKI)。
-   スポーク ネットワーク ゾーンとインターネット間の TCP/UDP トラフィックのフロー制御。
-   スポークとオンプレミス間のフロー制御。
-   (必要に応じて) スポーク間のフロー制御。

VDC では、複数のスポーク間で共有ハブ インフラストラクチャを使用することで、全体的なコストを削減します。

各スポークのロールは、異なる種類のワークロードをホストできます。 スポークは、同じワークロードの反復可能なデプロイのためのモジュール方式のアプローチも提供します。 例として、開発とテスト、ユーザー受け入れテスト、運用前環境、運用環境があります。 スポークでは、組織内のさまざまなグループを分離して有効にすることもできます。 例として Azure DevOps グループがあります。 スポーク内には、基本的なワークロードや、階層間のトラフィック制御を伴う複雑な多層ワークロードをデプロイできます。

#### <a name="subscription-limits-and-multiple-hubs"></a>サブスクリプションの制限と複数のハブ
Azure では、種類に関係なく、すべてのコンポーネントが Azure サブスクリプションにデプロイされます。 異なる Azure サブスクリプションに Azure コンポーネントを分離することで、さまざまな基幹業務の要件を満たすことができます。 要件の例として、差別化されたレベルのアクセスと承認の設定があります。

単一 VDC 実装で多数のスポークにスケールアップできます。 ただし、他の IT システムと同様に、プラットフォームの制限があります。 ハブのデプロイは特定の Azure サブスクリプションにバインドされており、サブスクリプションには制約と制限があります。 たとえば、仮想ネットワーク ピアリングの最大数が設定されています。 詳細については、「[Azure サブスクリプションとサービスの制限、クォータ、制約][Limits]」をご覧ください。 制限が問題になる可能性がある場合は、アーキテクチャをさらにスケールアップできます。 単一のハブ スポークからハブとスポークのクラスターにモデルを拡張します。 仮想ネットワーク ピアリング、ExpressRoute、Virtual WAN、またはサイト間 VPN を使用して、1 つ以上の Azure リージョン内の複数のハブを相互接続します。

[![2]][2]

複数のハブを導入すると、システムのコストと管理作業が増加します。 複数のハブの導入が妥当なのは、スケーラビリティ (システムの制限や冗長性など) とリージョン レプリケーション (エンドユーザーのパフォーマンスやディザスター リカバリーなど) が必要な場合だけです。 複数のハブが必要なシナリオでは、運用を容易にするため、すべてのハブで同じサービスのセットを提供する必要があります。

#### <a name="interconnection-between-spokes"></a>スポーク間の相互接続
1 つのスポーク内に、複雑な多層ワークロードを実装できます。 多層構成は、同じ仮想ネットワークのサブネットを階層ごとに 1 つ使用することで実装できます。 NSG を使用してフローをフィルター処理します。

アーキテクトは、複数の仮想ネットワークに多層ワークロードをデプロイできます。 仮想ネットワーク ピアリングにより、スポークは同じハブまたは異なるハブの他のスポークに接続できます。 このシナリオの一般的な例は、アプリケーション処理サーバーが 1 つのスポーク (仮想ネットワーク) にあるケースです。 データベースは別のスポーク (仮想ネットワーク) にデプロイされています。 この場合、仮想ネットワーク ピアリングでスポークを相互接続することによって、ハブの通過を簡単に回避できます。 ハブをバイパスすることで、ハブにしか存在しない重要なセキュリティ ポイントや監査ポイントがバイパスされることがないように、アーキテクチャとセキュリティを慎重に見直す必要があります。

[![3]][3]

スポークは、ハブとして機能するスポークに相互接続することもできます。 この方法では 2 レベルの階層が作成されます。上位レベル (レベル 0) のスポークが、階層の下位レベル (レベル 1) のスポークのハブになります。 VDC 実装のスポークは、オンプレミス ネットワークまたはインターネットに到達するために、中央のハブにトラフィックを転送する必要があります。 2 レベルのハブのアーキテクチャでは複雑なルーティングが導入され、単純なハブ スポーク関係のメリットが失われます。

Azure では複雑なトポロジを構成できますが、VDC の概念の中核となる原則の 1 つは再現性と単純さです。 管理作業を最小限に抑えるために、単純なハブ スポーク設計が、推奨される VDC 参照アーキテクチャです。

### <a name="components"></a>コンポーネント
仮想データセンター実装は、**インフラストラクチャ**、**境界ネットワーク**、**ワークロード**、**監視** の 4 つの基本的なコンポーネントの種類で構成されます。

各コンポーネントの種類は、さまざまな Azure の機能とリソースで構成されます。 企業の VDC 実装は、複数のコンポーネントの種類のインスタンスと、同じコンポーネントの種類の複数のバリエーションで構成されます。 たとえば、異なるアプリケーションを表す、論理的に分離された多数の異なるワークロード インスタンスを使用できます。 これらのさまざまなコンポーネントの種類とインスタンスを使って、最終的に VDC を構築します。

[![4]][4]

VDC 実装の上記のおおまかなアーキテクチャは、ハブ スポーク トポロジのさまざまなゾーンで使用されるさまざまなコンポーネントの種類を示しています。 図では、アーキテクチャのさまざまな部分にインフラストラクチャ コンポーネントが示されています。

オンプレミスのデータセンターまたは VDC 実装では、アクセス権と権限をグループ ベースにすることをお勧めします。 個々のユーザーではなくグループとして扱うことで、チーム間でアクセス ポリシーを一貫して管理し、構成エラーを最小限に抑えることができます。 適切なグループにユーザーを割り当てたり、グループからユーザーを削除したりすることで、特定のユーザーの権限を最新の状態に保ちます。

各ロール グループの名前には、一意のプレフィックスが必要です。 このプレフィックスにより、グループとワークロードの関連付けを識別しやすくなります。 たとえば、認証サービスをホストしているワークロードでは、グループに **AuthServiceNetOps**、**AuthServiceSecOps**、**AuthServiceDevOps**、**AuthServiceInfraOps** という名前を付けます。 一元化されたロール (特定のサービスに関係しないロール) には、**Corp** というプレフィックスを付けます (例: **CorpNetOps**)。

多くの組織では、次のグループのバリエーションを使って、ロールが大きく分類されています。

-   中央 IT グループ (**Corp**) は、インフラストラクチャ コンポーネントを制御するための所有者権限を持ちます。 コンポーネントの例として、ネットワークとセキュリティがあります。 このグループには、サブスクリプションの共同作業者のロールとスポークのネットワーク共同作成者権限が必要であり、ハブを制御できる必要があります。 多くの場合、大規模な組織では、これらの管理責任を複数のチームが分担します。 たとえば、ネットワーク運用 (**CorpNetOps**) グループはネットワークだけを担当し、セキュリティ運用 (**CorpSecOps**) グループはファイアウォールとセキュリティ ポリシーを担当します。 この場合、カスタム ロールの割り当て用に 2 つの異なるグループを作成する必要があります。
-   開発とテスト (**AppDevOps**) グループは、アプリまたはサービス ワークロードをデプロイする役割を担います。 このグループには、IaaS デプロイの仮想マシン共同作成者のロール、または 1 つ以上の PaaS 共同作成者のロールが割り当てられます。 「[Azure リソースの組み込みロール][Roles]」をご覧ください。 場合によっては、開発とテスト チームは、ハブまたは特定のスポーク内のセキュリティ ポリシー、NSG、ルーティング ポリシー、UDR を表示できる必要があります。 その場合、このグループには、ワークロードの共同作成者のロールに加え、ネットワーク閲覧者のロールも必要になります。
-   運用とメンテナンス グループ (**CorpInfraOps** または **AppInfraOps**) は、運用環境のワークロードを管理する役割を担います。 このグループは、運用サブスクリプションのワークロードのサブスクリプション共同作成者である必要があります。 一部の組織では、運用環境のサブスクリプション共同作成者のロールと中央ハブ サブスクリプションを持つ、追加のエスカレーション サポート チーム グループが必要かどうかを評価することもあります。 この追加のグループは、運用環境における潜在的な構成の問題を修正します。

VDC は、ハブを管理する中央 IT グループ用に作成されたグループが、対応するグループをワークロード レベルで持つように構成されます。 ハブ リソースの管理に加え、中央 IT グループだけが、サブスクリプションでの外部アクセスと最上位レベルのアクセス許可を制御できます。 ただし、ワークロード グループは、それぞれの仮想ネットワークのリソースとアクセス許可を中央 IT から独立して制御できます。

さまざまな基幹業務の複数のプロジェクトを安全にホストできるように、VDC をパーティション分割します。 すべてのプロジェクトに異なる分離環境 (開発、UAT、運用など) が必要です。 これらの環境ごとに Azure サブスクリプションを分けると、自然な分離が提供されます。

[![5]][5]

上記の図は、組織のプロジェクト、ユーザー、グループ間の関係と、Azure のコンポーネントがデプロイされている環境を示しています。

通常、IT の環境または階層は、複数のアプリケーションがデプロイされて実行されるシステムです。 大企業では、変更を行ってテストするための開発環境と、エンド ユーザーが使用する運用環境を使用しています。 これらの環境は分離されており、多くの場合、その間に複数のステージング環境があります。これにより、段階的なデプロイ (ロールアウト)、テスト、問題が発生した場合のロールバックが可能になります。 デプロイ アーキテクチャは大きく異なりますが、通常、開発 (**DEV**) から始まり、運用 (**PROD**) で終わる基本的なプロセスに従います。

この種の多層環境の一般的なアーキテクチャは、開発およびテスト用の Azure DevOps、ステージング用の UAT、運用環境で構成されます。 組織では、1 つまたは複数の Azure AD テナントを利用して、これらの環境に対するアクセスと権限を定義できます。 前の図は、Azure DevOps および UAT 用と運用専用の 2 つの異なる Azure AD テナントが使用されているケースを示しています。

異なる Azure AD テナントが存在すると、必然的に環境間が分離されます。 同じユーザー グループ (中央 IT など) が、プロジェクトの Azure DevOps または運用環境のロールやアクセス許可を変更するために Azure AD テナントにアクセスするときは、テナントごとに異なる URI を使用して認証する必要があります。 環境にアクセスするときに、環境ごとに異なるユーザー認証が存在すると、人的エラーが原因で発生する可能性のある停止や他の問題が減少します。

#### <a name="component-type-infrastructure"></a>コンポーネントの種類: インフラストラクチャ
このコンポーネントの種類には、ほとんどのサポート インフラストラクチャが存在します。 また、一元化された IT、セキュリティ、コンプライアンスのチームが時間の大半を費やす部分でもあります。

[![6]][6]

インフラストラクチャ コンポーネントは、VDC のさまざまなコンポーネント間の相互接続を提供します。 これらはハブとスポークの両方に存在します。 インフラストラクチャ コンポーネントの管理と保守の責任は、通常、中央 IT またはセキュリティ チームに割り当てられます。

IT インフラストラクチャ チームの主要なタスクの 1 つは、企業全体にわたって一貫した IP アドレス スキーマを保証することです。 VDC に割り当てられたプライベート IP アドレス空間には一貫性が必要です。 オンプレミス ネットワークで割り当てられたプライベート IP アドレスと重複してはいけません。

オンプレミスのエッジ ルーター上または Azure 環境内での NAT により、IP アドレスの競合を回避できます。 ただし、インフラストラクチャ コンポーネントが複雑になります。 管理の簡単さが VDC の主な目標の 1 つです。 そのため、NAT を使用した IP の問題への対処は推奨されるソリューションではありません。

インフラストラクチャ コンポーネントは次の機能を備えています。

-   [**ID とディレクトリ サービス**][AAD]。 Azure のすべてのリソース種類へのアクセスは、ディレクトリ サービスに格納された ID によって制御されます。 ディレクトリ サービスには、ユーザー リストと、特定の Azure サブスクリプションのリソースへのアクセス権が格納されています。 これらのサービスは、クラウドにのみ存在できます。 または、Azure Active Directory に格納されたオンプレミスの ID と同期することができます。
-   [**仮想ネットワーク**][VPN]。 仮想ネットワークは、VDC の主要コンポーネントの 1 つです。 仮想ネットワークを使用して、Azure プラットフォーム上にトラフィックの分離境界を作成できます。 仮想ネットワークは、1 つまたは複数の仮想ネットワーク セグメントで構成されます。 それぞれが特定の IP ネットワーク プレフィックス (サブネット) を持ちます。 仮想ネットワークにより、IaaS 仮想マシンと PaaS サービスがプライベート通信を確立できる内部境界領域が定義されます。 仮想ネットワーク内の VM と PaaS サービスは、別の仮想ネットワーク内の VM および PaaS サービスと直接通信することはできません。 この分離は、両方の仮想ネットワークが同じお客様によって同じサブスクリプションで作成されている場合でも行われます。 分離は、仮想ネットワーク内でお客様の VM と通信のプライバシーを確保するための重要な特性です。
-   [**UDR**][UDR]。 仮想ネットワーク内のトラフィックは、システム ルーティング テーブルに基づいて既定でルーティングされます。 ユーザー定義ルートは、ネットワーク管理者が 1 つ以上のサブネットに関連付けることができるカスタム ルーティング テーブルです。 この関連付けにより、システム ルーティング テーブルの動作が上書きされ、仮想ネットワーク内の通信パスが定義されます。 UDR が存在すると、スポークからのエグレス トラフィックが、特定のカスタム VM、またはハブとスポークに存在するネットワーク仮想アプライアンスとロード バランサーを通過することが保証されます。
-   [**NSG**][NSG]。 ネットワーク セキュリティ グループは、IP 送信元、IP 送信先、プロトコル、IP 送信元ポート、IP 送信先ポートのトラフィック フィルターとして機能するセキュリティ規則のリストです。 NSG は、サブネットと、Azure VM に関連付けられた仮想 NIC カードのどちらか一方または両方に適用できます。 NSG は、ハブとスポークに正しいフロー制御を実装するうえで不可欠です。 NSG によって提供されるセキュリティのレベルは、どのポートをどのような目的で開くのかによって決まります。 IPtables や Windows ファイアウォールなどのホストベースのファイアウォールを使用して、VM ごとの追加フィルターを適用する必要があります。
-   [**DNS**][DNS]。 VDC の仮想ネットワーク内のリソースの名前解決は、DNS によって提供されます。 Azure は、[パブリック][DNS]と[プライベート][PrivateDNS]の両方の名前解決に DNS サービスを提供します。 プライベート ゾーンは、仮想ネットワーク内での名前解決と仮想ネットワーク間での名前解決を両方提供します。 プライベート ゾーンは、同じリージョン内の複数の仮想ネットワークをまたぐだけでなく、複数のリージョンおよびサブスクリプションをまたぐことができます。 パブリック解決の場合、Azure DNS は DNS ドメインのホスティング サービスを提供します。 それは Microsoft Azure インフラストラクチャを使用した名前解決を提供します。 Azure でドメインをホストすることで、その他の Azure サービスと同じ資格情報、API、ツール、課金情報を使用して DNS レコードを管理できます。
-   [**サブスクリプション**][SubMgmt]と[**リソース グループ管理**][RGMgmt]。 サブスクリプションでは、Azure にリソースの複数のグループを作成する自然な境界が定義されています。 サブスクリプションのリソースは、**リソース グループ**と呼ばれる論理コンテナーにまとめられています。 リソース グループは、VDC のリソースを整理するための論理グループを表します。
-   [**RBAC**][RBAC]。 RBAC を使用すると、特定の Azure リソースにアクセスするための権限と共に組織のロールをマップできるので、ユーザーをアクションの特定のサブセットだけに制限することが可能になります。 RBAC では、関連するスコープ内のユーザー、グループ、アプリケーションに適切なロールを割り当てることで、アクセス権を付与できます。 ロール割り当てのスコープには、Azure サブスクリプション、リソース グループ、または単独のリソースを指定できます。 RBAC では、アクセス許可を継承できます。 親スコープでロールが割り当てられると、その親に含まれる子にもアクセス権が付与されます。 RBAC を使用して、職務を分離し、職務に必要なアクセス権のみをユーザーに付与できます。 たとえば、RBAC を使用して、ある従業員がサブスクリプション内の仮想マシンを管理できるようにします。 別の従業員は、同じサブスクリプション内の SQL データベースを管理できるようにします。
-   [**仮想ネットワーク ピアリング**][VNetPeering]。 VDC のインフラストラクチャの作成に使用される基本的な機能が仮想ネットワーク ピアリングです。 これは、Azure データセンターのネットワークを介して、またはリージョンをまたがる Azure の世界規模のバックボーンを使用して、同じリージョンの 2 つの仮想ネットワークを接続するメカニズムです。

#### <a name="component-type-perimeter-networks"></a>コンポーネントの種類: 境界ネットワーク
[境界ネットワーク][DMZ] コンポーネント (DMZ ネットワーク) を使用すると、インターネットとの間の双方向の接続に加え、オンプレミス ネットワークまたは物理データセンター ネットワークとのネットワーク接続を提供できます。 このコンポーネントは、ネットワークおよびセキュリティ チームが最も多くの時間を費やす場所でもあります。

受信パケットは、スポーク内のバックエンド サーバーに到達する前に、ハブのセキュリティ アプライアンスを通過する必要があります。 セキュリティ アプライアンスの例として、ファイアウォール、IDS、IPS があります。 ワークロードからインターネットへのパケットも、ネットワークから送信される前に、境界ネットワーク内のセキュリティ アプライアンスを通過する必要があります。 このフローは、ポリシーの適用、検査、監査を目的としています。

境界ネットワーク コンポーネントは、次の機能を提供します。

-   [仮想ネットワーク][VNet]、[UDR][UDR]、[NSG][NSG]
-   [ネットワーク仮想アプライアンス][NVA]
-   [Azure Load Balancer][ALB]
-   [Azure Application Gateway][AppGW] と [Web アプリケーション ファイアウォール (WAF)][WAF]
-   [パブリック IP][PIP]
-   [Azure Front Door][AFD]
-   [Azure Firewall][AzFW]

通常、中央 IT チームとセキュリティ チームは、境界ネットワークの要件の定義と運用を担当します。

[![7]][7]

上記の図は、インターネットとオンプレミス ネットワークにアクセスする 2 つの境界の適用を示しています。 どちらも DMZ ハブと vWAN ハブ内に存在します。 DMZ ハブでは、多数の基幹業務をサポートするために、Web アプリケーション ファイアウォール (WAF) の複数のファームまたは Azure Firewall インスタンスを使用して、インターネットへの境界ネットワークをスケールアップできます。 vWAN ハブでは、ブランチ間およびブランチから Azure への非常にスケーラブルな接続が、必要に応じて VPN または ExpressRoute 経由で実行されます。

[**仮想ネットワーク**][VNet]。 通常、ハブは複数のサブネットを含む仮想ネットワーク上に構築され、NVA、WAF、Azure Application Gateway インスタンスを介してインターネットとの間でやり取りされるトラフィックをフィルター処理および検査するさまざまな種類のサービスをホストします。

[**UDR**][UDR]。 UDR を使用して、ファイアウォール、IDS または IPS、その他の仮想アプライアンスをデプロイできます。 これらのセキュリティ アプライアンスを経由してネットワーク トラフィックをルーティングすることで、セキュリティ境界ポリシーの適用、監査、検査が可能になります。 UDR は、ハブとスポークのどちらにも作成できます。 これにより、VDC で使用される特定のカスタム VM、ネットワーク仮想アプライアンス、ロード バランサーをトラフィックが通過することが保証されます。 スポーク内に存在する VM から生成されたトラフィックが正しい仮想アプライアンスに確実に転送されるようにするには、スポークのサブネットに UDR を設定します。 次ホップとして、内部ロード バランサーのフロントエンド IP アドレスを設定します。 内部ロード バランサーは、内部トラフィックを仮想アプライアンス (ロード バランサーのバックエンド プール) に分散させます。

[**Azure Firewall**][AzFW] は、Azure Virtual Network リソースを保護するクラウドベースのマネージド ネットワーク セキュリティ サービスです。 組み込みの高可用性とクラウドの無制限のスケーラビリティを備えた、完全にステートフルなサービスとしてのファイアウォールです。 サブスクリプションと仮想ネットワークをまたいでアプリケーションとネットワークの接続ポリシーを一元的に作成、適用、記録できます。 Azure Firewall では、仮想ネットワーク リソースに静的パブリック IP アドレスが使用されます。 これにより、仮想ネットワークから送信されるトラフィックを外部のファイアウォールで識別できます。 サービスはログ記録と分析を行うために Azure Monitor と完全に統合されます。

[**ネットワーク仮想アプライアンス**][NVA]。 ハブでは、インターネットにアクセスする境界ネットワークは、通常、Azure Firewall インスタンスあるいはファイアウォールまたは Web アプリケーション ファイアウォール (WAF) のファームによって管理されます。

一般に、さまざまな LOB で多くの Web アプリケーションが使用されます。 これらのアプリケーションは、さまざまな脆弱性や潜在的な悪用の影響を受ける傾向があります。 Web アプリケーション ファイアウォールは、Web アプリケーション (HTTP/HTTPS) に対する攻撃を汎用ファイアウォールよりも詳細に検出するために使用される特殊な種類の製品です。 従来のファイアウォール テクノロジと比較すると、WAF は脅威から内部 Web サーバーを保護するための特定の機能セットを備えています。

ただし、サブスクリプションの要件により、リージョンをまたがることができないため、単一 VDC 実装は単一リージョン内でホストする必要があります。 この要件により、単一 VDC 実装はリージョンの障害に対して脆弱になります。

Azure Firewall インスタンスまたは NVA ファイアウォール ファームでは、共通の管理プレーンを使用します。 一連のセキュリティ規則により、スポーク内でホストされているワークロードが保護され、オンプレミス ネットワークへのアクセスが制御されます。 Azure Firewall にはスケーラビリティが組み込まれているのに対し、NVA ファイアウォールはロード バランサーの背後で手動でスケーリングできます。 一般に、ファイアウォール ファームには WAF ほど特化したソフトウェアはありません。 ただし、エグレスおよびイングレスのあらゆる種類のトラフィックのフィルター処理と検査を行う、より広範なアプリケーション スコープを備えています。 NVA アプローチを使用している場合は、Azure Marketplace で入手してデプロイできます。

インターネットから送信されるトラフィックには、Azure Firewall インスタンスまたは NVA の特定のセットを使用することをお勧めします。 オンプレミスから送信されるトラフィックには、別のセットを使用します。 両方にファイアウォールの同じセットを使用すると、2 つのネットワーク トラフィック セットの間にセキュリティ境界が提供されないため、セキュリティ リスクになります。 個別のファイアウォール レイヤーを使用すると、セキュリティ規則のチェックの複雑さが軽減され、規則と受信ネットワーク要求の対応が明確になります。

ほとんどの大企業は、複数のドメインを管理しています。 [Azure DNS][DNS] を使用して、特定のドメインの DNS レコードをホストできます。 たとえば、Azure 外部ロード バランサーまたは WAF の仮想 IP (VIP) アドレスを、Azure DNS レコードの **A** レコードに登録できます。 [**プライベート DNS**][PrivateDNS] を使用して、仮想ネットワーク内のプライベート アドレス空間を管理することもできます。

[**Azure Load Balancer**][ALB] は、高可用性レイヤー 4 (TCP または UDP) サービスを提供します。 負荷分散セットで定義されているサービス インスタンス間に受信トラフィックを分散できます。 フロントエンド エンドポイント (パブリックまたはプライベート IP) からロード バランサーに送信されたトラフィックは、アドレス変換を行っても行わなくても、一連のバックエンド IP アドレス プールに再分散できます。 たとえば、ネットワーク仮想アプライアンスや VM に再分散できます。

Azure Load Balancer では、さまざまなサーバー インスタンスの正常性をプローブすることもできます。 プローブが応答しない場合、Load Balancer は異常なインスタンスへのトラフィックの送信を停止します。 VDC では、ハブ内の外部ロード バランサーは、たとえば NVA へのトラフィックを分散します。 スポークでは、多層アプリケーションのさまざまな VM 間へのトラフィックの分散などのタスクを実行します。

[**Azure Front Door**][AFD] は、Microsoft のスケーラブルな高可用性 Web アプリケーション アクセラレーション プラットフォーム、グローバル HTTP ロード バランサー、アプリケーション保護、コンテンツ配信ネットワークです。 Front Door は、Microsoft のグローバル ネットワークのエッジの 100 箇所以上で稼働しています。 Front Door を使用して、動的 Web アプリケーションと静的コンテンツを構築、運用、スケールアウトできます。 Front Door は、アプリケーションに次の利点をもたらします。 
* 世界水準のエンドユーザー パフォーマンス
* 統一されたリージョンまたはスタンプのメンテナンスの自動化
* BCDR の自動化
* クライアントまたはユーザー情報の統合 
* キャッシュ 
* サービスの分析情報 このプラットフォームは、パフォーマンス、信頼性、およびサポートの SLA、コンプライアンスの認定、Azure でネイティブに開発、運用、サポートされている監査可能なセキュリティ対策を提供します。

[**Application Gateway**][AppGW] は、アプリケーション デリバリー コントローラー (ADC) をサービスとして提供する専用仮想アプライアンスであり、さまざまなレイヤー 7 負荷分散機能をアプリケーションで利用できるようにします。 CPU を集中的に使用する SSL 終了を Application Gateway インスタンスにオフロードして、Web ファームの生産性を最適化できます。 また、次の例のような他のレイヤー 7 ルーティング機能も提供されます。 
* 受信トラフィックのラウンド ロビン分散。 
* Cookie ベースのセッション アフィニティ。 
* URL パス ベースのルーティング。 
* 1 つの Application Gateway インスタンスの背後で複数の Web サイトをホストする機能。 Application Gateway WAF SKU の一部として、Web アプリケーション ファイアウォール (WAF) も提供されます。 この SKU は、一般的な Web の脆弱性や悪用から Web アプリケーションを保護します。 Application Gateway は、インターネット接続ゲートウェイ、内部専用ゲートウェイ、またはこの両方の組み合わせとして構成できます。 

[**パブリック IP**][PIP]。 Azure の一部の機能を使用すると、サービス エンドポイントをパブリック IP アドレスに関連付けることができるので、インターネットからリソースにアクセスできます。 このエンドポイントでは、ネットワーク アドレス変換 (NAT) を使用して、Azure 仮想ネットワーク上の内部アドレスとポートにトラフィックをルーティングします。 これは、外部トラフィックが仮想ネットワークに到達するための主な経路です。 パブリック IP アドレスを構成することで、仮想ネットワークに渡されるトラフィックと、そのトラフィックが仮想ネットワークのどこでどのように変換されるのかを決定することができます。

[**Azure DDoS Protection Standard**][DDOS] は、[Basic サービス][DDOS] レベルに加えて、特に Azure Virtual Network リソースに対してチューニングされた追加の軽減機能を提供します。 DDoS Protection Standard の有効化は簡単であり、アプリケーションの変更は不要です。 保護ポリシーは、専用のトラフィック監視および機械学習アルゴリズムによってチューニングされます。 ポリシーは、仮想ネットワークにデプロイされたリソースに関連付けられているパブリック IP アドレスに適用されます。 リソースの例として、Azure Load Balancer、Azure Application Gateway、Azure Service Fabric のインスタンスがあります。 攻撃中および履歴の表示のために、Azure Monitor ビューからリアルタイムのテレメトリを使用できます。 アプリケーション レイヤー保護は、Azure Application Gateway Web アプリケーション ファイアウォールによって追加できます。 IPv4 の Azure パブリック IP アドレスに対して保護が提供されます。

#### <a name="component-type-monitoring"></a>コンポーネントの種類: 監視
監視コンポーネントは、他のすべてのコンポーネントの種類からの可視性とアラートを提供します。 すべてのチームは、アクセスできるコンポーネントとサービスに対する監視にアクセスできる必要があります。 一元化されたヘルプ デスク チームまたは運用チームには、これらのコンポーネントによって提供されるデータへの統合アクセスが必要です。

Azure では、Azure がホストするリソースの動作を追跡するために、さまざまな種類のログ サービスと監視サービスが提供されています。 Azure でのワークロードのガバナンスと制御は、ログ データの収集だけでなく、報告された特定のイベントに基づいてアクションをトリガーする機能にも基づいています。

[**Azure Monitor**][Monitor]。 Azure には、監視領域において特定の役割やタスクを個別に実行するサービスが複数用意されています。 また、これらのサービスが組み合わされた包括的なソリューションを使用すれば、アプリケーションやそれらのサービスを支える Azure リソースからテレメトリを収集、分析し、それに基づいて対処できます。 また、オンプレミスの重要なリソースを監視して、ハイブリッド監視環境を構築することもできます。 アプリケーションの包括的な監視戦略を策定するための最初のステップは、利用可能なツールとデータの把握です。

Azure の主要なログの種類は次の 2 つです。

-   [Azure アクティビティ ログ][ActLog] (以前の名称は**操作ログ**) では、Azure サブスクリプションのリソースに対して実行された操作を把握できます。 これらのログは、サブスクリプションのコントロールプレーン イベントを報告します。 すべての Azure リソースで監査ログが生成されます。

-   [Azure Monitor 診断ログ][DiagLog]は、リソースによって生成されるログであり、そのリソースの操作に関する豊富なデータを提供します。 これらのログの内容は、リソースの種類によって異なります。

[![9]][9]

VDC では、NSG ログの特に次の情報を追跡することが重要です。

-   [イベント ログ][NSGLog]: MAC アドレスに基づいて VM とインスタンス ロールに適用される NSG ルールに関する情報が提供されます。
-   [カウンター ログ][NSGLog]: トラフィックを拒否または許可するために各 NSG ルールが実行された回数を追跡します。

監査、スタティック分析、またはバックアップのために、すべてのログを Azure ストレージ アカウントに保存できます。 Azure ストレージ アカウントにログを保存すると、さまざまな種類のフレームワークを使用してこのデータを取得、準備、分析、視覚化し、クラウド リソースの状態と正常性を報告できます。 

大企業では、オンプレミス システムの監視用に標準的なフレームワークを既に利用していると考えられます。 そのフレームワークを拡張して、クラウド デプロイによって生成されたログを統合できます。 組織では、[Azure Log Analytics][https://docs.microsoft.com/en-us/azure/log-analytics/log-analytics-queries] を使用して、すべてのログをクラウドに保持できます。 Log Analytics は、クラウドベースのサービスとして実装されます。 そのため、インフラストラクチャ サービスへの投資を最小限に抑えて、このサービスをすぐに稼働させることができます。 Log Analytics は、System Center Operations Manager などの System Center のコンポーネントと統合して、管理のための既存の投資をクラウドに拡張することもできます。 

Log Analytics は、オペレーティング システム、アプリケーション、インフラストラクチャ クラウド コンポーネントによって生成されたログおよびパフォーマンス データを収集、関連付け、検索、操作するための、Azure のサービスです。 統合された検索およびカスタム ダッシュボードを使用して、VDC のすべてのワークロードのすべてのレコードを分析することで、リアルタイムの運用分析情報が提供されます。

[Azure Network Watcher][NetWatch] は、Azure 仮想ネットワーク内のリソースの監視、診断、メトリックの表示、ログの有効化/無効化を行うツールを提供します。 これは、次のような機能を提供する多面的なサービスです。
-    仮想マシンとエンドポイント間の通信を監視する。
-    仮想ネットワーク内のリソースとそれらの関係を表示する。
-    VM との間で発生するネットワーク トラフィック フィルターの問題を診断する。
-    VM からのネットワーク ルーティングの問題を診断する。
-    VM からの送信接続を診断する。
-    VM との間のパケットをキャプチャする。
-    Azure 仮想ネットワーク ゲートウェイと接続に関する問題を診断する。
-    Azure リージョンとインターネット サービス プロバイダー間の相対待ち時間を確認する。
-    ネットワーク インターフェイスのセキュリティ規則を表示する。
-    ネットワーク メトリックを表示する。
-    ネットワーク セキュリティ グループとの間のトラフィックを分析する。
-    ネットワーク リソースの診断ログを表示する。

Operations Management Suite 内の [Network Performance Monitor][NPM] ソリューションは、ネットワークの詳細情報をエンド ツー エンドで提供できます。 この情報には、Azure ネットワークとオンプレミス ネットワークの単一ビューが含まれます。 このソリューションには、ExpressRoute とパブリック サービスの固有のモニターがあります。

#### <a name="component-type-workloads"></a>コンポーネントの種類: ワークロード
ワークロード コンポーネントは、実際のアプリケーションとサービスが存在する場所です。 また、アプリケーション開発チームが時間の大半を費やす部分でもあります。

ワークロードの可能性は無限です。 次に示すのは可能なワークロードの種類のほんの一部です。

**内部基幹業務アプリケーション**は、企業の継続的な運営に不可欠なコンピューター アプリケーションです。 基幹業務アプリケーションには、次のような共通の特性があります。

-   **本質的に対話型** -  データを入力すると、結果またはレポートが返されます。
-   **データ ドリブン** - データベースや他のストレージに頻繁にアクセスするデータ集約型です。
-   **統合型** - 組織の内外の他のシステムと統合されます。

**顧客向け Web サイト (インターネットまたは内部接続)**。 インターネットと対話するほとんどのアプリケーションは Web サイトです。 Azure では、IaaS VM 上または [Microsoft Azure App Service サイト (PaaS) の Web Apps 機能][WebApps]から Web サイトを実行できます。 Web Apps では仮想ネットワークとの統合がサポートされており、VDC のスポークに Web Apps をデプロイできます。 社内向け Web サイトの場合、仮想ネットワーク統合では、アプリケーション用にインターネット エンドポイントを公開する必要はありません。 代わりに、プライベート仮想ネットワークから、インターネットでルーティングできないプライベート アドレス経由でリソースを使用できます。

**ビッグ データと分析**。 データを膨大な量に拡張する必要があるときに、データベースが適切にスケールアップされない場合があります。 Apache Hadoop テクノロジは、多数のノードで分散クエリを並列実行するシステムを提供します。 データ ワークロードは、IaaS VM または PaaS ([Azure HDInsight][HDI]) で実行できます。 HDInsight では、場所ベースの仮想ネットワークへのデプロイがサポートされています。 VDC のスポーク内のクラスターにデプロイできます。

**イベントとメッセージング**。 [Azure Event Hubs][EventHubs] は、数百万のイベントを収集、変換、保存する、ハイパースケールのテレメトリ インジェスト サービスです。 分散型ストリーミング プラットフォームとして、遅延時間が短く、保持時間を構成できます。 そのため、膨大な量のテレメトリを Azure に取り込み、そのデータを複数のアプリケーションから読み取ることができます。 Event Hubs では、1 つのストリームでリアルタイム パイプラインとバッチ ベースのパイプラインの両方をサポートできます。

[Azure Service Bus][ServiceBus] により、アプリケーションとサービス間に信頼性の高いクラウド メッセージング サービスを実装できます。 Azure Service Bus は、クライアントとサーバー間の非同期のブローカー メッセージング、構造化された先入れ先出し (FIFO) メッセージング、および発行機能とサブスクライブ機能を提供します。

[![10]][10]

### <a name="multiple-vdc-implementations"></a>複数の VDC 実装


単一 VDC は単一リージョン内でホストされます。 そのため、そのリージョン全体に影響を及ぼす可能性のある大規模な停止に対して脆弱です。 高い SLA の実現を望むお客様は、異なるリージョンに配置された 2 つ以上の VDC 実装に同じプロジェクトをデプロイして、サービスを保護する必要があります。

SLA の問題に加え、複数の VDC 実装をデプロイすることに意味がある一般的なシナリオがいくつかあります。

-   リージョンまたはグローバル プレゼンス
-   ディザスター リカバリー
-   データセンター間でトラフィックを転送するメカニズム

#### <a name="regional-and-global-presence"></a>リージョンおよびグローバル プレゼンス
Azure データセンターは世界中の多数のリージョンに存在します。 複数の Azure データセンターを選択するときは、地理的な距離と待機時間の 2 つの関連要素を考慮する必要があります。 最良のユーザー エクスペリエンスを提供するには、VDC 実装間の地理的な距離と、VDC 実装とエンド ユーザー間の距離を評価する必要があります。

また、VDC 実装がホストされている Azure リージョンは、組織が運営されている法的管轄によって定められた規制要件に準拠している必要があります。

#### <a name="disaster-recovery"></a>障害復旧
ディザスター リカバリー計画の実装は、関連するワークロードの種類と、さまざまな VDC 実装間でワークロードの状態を同期する機能に関係します。 ほとんどのお客様は、2 つの異なる VDC 実装で実行されるデプロイ間でアプリケーション データを同期して、高速フェールオーバー メカニズムを実装することを望んでいます。 ほとんどのアプリケーションは待機時間の影響を受けやすく、データ同期がタイムアウトしたり遅延する可能性があります。

異なる VDC 実装内のアプリケーションの同期またはハートビート監視には、VDC 実装間の通信が必要です。 異なるリージョンの 2 つの VDC 実装は、次の方法で接続できます。

-   仮想ネットワーク ピアリングでは、リージョンをまたいでハブを接続できます。
-   ExpressRoute のプライベート ピアリング (VDC ハブが同じ ExpressRoute 回線に接続されている場合)。
-   企業バックボーン経由で接続されている複数の ExpressRoute 回線と、ExpressRoute 回線に接続された VDC メッシュ。
-   各 Azure リージョンの VDC ハブ間のサイト間 VPN 接続。

Microsoft バックボーンを通過する場合、帯域幅が広く、待機時間が一貫しているため、通常は仮想ネットワーク ピアリングまたは ExpressRoute 接続が推奨されるメカニズムです。

異なるリージョンに配置された 2 つ以上の異なる VDC 実装に分散されたアプリケーションを簡単に検証する方法はありません。 ネットワーク認定テストを実行して、接続の待機時間と帯域幅を検証する必要があります。 その後、同期または非同期のどちらのデータ レプリケーションが適切かを判断し、ワークロードに最適な目標復旧時間 (RTO) を決定します。

#### <a name="mechanism-to-divert-traffic-between-datacenters"></a>データセンター間でトラフィックを転送するメカニズム
データセンターで受信したトラフィックを別のデータセンターに転送する効果的な方法の 1 つは、ドメイン ネーム システム (DNS) に基づいています。 [Azure Traffic Manager][TM] では、DNS メカニズムを使用して、エンドユーザー トラフィックを特定の VDC 内の最適なパブリック エンドポイントに転送します。 Traffic Manager では、プローブを使用して、さまざまな VDC 実装内のパブリック エンドポイントのサービスの正常性を定期的に確認します。 それらのエンドポイントで障害が発生した場合は、セカンダリ VDC に自動的にルーティングします。

Traffic Manager は、Azure パブリック エンドポイントで動作します。 たとえば、トラフィックを制御したり、適切な VDC 内の Azure VM と Web Apps にトラフィックを転送したりできます。 Traffic Manager は、Azure リージョン全体の障害が発生しても回復性があります。 複数の条件に基づいて、異なる VDC 実装内のサービス エンドポイントに対するユーザー トラフィックの分散を制御できます。 条件の例として、特定の VDC でのサービスの障害や、クライアントのネットワーク待機時間が最も短い VDC の選択などがあります。

### <a name="conclusion"></a>まとめ
仮想データセンターは、データセンターをクラウドに移行するためのアプローチであり、Azure でスケーラブルなアーキテクチャを作成する機能の組み合わせを使用します。 これにより、クラウド リソースの最大限の活用、コストの削減、システム ガバナンスの簡素化が実現します。 VDC の概念は、ハブで共通の共有サービスを提供するハブ スポーク トポロジに基づいています。 スポークで特定のアプリケーションやワークロードを実行できます。 VDC は、さまざまな部門 が協力する、会社のロールの構造に対応します。 たとえば、中央 IT、Azure DevOps、運用、メンテナンスなどです。 各部門には、ロールと職務の明確なリストがあります。 VDC の概念は、**リフト アンド シフト**移行の要件を満たします。 ただし、ネイティブなクラウド デプロイにも多くの利点をもたらします。

## <a name="references"></a>参照
この記事で説明した次の機能の詳細をご覧ください。

| | | |
|-|-|-|
|ネットワーク機能|負荷分散|接続|
|[Azure Virtual Network][VNet]</br>[ネットワーク セキュリティ グループ][NSG]</br>[NSG ログ][NSGLog]</br>[ユーザー定義ルート][UDR]</br>[ネットワーク仮想アプライアンス][NVA]</br>[パブリック IP アドレス][PIP]</br>[Azure DDoS Protection][DDOS]</br>[Azure Firewall][AzFW]</br>[Azure DNS][DNS]|[Azure Front Door][AFD]</br>[Azure Load Balancer (L3)][ALB]</br>[Application Gateway (L7)][AppGW]</br>[Web アプリケーション ファイアウォール][WAF]</br>[Azure Traffic Manager][TM]</br></br></br></br></br> |[仮想ネットワーク ピアリング][VNetPeering]</br>[仮想プライベート ネットワーク][VPN]</br>[Virtual WAN][vWAN]</br>[ExpressRoute][ExR]</br>[ExpressRoute Direct][ExRD]</br></br></br></br></br>
|ID</br>|監視</br>|ベスト プラクティス</br>|
|[Azure Active Directory][AAD]</br>[Multi-Factor Authentication][MFA]</br>[ロールベースのアクセス制御][RBAC]</br>[既定の Azure AD ロール][Roles]</br></br></br> |[Network Watcher][NetWatch]</br>[Azure Monitor][Monitor]</br>[アクティビティ ログ][ActLog]</br>[診断ログの監視][DiagLog]</br>[Microsoft Operations Management Suite][OMS]</br>[Network Performance Monitor][NPM]|[境界ネットワークのベスト プラクティス][DMZ]</br>[サブスクリプション管理][SubMgmt]</br>[リソース グループ管理][RGMgmt]</br>[Azure サブスクリプションの制限][Limits] </br></br></br>|
|他の Azure サービス|
|[Web Apps][WebApps]</br>[HDInsight (Hadoop)][HDI]</br>[Event Hubs][EventHubs]</br>[Service Bus][ServiceBus]|

## <a name="next-steps"></a>次の手順
 - VDC のハブとスポークの設計の基礎となるテクノロジである[仮想ネットワーク ピアリング][VNetPeering]の詳細を確認します。
 - [Azure AD][AAD] を実装して [RBAC][RBAC] の調査を始めます。
 - 組織の構造、要件、ポリシーに対応する、サブスクリプションおよびリソース管理モデルと RBAC モデルを開発します。 最も重要なアクティビティは計画です。 再編成、合併、新しい製品ライン、その他の可能性について、できるだけ実用的な計画を立ててください。

<!--Image References-->
[0]: ./images/networking-redundant-equipment.png "コンポーネントのオーバーラップの例" 
[1]: ./images/networking-vdc-high-level.png "ハブとスポークの VDC の高度な例"
[2]: ./images/networking-hub-spokes-cluster.png "ハブとスポークのクラスター"
[3]: ./images/networking-spoke-to-spoke.png "スポーク間"
[4]: ./images/networking-vdc-block-level-diagram.png "VDC のブロック レベルの図"
[5]: ./images/networking-users-groups-subsciptions.png "ユーザー、グループ、サブスクリプション、プロジェクト"
[6]: ./images/networking-infrastructure-high-level.png "インフラストラクチャの概要図"
[7]: ./images/networking-highlevel-perimeter-networks.png "インフラストラクチャの概要図"
[8]: ./images/networking-vnet-peering-perimeter-neworks.png "VNet ピアリングと境界ネットワーク"
[9]: ./images/networking-high-level-diagram-monitoring.png "監視の概要図"
[10]: ./images/networking-high-level-workloads.png "ワークロードの概要図"

<!--Link References-->
[Limits]: /azure/azure-subscription-service-limits
[Roles]: /azure/role-based-access-control/built-in-roles
[VNet]: /azure/virtual-network/virtual-networks-overview
[NSG]: /azure/virtual-network/virtual-networks-nsg
[DNS]: /azure/dns/dns-overview
[PrivateDNS]: /azure/dns/private-dns-overview
[VNetPeering]: /azure/virtual-network/virtual-network-peering-overview 
[UDR]: /azure/virtual-network/virtual-networks-udr-overview 
[RBAC]: /azure/role-based-access-control/overview
[MFA]: /azure/multi-factor-authentication/multi-factor-authentication
[AAD]: /azure/active-directory/active-directory-whatis
[VPN]: /azure/vpn-gateway/vpn-gateway-about-vpngateways 
[ExR]: /azure/expressroute/expressroute-introduction
[ExRD]: https://docs.microsoft.com/en-us/azure/expressroute/expressroute-erdirect-about
[vWAN]: /azure/virtual-wan/virtual-wan-about
[NVA]: /azure/architecture/reference-architectures/dmz/nva-ha
[AzFW]: /azure/firewall/overview
[SubMgmt]: /azure/architecture/cloud-adoption/appendix/azure-scaffold 
[RGMgmt]: /azure/azure-resource-manager/resource-group-overview
[DMZ]: /azure/best-practices-network-security
[ALB]: /azure/load-balancer/load-balancer-overview
[DDOS]: /azure/virtual-network/ddos-protection-overview
[PIP]: /azure/virtual-network/resource-groups-networking#public-ip-address
[AFD]: https://docs.microsoft.com/en-us/azure/frontdoor/front-door-overview
[AppGW]: /azure/application-gateway/application-gateway-introduction
[WAF]: /azure/application-gateway/application-gateway-web-application-firewall-overview
[Monitor]: /azure/monitoring-and-diagnostics/
[ActLog]: /azure/monitoring-and-diagnostics/monitoring-overview-activity-logs 
[DiagLog]: /azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs
[NSGLog]: /azure/virtual-network/virtual-network-nsg-manage-log
[OMS]: /azure/operations-management-suite/operations-management-suite-overview
[NPM]: /azure/log-analytics/log-analytics-network-performance-monitor
[NetWatch]: /azure/network-watcher/network-watcher-monitoring-overview
[WebApps]: /azure/app-service/
[HDI]: /azure/hdinsight/hdinsight-hadoop-introduction
[EventHubs]: /azure/event-hubs/event-hubs-what-is-event-hubs 
[ServiceBus]: /azure/service-bus-messaging/service-bus-messaging-overview
[TM]: /azure/traffic-manager/traffic-manager-overview

