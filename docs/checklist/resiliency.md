---
title: "回復性のチェックリスト"
description: "設計時の回復性に関する問題のガイダンスを提供するチェックリスト。"
author: petertaylor9999
ms.date: 01/10/2018
ms.custom: resiliency, checklist
ms.openlocfilehash: 66ff802c1f7b35db147ffe4279982c827570c3c1
ms.sourcegitcommit: 3d6dba524cc7661740bdbaf43870de7728d60a01
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/11/2018
---
# <a name="resiliency-checklist"></a><span data-ttu-id="ef4e4-103">回復性のチェックリスト</span><span class="sxs-lookup"><span data-stu-id="ef4e4-103">Resiliency checklist</span></span>

<span data-ttu-id="ef4e4-104">回復性とは、障害から回復して引き続き機能するシステムの能力であり、[ソフトウェア品質の重要な要素](../guide/pillars.md)の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-104">Resiliency is the ability of a system to recover from failures and continue to function, and is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="ef4e4-105">回復性のあるアプリケーションを設計するには、発生する可能性のあるさまざまな障害モードに対して計画し、障害を緩和する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-105">Designing your application for resiliency requires planning for and mitigating a variety of failure modes that could occur.</span></span> <span data-ttu-id="ef4e4-106">このチェックリストを使用して、回復性の観点からアプリケーション アーキテクチャを見直します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-106">Use this checklist to review your application architecture from a resiliency standpoint.</span></span> 

## <a name="requirements"></a><span data-ttu-id="ef4e4-107">必要条件</span><span class="sxs-lookup"><span data-stu-id="ef4e4-107">Requirements</span></span>

<span data-ttu-id="ef4e4-108">**顧客の可用性の要件を定義します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-108">**Define your customer's availability requirements.**</span></span> <span data-ttu-id="ef4e4-109">顧客にはアプリケーションのコンポーネントに対する可用性の要件があり、それがアプリケーションの設計に影響します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-109">Your customer will have availability requirements for the components in your application and this will affect your application's design.</span></span> <span data-ttu-id="ef4e4-110">アプリケーションの各部分の可用性のターゲットについて、顧客の同意を得てください。そうしないと、設計が顧客の期待に添わないものになる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-110">Get agreement from your customer for the availability targets of each piece of your application, otherwise your design may not meet the customer's expectations.</span></span> <span data-ttu-id="ef4e4-111">詳細については、「[回復性の要件を定義する](../resiliency/index.md#defining-your-resiliency-requirements)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-111">For more information, see [Defining your resiliency requirements](../resiliency/index.md#defining-your-resiliency-requirements).</span></span>

## <a name="application-design"></a><span data-ttu-id="ef4e4-112">アプリケーションの設計</span><span class="sxs-lookup"><span data-stu-id="ef4e4-112">Application Design</span></span>

<span data-ttu-id="ef4e4-113">**アプリケーションの障害モード分析 (FMA) を実行します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-113">**Perform a failure mode analysis (FMA) for your application.**</span></span> <span data-ttu-id="ef4e4-114">FMA は、設計の初期段階でアプリケーションに回復性を構築するためのプロセスです。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-114">FMA is a process for building resiliency into an application early in the design stage.</span></span> <span data-ttu-id="ef4e4-115">詳細については、「[障害モードの分析][fma]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-115">For more information, see [Failure mode analysis][fma].</span></span> <span data-ttu-id="ef4e4-116">FMA の目標は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-116">The goals of an FMA include:</span></span>  

* <span data-ttu-id="ef4e4-117">アプリケーションで発生する可能性がある障害のタイプを特定する。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-117">Identify what types of failures an application might experience.</span></span>
* <span data-ttu-id="ef4e4-118">アプリケーションの各タイプの障害による潜在的な作用と影響を把握する。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-118">Capture the potential effects and impact of each type of failure on the application.</span></span>
* <span data-ttu-id="ef4e4-119">復旧戦略を特定する。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-119">Identify recovery strategies.</span></span>
  

<span data-ttu-id="ef4e4-120">**複数のインスタンスのサービスをデプロイします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-120">**Deploy multiple instances of services.**</span></span> <span data-ttu-id="ef4e4-121">アプリケーションがサービスの 1 つのインスタンスに依存する場合は、単一障害点が発生します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-121">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="ef4e4-122">複数のインスタンスをプロビジョニングすると、回復性とスケーラビリティの両方が改善されます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-122">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="ef4e4-123">[Azure App Service](/azure/app-service/app-service-value-prop-what-is/) の場合は、複数のインスタンスを提供する [App Service プラン](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)を選択してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-123">For [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), select an [App Service Plan](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) that offers multiple instances.</span></span> <span data-ttu-id="ef4e4-124">Azure Cloud Services の場合は、[複数インスタンス](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management)を使用するように各ロールを構成してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-124">For Azure Cloud Services, configure each of your roles to use [multiple instances](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management).</span></span> <span data-ttu-id="ef4e4-125">[Azure Virtual Machines (VM)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) の場合は、VM アーキテクチャに 1 つ以上の VM が含まれていることと、[可用性セット][availability-sets]に各 VM が含まれていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-125">For [Azure Virtual Machines (VMs)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), ensure that your VM architecture includes more than one VM and that each VM is included in an [availability set][availability-sets].</span></span>   

<span data-ttu-id="ef4e4-126">**自動スケールを使用して、負荷の増加に対応します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-126">**Use autoscaling to respond to increases in load.**</span></span> <span data-ttu-id="ef4e4-127">負荷が増したとき自動的にスケールアウトするようにアプリケーションが構成されていない場合は、ユーザーの要求で飽和状態になるとアプリケーションのサービスが失敗する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-127">If your application is not configured to scale out automatically as load increases, it's possible that your application's services will fail if they become saturated with user requests.</span></span> <span data-ttu-id="ef4e4-128">詳細については、次をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-128">For more details, see the following:</span></span>

* <span data-ttu-id="ef4e4-129">全般: [スケーラビリティのチェックリスト](./scalability.md)</span><span class="sxs-lookup"><span data-stu-id="ef4e4-129">General: [Scalability checklist](./scalability.md)</span></span>
* <span data-ttu-id="ef4e4-130">Azure App Service: [手動または自動によるインスタンス数のスケール変更][app-service-autoscale]</span><span class="sxs-lookup"><span data-stu-id="ef4e4-130">Azure App Service: [Scale instance count manually or automatically][app-service-autoscale]</span></span>
* <span data-ttu-id="ef4e4-131">Cloud Services: [クラウド サービスの自動スケールの方法][cloud-service-autoscale]</span><span class="sxs-lookup"><span data-stu-id="ef4e4-131">Cloud Services: [How to auto scale a cloud service][cloud-service-autoscale]</span></span>
* <span data-ttu-id="ef4e4-132">仮想マシン: [自動スケールと仮想マシン スケール セット][vmss-autoscale]</span><span class="sxs-lookup"><span data-stu-id="ef4e4-132">Virtual Machines: [Automatic scaling and virtual machine scale sets][vmss-autoscale]</span></span>

<span data-ttu-id="ef4e4-133">**負荷分散を使用して要求を分散します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-133">**Use load balancing to distribute requests.**</span></span> <span data-ttu-id="ef4e4-134">負荷分散は、正常でないインスタンスをローテーションから除去することで、アプリケーションの要求を正常なサービス インスタンスに分散します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-134">Load balancing distributes your application's requests to healthy service instances by removing unhealthy instances from rotation.</span></span> <span data-ttu-id="ef4e4-135">サービスが Azure App Service または Azure Cloud Services を使用している場合は、既に負荷が分散されています。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-135">If your service uses Azure App Service or Azure Cloud Services, it is already load balanced for you.</span></span> <span data-ttu-id="ef4e4-136">ただし、アプリケーションが Azure VM を使用している場合は、ロード バランサーをプロビジョニングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-136">However, if your application uses Azure VMs, you will need to provision a load balancer.</span></span> <span data-ttu-id="ef4e4-137">詳細については、「[Azure Load Balancer ](/azure/load-balancer/load-balancer-overview/)の概要」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-137">See the [Azure Load Balancer](/azure/load-balancer/load-balancer-overview/) overview for more details.</span></span>

<span data-ttu-id="ef4e4-138">**複数のインスタンスを使用するように Azure Application Gateway を構成します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-138">**Configure Azure Application Gateways to use multiple instances.**</span></span> <span data-ttu-id="ef4e4-139">アプリケーションの要件によっては、アプリケーションのサービスに対する要求の分散には、[Azure Application Gateway](/azure/application-gateway/application-gateway-introduction/) のほうが適している場合があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-139">Depending on your application's requirements, an [Azure Application Gateway](/azure/application-gateway/application-gateway-introduction/) may be better suited to distributing requests to your application's services.</span></span> <span data-ttu-id="ef4e4-140">ただし、Application Gateway サービスの単一インスタンスは SLA によって保証されないため、Application Gateway のインスタンスが失敗した場合はアプリケーションが失敗する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-140">However, single instances of the Application Gateway service are not guaranteed by an SLA so it's possible that your application could fail if the Application Gateway instance fails.</span></span> <span data-ttu-id="ef4e4-141">[SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/) の条件に基づいてサービスの可用性を保証するには、複数の中規模または大規模の Application Gateway インスタンスをプロビジョニングしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-141">Provision more than one medium or larger Application Gateway instance to guarantee availability of the service under the terms of the [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/).</span></span>

<span data-ttu-id="ef4e4-142">**アプリケーション層ごとの可用性セットを使用します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-142">**Use Availability Sets for each application tier.**</span></span> <span data-ttu-id="ef4e4-143">[可用性セット][availability-sets]にインスタンスを配置すると、[SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) がより高くなります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-143">Placing your instances in an [availability set][availability-sets] provides a higher [SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/).</span></span> 

<span data-ttu-id="ef4e4-144">**アプリケーションを複数のリージョンにデプロイすることを検討します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-144">**Consider deploying your application across multiple regions.**</span></span> <span data-ttu-id="ef4e4-145">アプリケーションが 1 つのリージョンにデプロイされている場合は、まれにリージョン全体が使用できなくなった場合に、アプリケーションも使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-145">If your application is deployed to a single region, in the rare event the entire region becomes unavailable, your application will also be unavailable.</span></span> <span data-ttu-id="ef4e4-146">これは、アプリケーションの SLA の条件の下では許容できないことがあります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-146">This may be unacceptable under the terms of your application's SLA.</span></span> <span data-ttu-id="ef4e4-147">その場合は、アプリケーションとそのサービスを複数のリージョンにデプロイすることを検討してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-147">If so, consider deploying your application and its services across multiple regions.</span></span> <span data-ttu-id="ef4e4-148">複数のリージョンのデプロイでは、アクティブ/アクティブ パターン (複数のアクティブなインスタンスに要求を分散する) またはアクティブ/パッシブ パターン (プライマリ インスタンスが失敗した場合に備えて「ウォーム」インスタンスを保持する) を使用できます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-148">A multi-region deployment can use an active-active pattern (distributing requests across multiple active instances) or an active-passive pattern (keeping a "warm" instance in reserve, in case the primary instance fails).</span></span> <span data-ttu-id="ef4e4-149">アプリケーションのサービスの複数のインスタンスを、リージョンのペアにデプロイすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-149">We recommend that you deploy multiple instances of your application's services across regional pairs.</span></span> <span data-ttu-id="ef4e4-150">詳しくは、「[ビジネス継続性とディザスター リカバリー (BCDR): Azure のペアになっているリージョン](/azure/best-practices-availability-paired-regions)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-150">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions).</span></span>

<span data-ttu-id="ef4e4-151">**Azure Traffic Manager を使用して、アプリケーションのトラフィックをさまざまなリージョンにルーティングします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-151">**Use Azure Traffic Manager to route your application's traffic to different regions.**</span></span>  <span data-ttu-id="ef4e4-152">[Azure Traffic Manager][traffic-manager] は負荷分散を DNS レベルで実行し、指定した[トラフィック ルーティング][traffic-manager-routing]の方法とアプリケーションのエンドポイントの正常性に基づいてさまざまなリージョンにトラフィックをルーティングします。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-152">[Azure Traffic Manager][traffic-manager] performs load balancing at the DNS level and will route traffic to different regions based on the [traffic routing][traffic-manager-routing] method you specify and the health of your application's endpoints.</span></span> <span data-ttu-id="ef4e4-153">Traffic Manager を使用しない場合、デプロイできるのは 1 つのリージョンに制限され、それによってスケールが制限され、一部のユーザーに待機時間が増加し、リージョン全体のサービスが停止した場合にアプリケーションのダウンタイムが発生します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-153">Without Traffic Manager, you are limited to a single region for your deployment, which limits scale, increases latency for some users, and causes application downtime in the case of a region-wide service disruption.</span></span>

<span data-ttu-id="ef4e4-154">**ロード バランサーとトラフィック マネージャーの正常性プローブを構成し、テストします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-154">**Configure and test health probes for your load balancers and traffic managers.**</span></span> <span data-ttu-id="ef4e4-155">必ず、正常性のロジックがシステムの重要な部分をチェックし、正常性プローブに適切に応答するようにしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-155">Ensure that your health logic checks the critical parts of the system and responds appropriately to health probes.</span></span>

* <span data-ttu-id="ef4e4-156">[Azure Traffic Manager][traffic-manager] と [Azure Load Balancer][load-balancer] の正常性プローブは特定の機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-156">The health probes for [Azure Traffic Manager][traffic-manager] and [Azure Load Balancer][load-balancer] serve a specific function.</span></span> <span data-ttu-id="ef4e4-157">Traffic Manager の場合、正常性プローブは別のリージョンにフェールオーバーするかどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-157">For Traffic Manager, the health probe determines whether to fail over to another region.</span></span> <span data-ttu-id="ef4e4-158">ロード バランサーの場合は、VM をローテーションから除去するかどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-158">For a load balancer, it determines whether to remove a VM from rotation.</span></span>      
* <span data-ttu-id="ef4e4-159">Traffic Manager プローブでは、正常性エンドポイントが同じリージョン内にデプロイされている重要な依存関を確認し、その障害が別のリージョンへのフェールオーバーをトリガーします。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-159">For a Traffic Manager probe, your health endpoint should check any critical dependencies that are deployed within the same region, and whose failure should trigger a failover to another region.</span></span>  
* <span data-ttu-id="ef4e4-160">ロード バランサーでは、正常性エンドポイントが VM の正常性をレポートします。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-160">For a load balancer, the health endpoint should report the health of the VM.</span></span> <span data-ttu-id="ef4e4-161">その他の階層または外部サービスを含めないでください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-161">Don't include other tiers or external services.</span></span> <span data-ttu-id="ef4e4-162">そうしないと、VM の外部で発生する障害によってロード バランサーがローテーションから VM を除去することになります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-162">Otherwise, a failure that occurs outside the VM will cause the load balancer to remove the VM from rotation.</span></span>
* <span data-ttu-id="ef4e4-163">アプリケーションに正常性の監視を実装する方法については、「[正常性エンドポイント監視パターン](https://msdn.microsoft.com/library/dn589789.aspx)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-163">For guidance on implementing health monitoring in your application, see [Health Endpoint Monitoring Pattern](https://msdn.microsoft.com/library/dn589789.aspx).</span></span>

<span data-ttu-id="ef4e4-164">**サード パーティーのサービスを監視します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-164">**Monitor third-party services.**</span></span> <span data-ttu-id="ef4e4-165">アプリケーションがサード パーティーのサービスに依存している場合は、それらのサード パーティーのサービスがどこでどのように失敗する可能性があるのかと、それらの障害がアプリケーションにどのような影響を与えるかを特定してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-165">If your application has dependencies on third-party services, identify where and how these third-party services can fail and what effect those failures will have on your application.</span></span> <span data-ttu-id="ef4e4-166">サード パーティーのサービスには監視と診断が含まれていないことがあるため、それらの呼び出しをログに記録し、一意の識別子を使用してアプリケーションの正常性と診断のログと関連付けることが重要です。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-166">A third-party service may not include monitoring and diagnostics, so it's important to log your invocations of them and correlate them with your application's health and diagnostic logging using a unique identifier.</span></span> <span data-ttu-id="ef4e4-167">監視と診断の実証された方法については、「[監査と診断のガイダンス][monitoring-and-diagnostics-guidance]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-167">For more information on proven practices for monitoring and diagnostics, see [Monitoring and Diagnostics guidance][monitoring-and-diagnostics-guidance].</span></span>

<span data-ttu-id="ef4e4-168">**使用するサード パーティーのサービスが SLA が提供することを確認します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-168">**Ensure that any third-party service you consume provides an SLA.**</span></span> <span data-ttu-id="ef4e4-169">アプリケーションがサード パーティーのサービスに依存していても、サード パーティーが SLA の形式での可用性を保証していない場合は、アプリケーションの可用性も保証できません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-169">If your application depends on a third-party service, but the third party provides no guarantee of availability in the form of an SLA, your application's availability also cannot be guaranteed.</span></span> <span data-ttu-id="ef4e4-170">SLA はアプリケーションの最小限使用可能なコンポーネントと同程度しかありません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-170">Your SLA is only as good as the least available component of your application.</span></span>

<span data-ttu-id="ef4e4-171">**必要に応じてリモート操作用の回復性のパターンを実装します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-171">**Implement resiliency patterns for remote operations where appropriate.**</span></span> <span data-ttu-id="ef4e4-172">アプリケーションがリモート サービス間の通信に依存する場合は、[再試行パターン][retry-pattern]や[サーキット ブレーカー パターン][circuit-breaker]などの一時的な障害に対処する設計パターンに従ってください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-172">If your application depends on communication between remote services, follow design patterns for dealing with transient failures, such as [Retry Pattern][retry-pattern], and [Circuit Breaker Pattern][circuit-breaker].</span></span> <span data-ttu-id="ef4e4-173">詳細については、「[回復性戦略](../resiliency/index.md#resiliency-strategies)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-173">For more information, see [Resiliency strategies](../resiliency/index.md#resiliency-strategies).</span></span>

<span data-ttu-id="ef4e4-174">**可能な限り、非同期操作を実装します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-174">**Implement asynchronous operations whenever possible.**</span></span> <span data-ttu-id="ef4e4-175">同期操作は、呼び出し元がプロセスの完了を待機している間はリソースを独占でき、その他の操作をブロックすることができます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-175">Synchronous operations can monopolize resources and block other operations while the caller waits for the process to complete.</span></span> <span data-ttu-id="ef4e4-176">アプリケーションの各部分を、可能な限り非同期操作を許可するよう設計してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-176">Design each part of your application to allow for asynchronous operations whenever possible.</span></span> <span data-ttu-id="ef4e4-177">C# での非同期プログラミングの実装方法の詳細については、「[Async および Await を使用した非同期プログラミング][asynchronous-c-sharp]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-177">For more information on how to implement asynchronous programming in C#, see [Asynchronous Programming with async and await][asynchronous-c-sharp].</span></span>

## <a name="data-management"></a><span data-ttu-id="ef4e4-178">[データ管理]</span><span class="sxs-lookup"><span data-stu-id="ef4e4-178">Data management</span></span>

<span data-ttu-id="ef4e4-179">**アプリケーションのデータ ソースのレプリケーション方法を理解します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-179">**Understand the replication methods for your application's data sources.**</span></span> <span data-ttu-id="ef4e4-180">アプリケーション データは、さまざまなデータ ソースに格納され、さまざまな可用性の要件を持ちます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-180">Your application data will be stored in different data sources and have different availability requirements.</span></span> <span data-ttu-id="ef4e4-181">アプリケーションのデータ要件が確実に満たされるようにする [Azure Storage のレプリケーション](/azure/storage/storage-redundancy/)や [SQL Database のアクティブ geo レプリケーション](/azure/sql-database/sql-database-geo-replication-overview/)など、Azure のデータ ストレージの種類ごとにレプリケーションの方法を評価してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-181">Evaluate the replication methods for each type of data storage in Azure, including [Azure Storage Replication](/azure/storage/storage-redundancy/) and [SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/) to ensure that your application's data requirements are satisfied.</span></span>

<span data-ttu-id="ef4e4-182">**1 つのユーザー アカウントで運用データとバックアップ データの両方にアクセスできることがないようにします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-182">**Ensure that no single user account has access to both production and backup data.**</span></span> <span data-ttu-id="ef4e4-183">1 つのユーザー アカウントに運用とバックアップの両方のソースの両方に書き込みアクセス許可があると、データのバックアップが侵害されます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-183">Your data backups are compromised if one single user account has permission to write to both production and backup sources.</span></span> <span data-ttu-id="ef4e4-184">悪意のあるユーザーはすべてのデータを意図的に削除する可能性があり、正規のユーザーは誤って削除する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-184">A malicious user could purposely delete all your data, while a regular user could accidentally delete it.</span></span> <span data-ttu-id="ef4e4-185">各ユーザー アカウントのアクセス許可を制限して、書き込みアクセスを必要とするユーザーのみが書き込みアクセス権を持ち、それが運用環境とバックアップの両方ではなくどちらかに対するもののみになるように、アプリケーションを設計してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-185">Design your application to limit the permissions of each user account so that only the users that require write access have write access and it's only to either production or backup, but not both.</span></span>

<span data-ttu-id="ef4e4-186">**データ ソースのフェールオーバーおよびフェールバックのプロセスを文書化し、それをテストします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-186">**Document your data source fail over and fail back process and test it.**</span></span> <span data-ttu-id="ef4e4-187">データ ソースに致命的な障害が発生した場合、オペレーターは、文書化されている手順に従って新しいデータ ソースにフェールオーバーする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-187">In the case where your data source fails catastrophically, a human operator will have to follow a set of documented instructions to fail over to a new data source.</span></span> <span data-ttu-id="ef4e4-188">文書化されている手順に誤りがあると、オペレーターは適切にそれに従うことができず、リソースをフェールオーバーできなくなります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-188">If the documented steps have errors, an operator will not be able to successfully follow them and fail over the resource.</span></span> <span data-ttu-id="ef4e4-189">手順を定期的にテストして、手順に従うオペレーターがフェールオーバーとフェールバックを正常に行えることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-189">Regularly test the instruction steps to verify that an operator following them is able to successfully fail over and fail back the data source.</span></span>

<span data-ttu-id="ef4e4-190">**データのバックアップを検証します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-190">**Validate your data backups.**</span></span> <span data-ttu-id="ef4e4-191">データ整合性、スキーマ、およびクエリを検証するスクリプトを実行することで、バックアップ データが期待どおりのものであることを定期的に確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-191">Regularly verify that your backup data is what you expect by running a script to validate data integrity, schema, and queries.</span></span> <span data-ttu-id="ef4e4-192">データ ソースを復元しても役に立たないのであれば、バックアップがあっても意味がありません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-192">There's no point having a backup if it's not useful to restore your data sources.</span></span> <span data-ttu-id="ef4e4-193">バックアップ サービスを修復できるよう、不一致を記録し、レポートしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-193">Log and report any inconsistencies so the backup service can be repaired.</span></span>

<span data-ttu-id="ef4e4-194">**geo 冗長ストレージ アカウントであるストレージ アカウントの種類を使用することを検討してください。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-194">**Consider using a storage account type that is geo-redundant.**</span></span> <span data-ttu-id="ef4e4-195">Azure Storage アカウントに格納されているデータは、常にローカルでレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-195">Data stored in an Azure Storage account is always replicated locally.</span></span> <span data-ttu-id="ef4e4-196">ただし、ストレージ アカウントをプロビジョニングするときに選択するレプリケーション戦略は複数あります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-196">However, there are multiple replication strategies to choose from when a Storage Account is provisioned.</span></span> <span data-ttu-id="ef4e4-197">まれに発生するリージョン全体が使用できなくなったときに備えてアプリケーション データを保護するには、[Azure の読み取りアクセス geo 冗長ストレージ (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage) を選択してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-197">Select [Azure Read-Access Geo Redundant Storage (RA-GRS)](/azure/storage/storage-redundancy/#read-access-geo-redundant-storage) to protect your application data against the rare case when an entire region becomes unavailable.</span></span>

> [!NOTE]
> <span data-ttu-id="ef4e4-198">VM の場合は、RA-GRS レプリケーションを利用して VM ディスク (VHD ファイル) を復元しないでください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-198">For VMs, do not rely on RA-GRS replication to restore the VM disks (VHD files).</span></span> <span data-ttu-id="ef4e4-199">代わりに、[Azure Backup][azure-backup] を使用してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-199">Instead, use [Azure Backup][azure-backup].</span></span>   
>
>

## <a name="security"></a><span data-ttu-id="ef4e4-200">セキュリティ</span><span class="sxs-lookup"><span data-stu-id="ef4e4-200">Security</span></span>

<span data-ttu-id="ef4e4-201">**分散型サービス拒否 (DDoS) 攻撃に対するアプリケーション レベルの保護を実装します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-201">**Implement application-level protection against distributed denial of service (DDoS) attacks.**</span></span> <span data-ttu-id="ef4e4-202">Azure サービスは、ネットワーク層で DDos 攻撃から保護されます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-202">Azure services are protected against DDos attacks at the network layer.</span></span> <span data-ttu-id="ef4e4-203">ただし、悪意のあるユーザーの要求と本当のユーザーの要求を区別するのは難しいため、Azure ではアプリケーション層の攻撃から保護することができません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-203">However, Azure cannot protect against application-layer attacks, because it is difficult to distinguish between true user requests from malicious user requests.</span></span> <span data-ttu-id="ef4e4-204">アプリケーション層の DDoS 攻撃から保護する方法の詳細については、「[Microsoft Azure のネットワーク セキュリティ](http://download.microsoft.com/download/C/A/3/CA3FC5C0-ECE0-4F87-BF4B-D74064A00846/AzureNetworkSecurity_v3_Feb2015.pdf)」の「DDoS からの保護」のセクション(PDF のダウンロード) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-204">For more information on how to protect against application-layer DDoS attacks, see the "Protecting against DDoS" section of [Microsoft Azure Network Security](http://download.microsoft.com/download/C/A/3/CA3FC5C0-ECE0-4F87-BF4B-D74064A00846/AzureNetworkSecurity_v3_Feb2015.pdf) (PDF download).</span></span>

<span data-ttu-id="ef4e4-205">**アプリケーションのリソースへのアクセスに対する最小限の権限の原則を実装します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-205">**Implement the principle of least privilege for access to the application's resources.**</span></span> <span data-ttu-id="ef4e4-206">アプリケーションのリソースへのアクセスの既定値は、可能な限り制限する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-206">The default for access to the application's resources should be as restrictive as possible.</span></span> <span data-ttu-id="ef4e4-207">承認によって付与する権限のレベルを上げてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-207">Grant higher level permissions on an approval basis.</span></span> <span data-ttu-id="ef4e4-208">アプリケーションのリソースに既定で過度なアクセス権を付与すると、意図的であれ意図せずであれリソースが削除されてしまう可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-208">Granting overly permissive access to your application's resources by default can result in someone purposely or accidentally deleting resources.</span></span> <span data-ttu-id="ef4e4-209">Azure はユーザーのアクセス許可を管理する[ロールベースのアクセス制御](/azure/active-directory/role-based-access-built-in-roles/)を備えていますが、SQL Server などの独自のアクセス許可システムを持つ他のリソースの最小特権のアクセス許可を確認することが重要です。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-209">Azure provides [role-based access control](/azure/active-directory/role-based-access-built-in-roles/) to manage user privileges, but it's important to verify least privilege permissions for other resources that have their own permissions systems such as SQL Server.</span></span>

## <a name="testing"></a><span data-ttu-id="ef4e4-210">テスト</span><span class="sxs-lookup"><span data-stu-id="ef4e4-210">Testing</span></span>

<span data-ttu-id="ef4e4-211">**アプリケーションに対してフェールオーバーとフェールバックのテストを実行します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-211">**Perform failover and failback testing for your application.**</span></span> <span data-ttu-id="ef4e4-212">フェールオーバーとフェールバックを完全にテストしていない場合は、アプリケーション内の依存サービスが障害復旧時に同期的にバックアップされるとは確信できません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-212">If you haven't fully tested failover and failback, you can't be certain that the dependent services in your application come back up in a synchronized manner during disaster recovery.</span></span> <span data-ttu-id="ef4e4-213">アプリケーションの依存サービスのフェールオーバーとフェールバックが、確実に正しい順序で行われるようにしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-213">Ensure that your application's dependent services failover and fail back in the correct order.</span></span>

<span data-ttu-id="ef4e4-214">**アプリケーションに対してフォールト挿入テストを実行します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-214">**Perform fault-injection testing for your application.**</span></span> <span data-ttu-id="ef4e4-215">アプリケーションは、証明書の有効期限、VM のシステム リソースの枯渇、ストレージ障害など、多くのさまざまな理由で障害が発生することがあります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-215">Your application can fail for many different reasons, such as certificate expiration, exhaustion of system resources in a VM, or storage failures.</span></span> <span data-ttu-id="ef4e4-216">運用環境にできるだけ近い環境で、実際の障害をシミュレートまたはトリガーして、アプリケーションをテストしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-216">Test your application in an environment as close as possible to production, by simulating or triggering real failures.</span></span> <span data-ttu-id="ef4e4-217">たとえば、証明書を削除したり、システム リソースを人為的に消費したり、ストレージ ソースを削除したりします。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-217">For example, delete certificates, artificially consume system resources, or delete a storage source.</span></span> <span data-ttu-id="ef4e4-218">単独でも組み合わせでも、あらゆるタイプの障害からアプリケーションを復旧できることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-218">Verify your application's ability to recover from all types of faults, alone and in combination.</span></span> <span data-ttu-id="ef4e4-219">障害がシステムを介して反映されたり連鎖したりしないことを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-219">Check that failures are not propagating or cascading through your system.</span></span>

<span data-ttu-id="ef4e4-220">**人工的なユーザー データと実際のユーザー データの両方を使用して、運用環境でテストを実行します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-220">**Run tests in production using both synthetic and real user data.**</span></span> <span data-ttu-id="ef4e4-221">テストと運用はほとんど同じですので、Blue/Green またはカナリヤ デプロイを使用し、運用環境でアプリケーションをテストすることが重要です。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-221">Test and production are rarely identical, so it's important to use blue/green or a canary deployment and test your application in production.</span></span> <span data-ttu-id="ef4e4-222">これにより、実際の負荷がかかった運用環境でアプリケーションをテストでき、完全にデプロイしたときに期待どおりに機能することを確認できます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-222">This allows you to test your application in production under real load and ensure it will function as expected when fully deployed.</span></span>

## <a name="deployment"></a><span data-ttu-id="ef4e4-223">デプロイ</span><span class="sxs-lookup"><span data-stu-id="ef4e4-223">Deployment</span></span>

<span data-ttu-id="ef4e4-224">**アプリケーションのリリース プロセスを文書化します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-224">**Document the release process for your application.**</span></span> <span data-ttu-id="ef4e4-225">詳細なリリース プロセスのドキュメントがなければ、オペレーターが不適切な更新プログラムやアプリケーションに不適切な構成設定をデプロイする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-225">Without detailed release process documentation, an operator might deploy a bad update or improperly configure settings for your application.</span></span> <span data-ttu-id="ef4e4-226">リリース プロセスを明確に定義して文書化し、オペレーション チーム全体が確実に利用できるようにしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-226">Clearly define and document your release process, and ensure that it's available to the entire operations team.</span></span> 

<span data-ttu-id="ef4e4-227">**アプリケーションのデプロイ プロセスを自動化します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-227">**Automate your application's deployment process.**</span></span> <span data-ttu-id="ef4e4-228">運用スタッフがアプリケーションを手動でデプロイする必要がある場合は、人的ミスによってデプロイに失敗する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-228">If your operations staff is required to manually deploy your application, human error can cause the deployment to fail.</span></span> 

<span data-ttu-id="ef4e4-229">**アプリケーションの可用性を最大限にするリリース プロセスを設計します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-229">**Design your release process to maximize application availability.**</span></span> <span data-ttu-id="ef4e4-230">リリース プロセスでデプロイ中にサービスをオフラインにする必要がある場合、オンラインに戻るまでアプリケーションは使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-230">If your release process requires services to go offline during deployment, your application will be unavailable until they come back online.</span></span> <span data-ttu-id="ef4e4-231">アプリケーションを運用環境にデプロイするには、[Blue/Green](http://martinfowler.com/bliki/BlueGreenDeployment.html) または[カナリヤ リリース](http://martinfowler.com/bliki/CanaryRelease.html)のデプロイ手法を使用してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-231">Use the [blue/green](http://martinfowler.com/bliki/BlueGreenDeployment.html) or [canary release](http://martinfowler.com/bliki/CanaryRelease.html) deployment technique to deploy your application to production.</span></span> <span data-ttu-id="ef4e4-232">これらの手法のどちらにも、障害発生時にリリース コードのユーザーが運用環境のコードにリダイレクトできるように、運用環境のコードと共にリリース コードをデプロイすることが含まれます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-232">Both of these techniques involve deploying your release code alongside production code so users of release code can be redirected to production code in the event of a failure.</span></span>

<span data-ttu-id="ef4e4-233">**アプリケーションのデプロイを記録し、監査します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-233">**Log and audit your application's deployments.**</span></span> <span data-ttu-id="ef4e4-234">Blue/Green やカナリヤ リリースなどのステージング デプロイ手法を使用する場合、運用環境では複数のバージョンのアプリケーションが実行されることになります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-234">If you use staged deployment techniques such as blue/green or canary releases there will be more than one version of your application running in production.</span></span> <span data-ttu-id="ef4e4-235">万一問題が発生した場合は、アプリケーションのどのバージョンが問題の原因かを判別することが重要です。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-235">If a problem should occur, it's critical to determine which version of your application is causing a problem.</span></span> <span data-ttu-id="ef4e4-236">できるだけ多くのバージョン固有の情報を把握するため、確実なログ記録の方法を実装してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-236">Implement a robust logging strategy to capture as much version-specific information as possible.</span></span>

<span data-ttu-id="ef4e4-237">**デプロイのロールバック計画を立てます。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-237">**Have a rollback plan for deployment.**</span></span> <span data-ttu-id="ef4e4-238">アプリケーションのデプロイが失敗し、アプリケーションが使用できなくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-238">It's possible that your application deployment could fail and cause your application to become unavailable.</span></span> <span data-ttu-id="ef4e4-239">直前の正常なバージョンに戻して、ダウンタイムを最小限に抑えるために、ロールバック プロセスを設計してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-239">Design a rollback process to go back to a last known good version and minimize downtime.</span></span> 

## <a name="operations"></a><span data-ttu-id="ef4e4-240">[操作]</span><span class="sxs-lookup"><span data-stu-id="ef4e4-240">Operations</span></span>

<span data-ttu-id="ef4e4-241">**アプリケーションの監視とアラートのためのベスト プラクティスを実装します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-241">**Implement best practices for monitoring and alerting in your application.**</span></span> <span data-ttu-id="ef4e4-242">適切な監視、診断、およびアラートがなければ、アプリケーションで障害を検出してそれらを修正するようオペレーターに警告する方法がありません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-242">Without proper monitoring, diagnostics, and alerting, there is no way to detect failures in your application and alert an operator to fix them.</span></span> <span data-ttu-id="ef4e4-243">詳細については、「[監視と診断のガイダンス][monitoring-and-diagnostics-guidance]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-243">For more information, see [Monitoring and Diagnostics guidance][monitoring-and-diagnostics-guidance].</span></span>

<span data-ttu-id="ef4e4-244">**リモート呼び出しの統計情報を測定し、アプリケーション チームがその情報を使用できるようにします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-244">**Measure remote call statistics and make the information available to the application team.**</span></span>  <span data-ttu-id="ef4e4-245">リモート呼び出しの統計情報をリアルタイムで追跡してレポートせず、この情報を確認する簡単な方法を用意しないと、運用チームはアプリケーションの正常性を瞬時に確認することができなくなります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-245">If you don't track and report remote call statistics in real time and provide an easy way to review this information, the operations team will not have an instantaneous view into the health of your application.</span></span> <span data-ttu-id="ef4e4-246">また、リモート呼び出しの平均時間のみを測定しても、サービスの問題を明らかにするのに十分な情報は得られません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-246">And if you only measure average remote call time, you will not have enough information to reveal issues in the services.</span></span> <span data-ttu-id="ef4e4-247">待機時間、スループット、および 99 および 95 パーセンタイルのエラーなど、リモート呼び出しのメトリックをまとめてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-247">Summarize remote call metrics such as latency, throughput, and errors in the 99 and 95 percentiles.</span></span> <span data-ttu-id="ef4e4-248">各パーセンタイル内で発生したエラーを明らかにするには、このメトリックで統計分析を実行してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-248">Perform statistical analysis on the metrics to uncover errors that occur within each percentile.</span></span>

<span data-ttu-id="ef4e4-249">**適切な期間の間の一時的な例外と再試行の数を追跡します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-249">**Track the number of transient exceptions and retries over an appropriate timeframe.**</span></span> <span data-ttu-id="ef4e4-250">長時間にわたる一時的な例外と再試行の試みを追跡して監視しないと、アプリケーションの再試行ロジックによって問題や障害が隠れてしまう可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-250">If you don't track and monitor transient exceptions and retry attempts over time, it's possible that an issue or failure could be hidden by your application's retry logic.</span></span> <span data-ttu-id="ef4e4-251">つまり、監視とログ記録が操作の成功または失敗しか示していなければ、例外によって操作を複数回再試行する必要があったという事実は隠れてしまいます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-251">That is, if your monitoring and logging only shows success or failure of an operation, the fact that the operation had to be retried multiple times due to exceptions will be hidden.</span></span> <span data-ttu-id="ef4e4-252">時間をかけて例外が増加する傾向は、サービスに問題があるか失敗する可能性があることを示します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-252">A trend of increasing exceptions over time indicates that the service is having an issue and may fail.</span></span> <span data-ttu-id="ef4e4-253">詳細については、「[再試行サービス固有のガイダンス][retry-service-guidance]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-253">For more information, see [Retry service specific guidance][retry-service-guidance].</span></span>

<span data-ttu-id="ef4e4-254">**オペレーターに通知する早期警告システムを実装します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-254">**Implement an early warning system that alerts an operator.**</span></span> <span data-ttu-id="ef4e4-255">一時的な例外やリモート呼び出しの待機時間などのアプリケーションの正常性の主要業績評価指標を特定し、それぞれに適切なしきい値を設定してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-255">Identify the key performance indicators of your application's health, such as transient exceptions and remote call latency, and set appropriate threshold values for each of them.</span></span> <span data-ttu-id="ef4e4-256">しきい値に達したときに、操作にアラートを送信します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-256">Send an alert to operations when the threshold value is reached.</span></span> <span data-ttu-id="ef4e4-257">問題が重大になり、復旧対応が必要になる前に、問題を特定するレベルでこれらのしきい値を設定してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-257">Set these thresholds at levels that identify issues before they become critical and require a recovery response.</span></span>

<span data-ttu-id="ef4e4-258">**アプリケーションの監視と手動の復旧手順の実行について、チームの複数のメンバーに確実にトレーニングを実施してください。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-258">**Ensure that more than one person on the team is trained to monitor the application and perform any manual recovery steps.**</span></span> <span data-ttu-id="ef4e4-259">アプリケーションを監視し、復旧手順を開始できるオペレーターがチームに 1 人しかいないと、その人が単一障害点になります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-259">If you only have a single operator on the team who can monitor the application and kick off recovery steps, that person becomes a single point of failure.</span></span> <span data-ttu-id="ef4e4-260">検出と復旧に関するトレーニングを複数の人に対して実施し、常に少なくとも 1 人がいつでも活動しているようにしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-260">Train multiple individuals on detection and recovery and make sure there is always at least one active at any time.</span></span>

<span data-ttu-id="ef4e4-261">**アプリケーションが [Azure サブスクリプションの制限](/azure/azure-subscription-service-limits/)と衝突しないようにします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-261">**Ensure that your application does not run up against [Azure subscription limits](/azure/azure-subscription-service-limits/).**</span></span> <span data-ttu-id="ef4e4-262">Azure サブスクリプションには、リソース グループの数、コアの数、およびストレージ アカウントの数など、特定のリソースの種類に対する制限があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-262">Azure subscriptions have limits on certain resource types, such as number of resource groups, number of cores, and number of storage accounts.</span></span>  <span data-ttu-id="ef4e4-263">アプリケーションの要件が Azure サブスクリプションの制限を超えた場合は、別の Azure サブスクリプションを作成し、そこに十分なリソースをプロビジョニングしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-263">If your application requirements exceed Azure subscription limits, create another Azure subscription and provision sufficient resources there.</span></span>

<span data-ttu-id="ef4e4-264">**アプリケーションが[サービスごとの制限](/azure/azure-subscription-service-limits/)と衝突しないようにします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-264">**Ensure that your application does not run up against [per-service limits](/azure/azure-subscription-service-limits/).**</span></span> <span data-ttu-id="ef4e4-265">個々 の Azure サービスには消費量に制限があります。たとえば、ストレージ、スループット、接続数、秒あたりの要求、およびその他のメトリックに関する制限です。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-265">Individual Azure services have consumption limits &mdash; for example, limits on storage, throughput, number of connections, requests per second, and other metrics.</span></span> <span data-ttu-id="ef4e4-266">これらの制限を超えてリソースを使用しようとすると、アプリケーションは失敗します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-266">Your application will fail if it attempts to use resources beyond these limits.</span></span> <span data-ttu-id="ef4e4-267">これにより、影響を受けるユーザーにサービスの調整とダウンタイムの可能性が生じることになります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-267">This will result in service throttling and possible downtime for affected users.</span></span> <span data-ttu-id="ef4e4-268">特定のサービスとアプリケーションの要件に応じて、(たとえば、別の価格層を選択して) スケールアップするか、(新しいインスタンスを追加して) スケールアウトすることで、多くの場合はこれらの制限を回避できます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-268">Depending on the specific service and your application requirements, you can often avoid these limits by scaling up (for example, choosing another pricing tier) or scaling out (adding new instances).</span></span>  

<span data-ttu-id="ef4e4-269">**アプリケーションのストレージの要件を、Azure ストレージのスケーラビリティとパフォーマンスのターゲットの範囲に入るように設計します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-269">**Design your application's storage requirements to fall within Azure storage scalability and performance targets.**</span></span> <span data-ttu-id="ef4e4-270">Azure ストレージは、事前定義済みのスケーラビリティとパフォーマンスのターゲットの中で機能するように設計されているため、それらのターゲットの中でストレージを利用するようにアプリケーションを設計してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-270">Azure storage is designed to function within predefined scalability and performance targets, so design your application to utilize storage within those targets.</span></span> <span data-ttu-id="ef4e4-271">これらのターゲットを上回ると、アプリケーションでストレージが調整されます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-271">If you exceed these targets your application will experience storage throttling.</span></span> <span data-ttu-id="ef4e4-272">これを解決するには、追加のストレージ アカウントをプロビジョニングします。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-272">To fix this, provision additional Storage Accounts.</span></span> <span data-ttu-id="ef4e4-273">ストレージ アカウントの制限と衝突する場合は、追加の Azure サブスクリプションをプロビジョニングしてから、そこに追加のストレージ アカウントをプロビジョニングしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-273">If you run up against the Storage Account limit, provision additional Azure Subscriptions and then provision additional Storage Accounts there.</span></span> <span data-ttu-id="ef4e4-274">詳細については、「 [Azure Storage のスケーラビリティおよびパフォーマンスのターゲット](/azure/storage/storage-scalability-targets/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-274">For more information, see [Azure Storage Scalability and Performance Targets](/azure/storage/storage-scalability-targets/).</span></span>

<span data-ttu-id="ef4e4-275">**アプリケーションに適した VM サイズを選択します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-275">**Select the right VM size for your application.**</span></span> <span data-ttu-id="ef4e4-276">運用環境の VM の実際の CPU、メモリ、ディスク、および I/O を測定し、選択した VM のサイズが十分であることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-276">Measure the actual CPU, memory, disk, and I/O of your VMs in production and verify that the VM size you've selected is sufficient.</span></span> <span data-ttu-id="ef4e4-277">そうでない場合は、VM がその制限に近くなると、アプリケーションで容量の問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-277">If not, your application may experience capacity issues as the VMs approach their limits.</span></span> <span data-ttu-id="ef4e4-278">VM のサイズについては、「[Azure の仮想マシンのサイズ](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-278">VM sizes are described in detail in [Sizes for virtual machines in Azure](/azure/virtual-machines/virtual-machines-windows-sizes/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

<span data-ttu-id="ef4e4-279">**アプリケーションのワークロードが安定しているか変動しているかを確認します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-279">**Determine if your application's workload is stable or fluctuating over time.**</span></span> <span data-ttu-id="ef4e4-280">時間をかけてワークロードが変動する場合は、VM スケール セットを使用して VM インスタンスの数を自動的にスケールしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-280">If your workload fluctuates over time, use Azure VM scale sets to automatically scale the number of VM instances.</span></span> <span data-ttu-id="ef4e4-281">そうしないと、VM の数の手動での増減が必要になります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-281">Otherwise, you will have to manually increase or decrease the number of VMs.</span></span> <span data-ttu-id="ef4e4-282">詳細については、「[仮想マシン スケール セットの概要](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-282">For more information, see the [Virtual Machine Scale Sets Overview](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span></span>

<span data-ttu-id="ef4e4-283">**Azure SQL Database に適したサービス層を選択します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-283">**Select the right service tier for Azure SQL Database.**</span></span> <span data-ttu-id="ef4e4-284">アプリケーションが Azure SQL Database を使用する場合は、必ず適切なサービス層を選択してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-284">If your application uses Azure SQL Database, ensure that you have selected the appropriate service tier.</span></span> <span data-ttu-id="ef4e4-285">アプリケーションのデータベース トランザクション ユニット (DTU) の要件を処理できない層を選択すると、データの使用が調整されます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-285">If you select a tier that is not able to handle your application's database transaction unit (DTU) requirements, your data use will be throttled.</span></span> <span data-ttu-id="ef4e4-286">適切なサービス プランの選択の詳細については、「[SQL Database のオプションとパフォーマンス: 各サービス階層で使用できる内容について理解します](/azure/sql-database/sql-database-service-tiers/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-286">For more information on selecting the correct service plan, see [SQL Database options and performance: Understand what's available in each service tier](/azure/sql-database/sql-database-service-tiers/).</span></span>

<span data-ttu-id="ef4e4-287">**Azure のサポートとやり取りするためのプロセスを作成します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-287">**Create a process for interacting with Azure support.**</span></span> <span data-ttu-id="ef4e4-288">サポートに問い合わせる必要が生じる前に [Azure のサポート](https://azure.microsoft.com/support/plans/)に問い合わせるプロセスが設定されていないと、サポート プロセスを進めるのが初めての場合はダウンタイムが長引きます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-288">If the process for contacting [Azure support](https://azure.microsoft.com/support/plans/) is not set before the need to contact support arises, downtime will be prolonged as the support process is navigated for the first time.</span></span> <span data-ttu-id="ef4e4-289">サポートへの問い合わせと問題のエスカレーションのプロセスを、最初からアプリケーションの回復性の一部として組み込んでください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-289">Include the process for contacting support and escalating issues as part of your application's resiliency from the outset.</span></span>

<span data-ttu-id="ef4e4-290">**アプリケーションが最大数を超えるサブスクリプションあたりのストレージ アカウントを使用しようしないようにします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-290">**Ensure that your application doesn't use more than the maximum number of storage accounts per subscription.**</span></span> <span data-ttu-id="ef4e4-291">Azure では、サブスクリプションごとに最大 200 のストレージ アカウントを使用できます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-291">Azure allows a maximum of 200 storage accounts per subscription.</span></span> <span data-ttu-id="ef4e4-292">アプリケーションに現時点でサブスクリプションで使用できるものよりも多くのストレージ アカウントが必要な場合は、新しいサブスクリプションを作成し、そこに追加のストレージ アカウントを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-292">If your application requires more storage accounts than are currently available in your subscription, you will have to create a new subscription and create additional storage accounts there.</span></span> <span data-ttu-id="ef4e4-293">詳細については、「[Azure サブスクリプションとサービスの制限、クォータ、制約](/azure/azure-subscription-service-limits/#storage-limits)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-293">For more information, see [Azure subscription and service limits, quotas, and constraints](/azure/azure-subscription-service-limits/#storage-limits).</span></span>

<span data-ttu-id="ef4e4-294">**アプリケーションが仮想マシンのディスクのスケーラビリティのターゲットを超えないようにします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-294">**Ensure that your application doesn't exceed the scalability targets for virtual machine disks.**</span></span> <span data-ttu-id="ef4e4-295">Azure IaaS VM は、VM のサイズやストレージ アカウントの種類など、いくつかの要因に応じたデータ ディスクの数の接続をサポートします。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-295">An Azure IaaS VM supports attaching a number of data disks depending on several factors, including the VM size and type of storage account.</span></span> <span data-ttu-id="ef4e4-296">アプリケーションが仮想マシンのディスクのスケーラビリティのターゲットを超える場合は、追加のストレージ アカウントをプロビジョニングし、そこに仮想マシンのディスクを作成してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-296">If your application exceeds the scalability targets for virtual machine disks, provision additional storage accounts and create the virtual machine disks there.</span></span> <span data-ttu-id="ef4e4-297">詳細については、「[Azure Storage のスケーラビリティおよびパフォーマンスのターゲット](/azure/storage/storage-scalability-targets/#scalability-targets-for-virtual-machine-disks)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-297">For more information, see [Azure Storage Scalability and Performance Targets](/azure/storage/storage-scalability-targets/#scalability-targets-for-virtual-machine-disks)</span></span>

## <a name="telemetry"></a><span data-ttu-id="ef4e4-298">テレメトリ</span><span class="sxs-lookup"><span data-stu-id="ef4e4-298">Telemetry</span></span>

<span data-ttu-id="ef4e4-299">**アプリケーションの運用環境で実行されているときに、利用統計情報を記録します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-299">**Log telemetry data while the application is running in the production environment.**</span></span> <span data-ttu-id="ef4e4-300">アプリケーションが運用環境で実行されているとき、またはユーザーに積極的にサービスを提供している間の問題の原因を診断するのに十分な情報がないときは、確実な利用統計情報を把握してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-300">Capture robust telemetry information while the application is running in the production environment or you will not have sufficient information to diagnose the cause of issues while it's actively serving users.</span></span> <span data-ttu-id="ef4e4-301">詳細については、「[監視と診断][monitoring-and-diagnostics-guidance]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-301">For more information, see [Monitoring and Diagnostics][monitoring-and-diagnostics-guidance].</span></span>

<span data-ttu-id="ef4e4-302">**非同期パターンを使用してログ記録を実装します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-302">**Implement logging using an asynchronous pattern.**</span></span> <span data-ttu-id="ef4e4-303">ログ記録操作が同期の場合は、アプリケーション コードがブロックされる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-303">If logging operations are synchronous, they might block your application code.</span></span> <span data-ttu-id="ef4e4-304">ログ記録操作が非同期操作として実装されるようにしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-304">Ensure that your logging operations are implemented as asynchronous operations.</span></span>

<span data-ttu-id="ef4e4-305">**サービスの境界をまたがるログ データを関連付けます。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-305">**Correlate log data across service boundaries.**</span></span> <span data-ttu-id="ef4e4-306">一般的な n 層のアプリケーションでは、ユーザーの要求はいくつかのサービスの境界を経由することがあります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-306">In a typical n-tier application, a user request may traverse several service boundaries.</span></span> <span data-ttu-id="ef4e4-307">たとえば、ユーザーの要求は、通常は Web 層で発生し、ビジネス層に渡されて、最終的にデータ層に保持されます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-307">For example, a user request typically originates in the web tier and is passed to the business tier and finally persisted in the data tier.</span></span> <span data-ttu-id="ef4e4-308">より複雑なシナリオでは、ユーザーの要求は多くのさまざまなサービスとデータ ストアに分散されることがあります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-308">In more complex scenarios, a user request may be distributed to many different services and data stores.</span></span> <span data-ttu-id="ef4e4-309">ログ記録システムは、アプリケーション全体で要求を追跡できるように、必ずサービス境界をまたがる呼び出しを関連付けてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-309">Ensure that your logging system correlates calls across service boundaries so you can track the request throughout your application.</span></span>

## <a name="azure-resources"></a><span data-ttu-id="ef4e4-310">Azure リソース</span><span class="sxs-lookup"><span data-stu-id="ef4e4-310">Azure Resources</span></span>

<span data-ttu-id="ef4e4-311">**Azure Resource Manager テンプレートを使用してリソースをプロビジョニングします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-311">**Use Azure Resource Manager templates to provision resources.**</span></span> <span data-ttu-id="ef4e4-312">Resource Manager テンプレートは、PowerShell または Azure CLI を使用してデプロイを自動化しやすくし、それがより信頼性の高いデプロイ プロセスにつながります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-312">Resource Manager templates make it easier to automate deployments via PowerShell or the Azure CLI, which leads to a more reliable deployment process.</span></span> <span data-ttu-id="ef4e4-313">詳細については、「[Azure Resource Manager の概要][resource-manager]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-313">For more information, see [Azure Resource Manager overview][resource-manager].</span></span>

<span data-ttu-id="ef4e4-314">**リソースにわかりやすい名前を付けます。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-314">**Give resources meaningful names.**</span></span> <span data-ttu-id="ef4e4-315">リソースにわかりやすい名前を付けることで、特定のリソースを見つけて、その役割を理解することが簡単になります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-315">Giving resources meaningful names makes it easier to locate a specific resource and understand its role.</span></span> <span data-ttu-id="ef4e4-316">詳細については、「[Azure リソースの名前付け規則](../best-practices/naming-conventions.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-316">For more information, see [Naming conventions for Azure resources](../best-practices/naming-conventions.md)</span></span>

<span data-ttu-id="ef4e4-317">**ロール ベースのアクセス制御 (RBAC) を使用します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-317">**Use role-based access control (RBAC).**</span></span> <span data-ttu-id="ef4e4-318">RBAC を使用して、デプロイする Azure リソースへのアクセスを制御してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-318">Use RBAC to control access to the Azure resources that you deploy.</span></span> <span data-ttu-id="ef4e4-319">RBAC を使用すると、DevOps チームのメンバーに承認の役割を割り当てて、デプロイ済みのリソースが誤って削除されたり変更されたりするのを防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-319">RBAC lets you assign authorization roles to members of your DevOps team, to prevent accidental deletion or changes to deployed resources.</span></span> <span data-ttu-id="ef4e4-320">詳細については、「[Azure Portal でのアクセス管理の概要](/azure/active-directory/role-based-access-control-what-is/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-320">For more information, see [Get started with access management in the Azure portal](/azure/active-directory/role-based-access-control-what-is/)</span></span>

<span data-ttu-id="ef4e4-321">**VM などの重要なリソースにリソースのロックを使用します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-321">**Use resource locks for critical resources, such as VMs.**</span></span> <span data-ttu-id="ef4e4-322">リソースのロックは、オペレーターがリソースを誤って削除するのを防ぎます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-322">Resource locks prevent an operator from accidentally deleting a resource.</span></span> <span data-ttu-id="ef4e4-323">詳細については、[「Azure Resource Manager によるリソースのロック」](/azure/azure-resource-manager/resource-group-lock-resources/)をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-323">For more information, see [Lock resources with Azure Resource Manager](/azure/azure-resource-manager/resource-group-lock-resources/)</span></span>

<span data-ttu-id="ef4e4-324">**リージョンのペアを選択します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-324">**Choose regional pairs.**</span></span> <span data-ttu-id="ef4e4-325">2 つのリージョンにデプロイする場合は、同じリージョンのペアからリージョンを選択してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-325">When deploying to two regions, choose regions from the same regional pair.</span></span> <span data-ttu-id="ef4e4-326">広範囲にわたって障害が発生した場合は、すべてのペアのうちの 1 つのリージョンの復旧が優先されます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-326">In the event of a broad outage, recovery of one region is prioritized out of every pair.</span></span> <span data-ttu-id="ef4e4-327">geo 冗長ストレージなど一部のサービスには、ペア リージョンへの自動レプリケーション機能が用意されています。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-327">Some services such as Geo-Redundant Storage provide automatic replication to the paired region.</span></span> <span data-ttu-id="ef4e4-328">詳しくは、「[ビジネス継続性とディザスター リカバリー (BCDR): Azure のペアになっているリージョン](/azure/best-practices-availability-paired-regions)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-328">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions)</span></span>

<span data-ttu-id="ef4e4-329">**リソース グループを機能別とライフサイクル別にまとめます。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-329">**Organize resource groups by function and lifecycle.**</span></span>  <span data-ttu-id="ef4e4-330">一般に、リソース グループには、同じライフサイクルを共有するリソースを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-330">In general, a resource group should contain resources that share the same lifecycle.</span></span> <span data-ttu-id="ef4e4-331">これにより、デプロイの管理、テスト デプロイの削除、およびアクセス権の割り当てが簡単になり、運用デプロイが誤って削除されたり変更されたりする可能性が低くなります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-331">This makes it easier to manage deployments, delete test deployments, and assign access rights, reducing the chance that a production deployment is accidentally deleted or modified.</span></span> <span data-ttu-id="ef4e4-332">運用、開発、およびテスト環境用に別々のリソース グループを作成してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-332">Create separate resource groups for production, development, and test environments.</span></span> <span data-ttu-id="ef4e4-333">複数リージョンのデプロイでは、各リージョン用のリソースを別々のリソース グループに配置してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-333">In a multi-region deployment, put resources for each region into separate resource groups.</span></span> <span data-ttu-id="ef4e4-334">これにより、他のリージョンに影響を与えずに、1 つのリージョンに簡単に再デプロイできます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-334">This makes it easier to redeploy one region without affecting the other region(s).</span></span>

## <a name="azure-services"></a><span data-ttu-id="ef4e4-335">Azure サービス</span><span class="sxs-lookup"><span data-stu-id="ef4e4-335">Azure Services</span></span>
<span data-ttu-id="ef4e4-336">次のチェックリストの項目は、Azure の特定のサービスに適用されます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-336">The following checklist items apply to specific services in Azure.</span></span>

- [<span data-ttu-id="ef4e4-337">App Service</span><span class="sxs-lookup"><span data-stu-id="ef4e4-337">App Service</span></span>](#app-service)
- [<span data-ttu-id="ef4e4-338">Application Gateway</span><span class="sxs-lookup"><span data-stu-id="ef4e4-338">Application Gateway</span></span>](#application-gateway)
- [<span data-ttu-id="ef4e4-339">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="ef4e4-339">Cosmos DB</span></span>](#cosmos-db)
- [<span data-ttu-id="ef4e4-340">Redis Cache</span><span class="sxs-lookup"><span data-stu-id="ef4e4-340">Redis Cache</span></span>](#redis-cache)
- [<span data-ttu-id="ef4e4-341">Search</span><span class="sxs-lookup"><span data-stu-id="ef4e4-341">Search</span></span>](#search)
- [<span data-ttu-id="ef4e4-342">Storage</span><span class="sxs-lookup"><span data-stu-id="ef4e4-342">Storage</span></span>](#storage)
- [<span data-ttu-id="ef4e4-343">SQL Database</span><span class="sxs-lookup"><span data-stu-id="ef4e4-343">SQL Database</span></span>](#sql-database)
- [<span data-ttu-id="ef4e4-344">VM で実行されている SQL Server</span><span class="sxs-lookup"><span data-stu-id="ef4e4-344">SQL Server running in a VM</span></span>](#sql-server-running-in-a-vm)
- [<span data-ttu-id="ef4e4-345">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="ef4e4-345">Traffic Manager</span></span>](#traffic-manager)
- [<span data-ttu-id="ef4e4-346">Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="ef4e4-346">Virtual Machines</span></span>](#virtual-machines)
- [<span data-ttu-id="ef4e4-347">Virtual Network</span><span class="sxs-lookup"><span data-stu-id="ef4e4-347">Virtual Network</span></span>](#virtual-network)

### <a name="app-service"></a><span data-ttu-id="ef4e4-348">App Service</span><span class="sxs-lookup"><span data-stu-id="ef4e4-348">App Service</span></span>

<span data-ttu-id="ef4e4-349">**Standard または Premium 層を使用します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-349">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="ef4e4-350">これらの階層は、ステージング スロットと自動バックアップをサポートします。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-350">These tiers support staging slots and automated backups.</span></span> <span data-ttu-id="ef4e4-351">詳細については、「[Azure App Service プランの詳細な概要](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)」を参照してください</span><span class="sxs-lookup"><span data-stu-id="ef4e4-351">For more information, see [Azure App Service plans in-depth overview](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)</span></span>

<span data-ttu-id="ef4e4-352">**スケールアップまたはスケールダウンを回避します｡**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-352">**Avoid scaling up or down.**</span></span> <span data-ttu-id="ef4e4-353">代わりに、通常の負荷の下でパフォーマンスの要件を満たす階層とインスタンスのサイズを選択してから、インスタンスを[スケールアウト](/azure/app-service-web/web-sites-scale/)してトラフィック量の変化を処理してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-353">Instead, select a tier and instance size that meet your performance requirements under typical load, and then [scale out](/azure/app-service-web/web-sites-scale/) the instances to handle changes in traffic volume.</span></span> <span data-ttu-id="ef4e4-354">スケールアップとスケールダウンにより、アプリケーションの再起動がトリガーされることがあります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-354">Scaling up and down may trigger an application restart.</span></span>  

<span data-ttu-id="ef4e4-355">**構成をアプリ設定として格納します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-355">**Store configuration as app settings.**</span></span> <span data-ttu-id="ef4e4-356">アプリ設定を使用して、構成設定をアプリケーション設定として格納してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-356">Use app settings to hold configuration settings as app settings.</span></span> <span data-ttu-id="ef4e4-357">Resource Manager テンプレートに、または PowerShell 使用して設定を定義して、それを自動化されたデプロイや更新プロセスの一部として適用できるようにしてください。それによって信頼性が向上します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-357">Define the settings in your Resource Manager templates, or using PowerShell, so that you can apply them as part of an automated deployment / update process, which is more reliable.</span></span> <span data-ttu-id="ef4e4-358">詳細については、「[Azure App Service での Web アプリの構成](/azure/app-service-web/web-sites-configure/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-358">For more information, see [Configure web apps in Azure App Service](/azure/app-service-web/web-sites-configure/).</span></span>

<span data-ttu-id="ef4e4-359">**運用とテスト用に別々の App Service プランを作成します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-359">**Create separate App Service plans for production and test.**</span></span> <span data-ttu-id="ef4e4-360">テストには運用環境のデプロイのスロットを使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-360">Don't use slots on your production deployment for testing.</span></span>  <span data-ttu-id="ef4e4-361">同じ App Service プラン内のすべてのアプリが同じ VM インスタンスを共有します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-361">All apps within the same App Service plan share the same VM instances.</span></span> <span data-ttu-id="ef4e4-362">運用デプロイとテスト デプロイを同じプランに入れると、運用デプロイに悪影響を与える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-362">If you put production and test deployments in the same plan, it can negatively affect the production deployment.</span></span> <span data-ttu-id="ef4e4-363">たとえば、負荷テストは実稼働の運用サイトを低下させる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-363">For example, load tests might degrade the live production site.</span></span> <span data-ttu-id="ef4e4-364">テスト デプロイを別のプランに入れることで、運用バージョンから分離してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-364">By putting test deployments into a separate plan, you isolate them from the production version.</span></span>  

<span data-ttu-id="ef4e4-365">**Web アプリから Web API を分離します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-365">**Separate web apps from web APIs.**</span></span> <span data-ttu-id="ef4e4-366">ソリューションに Web フロントエンドと Web API の両方がある場合は、それらを別々の App Service アプリに分解することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-366">If your solution has both a web front-end and a web API, consider decomposing them into separate App Service apps.</span></span> <span data-ttu-id="ef4e4-367">この設計により、ソリューションをワークロード別に分解しやすくなります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-367">This design makes it easier to decompose the solution by workload.</span></span> <span data-ttu-id="ef4e4-368">Web アプリと API を別々の App Service プランで実行できるため、それらを個別にスケーリングできるようになります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-368">You can run the web app and the API in separate App Service plans, so they can be scaled independently.</span></span> <span data-ttu-id="ef4e4-369">最初はこのレベルのスケーラビリティが不要な場合は、アプリを同じプランにデプロイし、後で必要に応じて別のプランに移行することができます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-369">If you don't need that level of scalability at first, you can deploy the apps into the same plan, and move them into separate plans later, if needed.</span></span>

<span data-ttu-id="ef4e4-370">**Azure SQL データベースをバックアップするのに App Service バックアップ機能を使用しないでください。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-370">**Avoid using the App Service backup feature to back up Azure SQL databases.**</span></span> <span data-ttu-id="ef4e4-371">代わりに、[SQL Database 自動バックアップ][sql-backup]を使用してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-371">Instead, use [SQL Database automated backups][sql-backup].</span></span> <span data-ttu-id="ef4e4-372">App Service のバックアップはデータベースを SQL .bacpac ファイルにエクスポートし、これには DTU のコストがかかります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-372">App Service backup exports the database to a SQL .bacpac file, which costs DTUs.</span></span>  

<span data-ttu-id="ef4e4-373">**ステージング スロットにデプロイします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-373">**Deploy to a staging slot.**</span></span> <span data-ttu-id="ef4e4-374">ステージング用のデプロイ スロットを作成します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-374">Create a deployment slot for staging.</span></span> <span data-ttu-id="ef4e4-375">アプリケーションの更新プログラムをステージング スロットにデプロイし、運用環境にスワップする前にデプロイを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-375">Deploy application updates to the staging slot, and verify the deployment before swapping it into production.</span></span> <span data-ttu-id="ef4e4-376">これにより、運用環境で不正な更新が発生する可能性が減少します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-376">This reduces the chance of a bad update in production.</span></span> <span data-ttu-id="ef4e4-377">また、すべてのインスタンスが、運用環境にスワップする前に確実にウォーム アップされます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-377">It also ensures that all instances are warmed up before being swapped into production.</span></span> <span data-ttu-id="ef4e4-378">多くのアプリケーションではウォームアップとコールドスタートに多くの時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-378">Many applications have a significant warmup and cold-start time.</span></span> <span data-ttu-id="ef4e4-379">詳細については、「[Azure App Service の Web アプリのステージング環境を設定する](/azure/app-service-web/web-sites-staged-publishing/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-379">For more information, see [Set up staging environments for web apps in Azure App Service](/azure/app-service-web/web-sites-staged-publishing/).</span></span>

<span data-ttu-id="ef4e4-380">**前回正常起動時 (LKG) のデプロイを保持するデプロイ スロットを作成します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-380">**Create a deployment slot to hold the last-known-good (LKG) deployment.**</span></span> <span data-ttu-id="ef4e4-381">運用環境に更新プログラムをデプロイするときは、以前の運用環境のデプロイを LKG スロットに移動してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-381">When you deploy an update to production, move the previous production deployment into the LKG slot.</span></span> <span data-ttu-id="ef4e4-382">これにより、不適切なデプロイをより簡単にロールバックできます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-382">This makes it easier to roll back a bad deployment.</span></span> <span data-ttu-id="ef4e4-383">後で問題を見つけた場合は、LKG バージョンにすばやく戻ることができます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-383">If you discover a problem later, you can quickly revert to the LKG version.</span></span> <span data-ttu-id="ef4e4-384">詳細については、[基本的な Web アプリケーション](../reference-architectures/app-service-web-app/basic-web-app.md)に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-384">For more information, see [Basic web application](../reference-architectures/app-service-web-app/basic-web-app.md).</span></span>

<span data-ttu-id="ef4e4-385">アプリケーションのログ記録や Web サーバーのログ記録を含む、**診断のログ記録を有効にしてください**。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-385">**Enable diagnostics logging**, including application logging and web server logging.</span></span> <span data-ttu-id="ef4e4-386">監視と診断にはログ記録が重要です。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-386">Logging is important for monitoring and diagnostics.</span></span> <span data-ttu-id="ef4e4-387">「[Azure App Service での Web アプリの診断ログの有効化](/azure/app-service-web/web-sites-enable-diagnostic-log/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-387">See [Enable diagnostics logging for web apps in Azure App Service](/azure/app-service-web/web-sites-enable-diagnostic-log/)</span></span>

<span data-ttu-id="ef4e4-388">**Blob Storage にログを記録します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-388">**Log to blob storage.**</span></span> <span data-ttu-id="ef4e4-389">これによって、データの収集と分析が簡単になります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-389">This makes it easier to collect and analyze the data.</span></span>

<span data-ttu-id="ef4e4-390">**ログ用の別のストレージ アカウントを作成します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-390">**Create a separate storage account for logs.**</span></span> <span data-ttu-id="ef4e4-391">ログとアプリケーション データに同じストレージ アカウントを使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-391">Don't use the same storage account for logs and application data.</span></span> <span data-ttu-id="ef4e4-392">これは、ログ記録によってアプリケーションのパフォーマンスが低下するのを防ぐのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-392">This helps to prevent logging from reducing application performance.</span></span>

<span data-ttu-id="ef4e4-393">**パフォーマンスを監視します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-393">**Monitor performance.**</span></span> <span data-ttu-id="ef4e4-394">[New Relic](http://newrelic.com/) や[Application Insights](/azure/application-insights/app-insights-overview/) などのパフォーマンス監視サービスを使用して、負荷がかかった状態のアプリケーションのパフォーマンスと動作を監視してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-394">Use a performance monitoring service such as [New Relic](http://newrelic.com/) or [Application Insights](/azure/application-insights/app-insights-overview/) to monitor application performance and behavior under load.</span></span>  <span data-ttu-id="ef4e4-395">パフォーマンスの監視により、アプリケーションをリアルタイムで理解できます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-395">Performance monitoring gives you real-time insight into the application.</span></span> <span data-ttu-id="ef4e4-396">これにより、問題を診断し、障害の根本原因分析を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-396">It enables you to diagnose issues and perform root-cause analysis of failures.</span></span>

### <a name="application-gateway"></a><span data-ttu-id="ef4e4-397">Application Gateway</span><span class="sxs-lookup"><span data-stu-id="ef4e4-397">Application Gateway</span></span>

<span data-ttu-id="ef4e4-398">**少なくとも 2 つのインスタンスをプロビジョニングします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-398">**Provision at least two instances.**</span></span> <span data-ttu-id="ef4e4-399">少なくとも 2 つのインスタンスのある Application Gateway をデプロイしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-399">Deploy Application Gateway with at least two instances.</span></span> <span data-ttu-id="ef4e4-400">単一のインスタンスは、単一障害点です。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-400">A single instance is a single point of failure.</span></span> <span data-ttu-id="ef4e4-401">冗長性とスケーラビリティのために、2 つ以上のインスタンスを使用してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-401">Use two or more instances for redundancy and scalability.</span></span> <span data-ttu-id="ef4e4-402">[SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/) に適合するためには、2 つ以上のメディアまたは大きめのインスタンスをプロビジョニングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-402">In order to qualify for the [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway/v1_0/), you must provision two or more medium or larger instances.</span></span>

### <a name="cosmos-db"></a><span data-ttu-id="ef4e4-403">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="ef4e4-403">Cosmos DB</span></span>

<span data-ttu-id="ef4e4-404">**リージョン間でデータベースをレプリケートします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-404">**Replicate the database across regions.**</span></span> <span data-ttu-id="ef4e4-405">Cosmos DB では、Cosmos DB データベース アカウントに Azure リージョンをいくつでも関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-405">Cosmos DB allows you to associate any number of Azure regions with a Cosmos DB database account.</span></span> <span data-ttu-id="ef4e4-406">Cosmos DB データベースには、1 つの書き込みリージョンと複数の読み取りリージョンを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-406">A Cosmos DB database can have one write region and multiple read regions.</span></span> <span data-ttu-id="ef4e4-407">書き込みリージョンに障害がある場合は、別のレプリカから読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-407">If there is a failure in the write region, you can read from another replica.</span></span> <span data-ttu-id="ef4e4-408">クライアント SDK はこれを自動的に処理します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-408">The Client SDK handles this automatically.</span></span> <span data-ttu-id="ef4e4-409">書き込みリージョンを別のリージョンにフェールオーバーすることもできます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-409">You can also fail over the write region to another region.</span></span> <span data-ttu-id="ef4e4-410">詳細については、「[Azure Cosmos DB を使用してデータをグローバルに分散させる方法](/azure/documentdb/documentdb-distribute-data-globally)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-410">For more information, see [How to distribute data globally with Azure Cosmos DB?](/azure/documentdb/documentdb-distribute-data-globally)</span></span>

### <a name="redis-cache"></a><span data-ttu-id="ef4e4-411">Redis Cache</span><span class="sxs-lookup"><span data-stu-id="ef4e4-411">Redis Cache</span></span>

<span data-ttu-id="ef4e4-412">**geo レプリケーションを構成します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-412">**Configure Geo-replication**.</span></span> <span data-ttu-id="ef4e4-413">geo レプリケーションは、Premium レベルの Azure Redis Cache の 2 つのインスタンスをリンクするメカニズムを用意しています。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-413">Geo-replication provides a mechanism for linking two Premium tier Azure Redis Cache instances.</span></span> <span data-ttu-id="ef4e4-414">プライマリ キャッシュに書き込まれたデータは、読み取り専用のセカンダリ キャッシュにレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-414">Data written to the primary cache is replicated to a secondary read-only cache.</span></span> <span data-ttu-id="ef4e4-415">詳細については、「[Azure Redis Cache の geo レプリケーションの構成方法](/azure/redis-cache/cache-how-to-geo-replication)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-415">For more information, see [How to configure Geo-replication for Azure Redis Cache](/azure/redis-cache/cache-how-to-geo-replication)</span></span>

<span data-ttu-id="ef4e4-416">**データ永続化を構成します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-416">**Configure data persistence.**</span></span> <span data-ttu-id="ef4e4-417">Redis の永続化を使用すると、Redis に格納されたデータを保持できます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-417">Redis persistence allows you to persist data stored in Redis.</span></span> <span data-ttu-id="ef4e4-418">また、スナップショットを取得したりデータをバックアップしたりして、ハードウェア障害のときに読み込むことができます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-418">You can also take snapshots and back up the data, which you can load in case of a hardware failure.</span></span> <span data-ttu-id="ef4e4-419">詳細については、「[Premium Azure Redis Cache のデータ永続化の構成方法](/azure/redis-cache/cache-how-to-premium-persistence)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-419">For more information, see [How to configure data persistence for a Premium Azure Redis Cache](/azure/redis-cache/cache-how-to-premium-persistence)</span></span>

<span data-ttu-id="ef4e4-420">永続ストアとしてではなく、一時的なデータ キャッシュとして Redis Cache を使用する場合、これらの推奨事項は適用されません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-420">If you are using Redis Cache as a temporary data cache and not as a persistent store, these recommendations may not apply.</span></span> 

### <a name="search"></a><span data-ttu-id="ef4e4-421">検索</span><span class="sxs-lookup"><span data-stu-id="ef4e4-421">Search</span></span>

<span data-ttu-id="ef4e4-422">**複数のレプリカをプロビジョニングします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-422">**Provision more than one replica.**</span></span> <span data-ttu-id="ef4e4-423">読み取りの高可用性のためには少なくとも 2 つのレプリカ、読み取り/書き込みの高可用性のためには少なくとも 3 つのレプリカを使用してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-423">Use at least two replicas for read high-availability, or three for read-write high-availability.</span></span>

<span data-ttu-id="ef4e4-424">**複数リージョンのデプロイ用のインデクサーを構成します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-424">**Configure indexers for multi-region deployments.**</span></span> <span data-ttu-id="ef4e4-425">複数リージョンのデプロイがある場合は、インデックス作成の継続性のためのオプションを検討してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-425">If you have a multi-region deployment, consider your options for continuity in indexing.</span></span>

  * <span data-ttu-id="ef4e4-426">データ ソースが geo レプリケーションされている場合は、一般に、各リージョンの Azure Search サービスのそれぞれのインデクサーをそのローカル データ ソース レプリカにポイントする必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-426">If the data source is geo-replicated, you should generally point each indexer of each regional Azure Search service to its local data source replica.</span></span> <span data-ttu-id="ef4e4-427">ただし、このアプローチは、Azure SQL データベースに格納されている大規模なデータセットは推奨されません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-427">However, that approach is not recommended for large datasets stored in Azure SQL Database.</span></span> <span data-ttu-id="ef4e4-428">その理由は、Azure Search がセカンダリ SQL Database レプリカからは増分インデックス作成を実行できず、プライマリ レプリカからしか実行できないためです。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-428">The reason is that Azure Search cannot perform incremental indexing from secondary SQL Database replicas, only from primary replicas.</span></span> <span data-ttu-id="ef4e4-429">代わりに、すべてのインデクサーをプライマリ レプリカにポイントしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-429">Instead, point all indexers to the primary replica.</span></span> <span data-ttu-id="ef4e4-430">フェールオーバー後は、新しいプライマリ レプリカで Azure Search インデクサーをポイントします。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-430">After a failover, point the Azure Search indexers at the new primary replica.</span></span>  
  * <span data-ttu-id="ef4e4-431">データ ソースが geo レプリケートされていない場合は、同じデータ ソースにある複数のインデクサーをポイントして、複数のリージョン内の Azure Search サービスがデータ ソースからのインデックス作成を継続的に単独で行うようにしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-431">If the data source is not geo-replicated, point multiple indexers at the same data source, so that Azure Search services in multiple regions continuously and independently index from the data source.</span></span> <span data-ttu-id="ef4e4-432">詳細については、「[Azure Search のパフォーマンスと最適化に関する考慮事項][search-optimization]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-432">For more information, see [Azure Search performance and optimization considerations][search-optimization].</span></span>

### <a name="storage"></a><span data-ttu-id="ef4e4-433">Storage</span><span class="sxs-lookup"><span data-stu-id="ef4e4-433">Storage</span></span>

<span data-ttu-id="ef4e4-434">**アプリケーション データには、読み取りアクセス geo 冗長ストレージ (RA-GRS)** を使用します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-434">**For application data, use read-access geo-redundant storage (RA-GRS).**</span></span> <span data-ttu-id="ef4e4-435">RA-GRS ストレージは、セカンダリ リージョンにデータをレプリケートし、セカンダリ リージョンからの読み取り専用のアクセスを提供します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-435">RA-GRS storage replicates the data to a secondary region, and provides read-only access from the secondary region.</span></span> <span data-ttu-id="ef4e4-436">プライマリ リージョンでストレージが停止した場合、アプリケーションはセカンダリ リージョンからデータを読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-436">If there is a storage outage in the primary region, the application can read the data from the secondary region.</span></span> <span data-ttu-id="ef4e4-437">詳細については、「[Azure Storage のレプリケーション](/azure/storage/storage-redundancy/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-437">For more information, see [Azure Storage replication](/azure/storage/storage-redundancy/).</span></span>

<span data-ttu-id="ef4e4-438">**VM ディスクには、Managed Disks を使用します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-438">**For VM disks, use Managed Disks.**</span></span> <span data-ttu-id="ef4e4-439">[Managed Disks][managed-disks] では、ディスクが単一障害点にならないように相互に十分に分離されるため、可用性セットの VM の信頼性が向上します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-439">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="ef4e4-440">また、Managed Disks はストレージ アカウントで作成した VHD 制限の対象ではありません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-440">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="ef4e4-441">詳細については、「[Azure での Windows 仮想マシンの可用性の管理][vm-manage-availability]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-441">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>

<span data-ttu-id="ef4e4-442">**Queue Storage では、別のリージョンにバックアップ キューを作成します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-442">**For Queue storage, create a backup queue in another region.**</span></span> <span data-ttu-id="ef4e4-443">Queue Storage の場合、項目のキューやデキューができないため、読み取り専用レプリカの使用は制限されています。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-443">For Queue storage, a read-only replica has limited use, because you can't queue or dequeue items.</span></span> <span data-ttu-id="ef4e4-444">代わりに、別のリージョンのストレージ アカウントにバックアップ キューを作成します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-444">Instead, create a backup queue in a storage account in another region.</span></span> <span data-ttu-id="ef4e4-445">ストレージの障害がある場合、アプリケーションは、プライマリ リージョンが再び使用可能になるまで、バックアップ キューを使用できます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-445">If there is a storage outage, the application can use the backup queue, until the primary region becomes available again.</span></span> <span data-ttu-id="ef4e4-446">したがって、アプリケーションは、引き続き新しい要求を処理できます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-446">That way, the application can still process new requests.</span></span>  

### <a name="sql-database"></a><span data-ttu-id="ef4e4-447">SQL Database</span><span class="sxs-lookup"><span data-stu-id="ef4e4-447">SQL Database</span></span>

<span data-ttu-id="ef4e4-448">**Standard または Premium 層を使用します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-448">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="ef4e4-449">これらの階層は、より長いポイントインタイム リストア期間 (35 日間) を提供します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-449">These tiers provide a longer point-in-time restore period (35 days).</span></span> <span data-ttu-id="ef4e4-450">詳細については、「[SQL Database のオプションとパフォーマンス](/azure/sql-database/sql-database-service-tiers/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-450">For more information, see [SQL Database options and performance](/azure/sql-database/sql-database-service-tiers/).</span></span>

<span data-ttu-id="ef4e4-451">**SQL Database の監査を有効にします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-451">**Enable SQL Database auditing.**</span></span> <span data-ttu-id="ef4e4-452">監査は、悪意のある攻撃や人的ミスの診断に使用できます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-452">Auditing can be used to diagnose malicious attacks or human error.</span></span> <span data-ttu-id="ef4e4-453">詳細については、「 [SQL Database 監査の使用](/azure/sql-database/sql-database-auditing-get-started/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-453">For more information, see [Get started with SQL database auditing](/azure/sql-database/sql-database-auditing-get-started/).</span></span>

<span data-ttu-id="ef4e4-454">**アクティブ Geo レプリケーションを使用します。** アクティブ Geo レプリケーションを使用して、さまざまなリージョンに読み取り可能なセカンダリ レプリカを作成します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-454">**Use Active Geo-Replication** Use Active Geo-Replication to create a readable secondary in a different region.</span></span>  <span data-ttu-id="ef4e4-455">プライマリ データベースに障害が発生した場合、またはオフラインにする必要がある場合は、セカンダリ データベースへの手動フェールオーバーを実行します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-455">If your primary database fails, or simply needs to be taken offline, perform a manual failover to the secondary database.</span></span>  <span data-ttu-id="ef4e4-456">セカンダリ データベースは、フェールオーバーするまでは読み取り専用のままです。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-456">Until you fail over, the secondary database remains read-only.</span></span>  <span data-ttu-id="ef4e4-457">詳細については、「[Azure SQL Database のアクティブ geo レプリケーション](/azure/sql-database/sql-database-geo-replication-overview/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-457">For more information, see [SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/).</span></span>

<span data-ttu-id="ef4e4-458">**シャーディングを使用します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-458">**Use sharding.**</span></span> <span data-ttu-id="ef4e4-459">シャーディングを使用して、データベースを水平方向にパーティション分割することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-459">Consider using sharding to partition the database horizontally.</span></span> <span data-ttu-id="ef4e4-460">シャーディングによって障害を分離できます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-460">Sharding can provide fault isolation.</span></span> <span data-ttu-id="ef4e4-461">詳細については、「[Azure SQL Database によるスケール アウト](/azure/sql-database/sql-database-elastic-scale-introduction/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-461">For more information, see [Scaling out with Azure SQL Database](/azure/sql-database/sql-database-elastic-scale-introduction/).</span></span>

<span data-ttu-id="ef4e4-462">**人的ミスから復旧するには、ポイントインタイム リストアを使用します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-462">**Use point-in-time restore to recover from human error.**</span></span>  <span data-ttu-id="ef4e4-463">ポイントインタイム リストアは、データベースを以前の特定の時点に戻します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-463">Point-in-time restore returns your database to an earlier point in time.</span></span> <span data-ttu-id="ef4e4-464">詳細については、「[データベースの自動バックアップを使用した Azure SQL Database の復旧][sql-restore]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-464">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>

<span data-ttu-id="ef4e4-465">**サービスの停止から復旧するには、geo リストアを使用します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-465">**Use geo-restore to recover from a service outage.**</span></span> <span data-ttu-id="ef4e4-466">geo リストアは geo 冗長バックアップからデータベースを復元します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-466">Geo-restore restores a database from a geo-redundant backup.</span></span>  <span data-ttu-id="ef4e4-467">詳細については、「[データベースの自動バックアップを使用した Azure SQL Database の復旧][sql-restore]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-467">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>

### <a name="sql-server-running-in-a-vm"></a><span data-ttu-id="ef4e4-468">VM で実行されている SQL Server</span><span class="sxs-lookup"><span data-stu-id="ef4e4-468">SQL Server running in a VM</span></span>

<span data-ttu-id="ef4e4-469">**データベースをレプリケートします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-469">**Replicate the database.**</span></span> <span data-ttu-id="ef4e4-470">データベースをレプリケートするには、SQL Server Always On 可用性グループを使用します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-470">Use SQL Server Always On Availability Groups to replicate the database.</span></span> <span data-ttu-id="ef4e4-471">1 つの SQL Server インスタンスが失敗した場合は、高可用性を提供してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-471">Provides high availability if one SQL Server instance fails.</span></span> <span data-ttu-id="ef4e4-472">詳細については、「[n 層アプリケーションの Windows VM を実行する](../reference-architectures/virtual-machines-windows/n-tier.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-472">For more information, see [Run Windows VMs for an N-tier application](../reference-architectures/virtual-machines-windows/n-tier.md)</span></span>

<span data-ttu-id="ef4e4-473">**データベースをバックアップします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-473">**Back up the database**.</span></span> <span data-ttu-id="ef4e4-474">既に [Azure Backup](https://azure.microsoft.com/documentation/services/backup/) を使用して VM をバックアップしている場合は、[DPM を使用した SQL Server ワークロード用 Azure Backup](/azure/backup/backup-azure-backup-sql/) を使用することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-474">If you are already using [Azure Backup](https://azure.microsoft.com/documentation/services/backup/) to back up your VMs, consider using [Azure Backup for SQL Server workloads using DPM](/azure/backup/backup-azure-backup-sql/).</span></span> <span data-ttu-id="ef4e4-475">このアプローチでは、組織用の 1 つのバックアップ管理者の役割と、VM および SQL Server 用の 1 つにまとめられた復旧手順があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-475">With this approach, there is one backup administrator role for the organization and a unified recovery procedure for VMs and SQL Server.</span></span> <span data-ttu-id="ef4e4-476">それ以外の場合は、[Microsoft Azure への SQL Server マネージ バックアップ](https://msdn.microsoft.com/library/dn449496.aspx)を使用してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-476">Otherwise, use [SQL Server Managed Backup to Microsoft Azure](https://msdn.microsoft.com/library/dn449496.aspx).</span></span>

### <a name="traffic-manager"></a><span data-ttu-id="ef4e4-477">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="ef4e4-477">Traffic Manager</span></span>

<span data-ttu-id="ef4e4-478">**手動フェールバックを実行します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-478">**Perform manual failback.**</span></span> <span data-ttu-id="ef4e4-479">Traffic Manager のフェールオーバーの後は、自動的にフェールバックするのではなく、手動フェールバックを実行してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-479">After a Traffic Manager failover, perform manual failback, rather than automatically failing back.</span></span> <span data-ttu-id="ef4e4-480">フェールバックする前に、すべてのアプリケーション サブシステムが正常であることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-480">Before failing back, verify that all application subsystems are healthy.</span></span>  <span data-ttu-id="ef4e4-481">これを行わないと、データセンター間でアプリケーションが切り替わる状況が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-481">Otherwise, you can create a situation where the application flips back and forth between data centers.</span></span> <span data-ttu-id="ef4e4-482">詳細については、「[高可用性を得るために複数のリージョンで VM を実行する](../reference-architectures/virtual-machines-windows/multi-region-application.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-482">For more information, see [Run VMs in multiple regions for high availability](../reference-architectures/virtual-machines-windows/multi-region-application.md).</span></span>

<span data-ttu-id="ef4e4-483">**正常性プローブのエンドポイントを作成します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-483">**Create a health probe endpoint.**</span></span> <span data-ttu-id="ef4e4-484">アプリケーションの全体的な正常性についてレポートするカスタム エンドポイントを作成してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-484">Create a custom endpoint that reports on the overall health of the application.</span></span> <span data-ttu-id="ef4e4-485">これにより、クリティカル パスが失敗した場合に、フロント エンドだけでなく Traffic Manager をフェールオーバーできます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-485">This enables Traffic Manager to fail over if any critical path fails, not just the front end.</span></span> <span data-ttu-id="ef4e4-486">エンドポイントは、重要な依存関係が正常でない場合、または到達できない場合に、HTTP エラー コードを返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-486">The endpoint should return an HTTP error code if any critical dependency is unhealthy or unreachable.</span></span> <span data-ttu-id="ef4e4-487">ただし、重要でないサービスについてはレポートしないでください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-487">Don't report errors for non-critical services, however.</span></span> <span data-ttu-id="ef4e4-488">そうしないと、必要のないときに正常性プローブがフェールオーバーをトリガーして、誤検知が生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-488">Otherwise, the health probe might trigger failover when it's not needed, creating false positives.</span></span> <span data-ttu-id="ef4e4-489">詳細については、「[Traffic Manager エンドポイントの監視とフェールオーバー](/azure/traffic-manager/traffic-manager-monitoring/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-489">For more information, see [Traffic Manager endpoint monitoring and failover](/azure/traffic-manager/traffic-manager-monitoring/).</span></span>

### <a name="virtual-machines"></a><span data-ttu-id="ef4e4-490">[Virtual Machines]</span><span class="sxs-lookup"><span data-stu-id="ef4e4-490">Virtual Machines</span></span>

<span data-ttu-id="ef4e4-491">**単一の VM で運用環境のワークロードを実行しないでください。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-491">**Avoid running a production workload on a single VM.**</span></span> <span data-ttu-id="ef4e4-492">単一の VM のデプロイには計画または計画外メンテナンスに対する回復力がありません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-492">A single VM deployment is not resilient to planned or unplanned maintenance.</span></span> <span data-ttu-id="ef4e4-493">代わりに、複数の VM を可用性セットまたは [VM スケール セット](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/)に配置し、前面にロード バランサーを配置してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-493">Instead, put multiple VMs in an availability set or [VM scale set](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/), with a load balancer in front.</span></span>

<span data-ttu-id="ef4e4-494">**VM をプロビジョニングするときに、可用性セットを指定します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-494">**Specify an availability set when you provision the VM.**</span></span> <span data-ttu-id="ef4e4-495">現時点では、VM がプロビジョニングされた後に、VM を可用性セットに追加する方法はありません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-495">Currently, there is no way to add a VM to an availability set after the VM is provisioned.</span></span> <span data-ttu-id="ef4e4-496">既存の可用性セットに新しい VM を追加するときは、必ず VM 用の NIC を作成し、NIC をロード バランサーのバックエンド アドレス プールに追加してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-496">When you add a new VM to an existing availability set, make sure to create a NIC for the VM, and add the NIC to the back-end address pool on the load balancer.</span></span> <span data-ttu-id="ef4e4-497">そうしないと、ロード バランサーがその VM にネットワーク トラフィックをルーティングしなくなります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-497">Otherwise, the load balancer won't route network traffic to that VM.</span></span>

<span data-ttu-id="ef4e4-498">**各アプリケーション層を別々の可用性セットに配置します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-498">**Put each application tier into a separate Availability Set.**</span></span> <span data-ttu-id="ef4e4-499">N 層のアプリケーションでは、同じ可用性セットの別の層からは VM を配置しないでください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-499">In an N-tier application, don't put VMs from different tiers into the same availability set.</span></span> <span data-ttu-id="ef4e4-500">可用性セット内の VM は、障害ドメイン (FD) と更新ドメイン (UD) にまたがって配置されています。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-500">VMs in an availability set are placed across fault domains (FDs) and update domains (UD).</span></span> <span data-ttu-id="ef4e4-501">ただし、FD と UD の冗長性の利点を活用するには、可用性セットのすべての VM が同じクライアント要求を処理できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-501">However, to get the redundancy benefit of FDs and UDs, every VM in the availability set must be able to handle the same client requests.</span></span>

<span data-ttu-id="ef4e4-502">**パフォーマンスの要件に基づいて適切な VM サイズを選択します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-502">**Choose the right VM size based on performance requirements.**</span></span> <span data-ttu-id="ef4e4-503">既存のワークロードを Azure に移動する場合は、オンプレミスのサーバーに最も適合性が高い VM サイズから開始します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-503">When moving an existing workload to Azure, start with the VM size that's the closest match to your on-premises servers.</span></span> <span data-ttu-id="ef4e4-504">次に、CPU、メモリ、およびディスクの IOPS について、実際のワークロードのパフォーマンスを測定し、必要に応じてサイズを調整します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-504">Then measure the performance of your actual workload with respect to CPU, memory, and disk IOPS, and adjust the size if needed.</span></span> <span data-ttu-id="ef4e4-505">これにより、アプリケーションがクラウド環境で期待どおりに動作することを確認できます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-505">This helps to ensure the application behaves as expected in a cloud environment.</span></span> <span data-ttu-id="ef4e4-506">また、複数の NIC が必要な場合は、各サイズの NIC の制限に注意してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-506">Also, if you need multiple NICs, be aware of the NIC limit for each size.</span></span>

<span data-ttu-id="ef4e4-507">**VHD 用の Managed Disks を使用します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-507">**Use Managed Disks for VHDs.**</span></span> <span data-ttu-id="ef4e4-508">[Managed Disks][managed-disks] では、ディスクが単一障害点にならないように相互に十分に分離されるため、可用性セットの VM の信頼性が向上します。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-508">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="ef4e4-509">また、Managed Disks はストレージ アカウントで作成した VHD 制限の対象ではありません。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-509">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="ef4e4-510">詳細については、「[Azure での Windows 仮想マシンの可用性の管理][vm-manage-availability]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-510">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>

<span data-ttu-id="ef4e4-511">**OS ディスクではなく、データ ディスクにアプリケーションをインストールします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-511">**Install applications on a data disk, not the OS disk.**</span></span> <span data-ttu-id="ef4e4-512">そうしないと、ディスク サイズの上限に達する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-512">Otherwise, you may reach the disk size limit.</span></span>

<span data-ttu-id="ef4e4-513">**Azure Backup を使用して VM をバックアップします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-513">**Use Azure Backup to back up VMs.**</span></span> <span data-ttu-id="ef4e4-514">バックアップにより偶発的なデータ損失から保護されます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-514">Backups protect against accidental data loss.</span></span> <span data-ttu-id="ef4e4-515">詳細については、「[Recovery Services コンテナーを使用した Azure VM の保護](/azure/backup/backup-azure-vms-first-look-arm/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-515">For more information, see [Protect Azure VMs with a recovery services vault](/azure/backup/backup-azure-vms-first-look-arm/).</span></span>

<span data-ttu-id="ef4e4-516">基本的な正常性メトリック、インフラストラクチャ ログ、および[ブート診断][boot-diagnostics]などの**診断ログ**を有効にします。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-516">**Enable diagnostic logs**, including basic health metrics, infrastructure logs, and [boot diagnostics][boot-diagnostics].</span></span> <span data-ttu-id="ef4e4-517">VM が起動不可能な状態になった場合は、起動エラーを診断するのにブート診断が役立ちます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-517">Boot diagnostics can help you diagnose a boot failure if your VM gets into a non-bootable state.</span></span> <span data-ttu-id="ef4e4-518">詳細については、「[Azure 診断ログの概要][diagnostics-logs]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-518">For more information, see [Overview of Azure Diagnostic Logs][diagnostics-logs].</span></span>

<span data-ttu-id="ef4e4-519">**AzureLogCollector 拡張機能を使用します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-519">**Use the AzureLogCollector extension.**</span></span> <span data-ttu-id="ef4e4-520">(Windows VM のみ)この拡張機能は、オペレーターがリモートで VM にログを記録しなくても、Azure プラットフォームのログを集計し、それを Azure ストレージにアップロードします。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-520">(Windows VMs only.) This extension aggregates Azure platform logs and uploads them to Azure storage, without the operator remotely logging into the VM.</span></span> <span data-ttu-id="ef4e4-521">詳細については、「[AzureLogCollector 拡張機能](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-521">For more information, see [AzureLogCollector Extension](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

### <a name="virtual-network"></a><span data-ttu-id="ef4e4-522">仮想ネットワーク</span><span class="sxs-lookup"><span data-stu-id="ef4e4-522">Virtual Network</span></span>

<span data-ttu-id="ef4e4-523">**パブリック IP アドレスをホワイトリストに登録したりブロックしたりするには、サブネットに NSG を追加します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-523">**To whitelist or block public IP addresses, add an NSG to the subnet.**</span></span> <span data-ttu-id="ef4e4-524">悪意のあるユーザーからのアクセスをブロックしたり、アプリケーションにアクセスする権限を持つユーザーからのアクセスのみを許可したりしてください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-524">Block access from malicious users, or allow access only from users who have privilege to access the application.</span></span>  

<span data-ttu-id="ef4e4-525">**カスタムの正常性プローブを作成します。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-525">**Create a custom health probe.**</span></span> <span data-ttu-id="ef4e4-526">ロード バランサー正常性プローブでは、HTTP または TCP のいずれかをテストできます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-526">Load Balancer Health Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="ef4e4-527">VM が HTTP サーバーを実行している場合、HTTP プローブは TCP プローブよりも優れた正常性状態のインジケーターです。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-527">If a VM runs an HTTP server, the HTTP probe is a better indicator of health status than a TCP probe.</span></span> <span data-ttu-id="ef4e4-528">HTTP プローブでは、すべての重要な依存関係を含む、アプリケーションの全体的な正常性をレポートするカスタム エンドポイントを使用してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-528">For an HTTP probe, use a custom endpoint that reports the overall health of the application, including all critical dependencies.</span></span> <span data-ttu-id="ef4e4-529">詳細については、「 [Azure ロード バランサーの概要](/azure/load-balancer/load-balancer-overview/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-529">For more information, see [Azure Load Balancer overview](/azure/load-balancer/load-balancer-overview/).</span></span>

<span data-ttu-id="ef4e4-530">**正常性プローブをブロックしないでください。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-530">**Don't block the health probe.**</span></span> <span data-ttu-id="ef4e4-531">ロード バランサー正常性プローブは、既知の IP アドレスである 168.63.129.16 から送信されます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-531">The Load Balancer Health probe is sent from a known IP address, 168.63.129.16.</span></span> <span data-ttu-id="ef4e4-532">任意のファイアウォール ポリシーまたはネットワーク セキュリティ グループ (NSG) の規則で、この IP を送受信するトラフィックをブロックしないでください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-532">Don't block traffic to or from this IP in any firewall policies or network security group (NSG) rules.</span></span> <span data-ttu-id="ef4e4-533">正常性プローブをブロックすると、ロード バランサーによってローテーションから VM が削除されることがあります。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-533">Blocking the health probe would cause the load balancer to remove the VM from rotation.</span></span>

<span data-ttu-id="ef4e4-534">**ロード バランサーのログ記録を有効にします。**</span><span class="sxs-lookup"><span data-stu-id="ef4e4-534">**Enable Load Balancer logging.**</span></span> <span data-ttu-id="ef4e4-535">ログには、プローブの応答に失敗したことが原因で、ネットワーク トラフィックを受信していない、バックエンドの VM 数が表示されます。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-535">The logs show how many VMs on the back-end are not receiving network traffic due to failed probe responses.</span></span> <span data-ttu-id="ef4e4-536">詳細については、「[Azure Load Balancer のログ分析](/azure/load-balancer/load-balancer-monitor-log/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="ef4e4-536">For more information, see [Log analytics for Azure Load Balancer](/azure/load-balancer/load-balancer-monitor-log/).</span></span>


<!-- links -->
[app-service-autoscale]: /azure/monitoring-and-diagnostics/insights-how-to-scale/
[asynchronous-c-sharp]: /dotnet/articles/csharp/async
[availability-sets]:/azure/virtual-machines/virtual-machines-windows-manage-availability/
[azure-backup]: https://azure.microsoft.com/documentation/services/backup/
[boot-diagnostics]: https://azure.microsoft.com/blog/boot-diagnostics-for-virtual-machines-v2/
[circuit-breaker]: ../patterns/circuit-breaker.md
[cloud-service-autoscale]: /azure/cloud-services/cloud-services-how-to-scale/
[diagnostics-logs]: /azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs/
[fma]: ../resiliency/failure-mode-analysis.md
[resilient-deployment]: ../resiliency/index.md#resilient-deployment
[load-balancer]: /azure/load-balancer/load-balancer-overview/
[managed-disks]: /azure/storage/storage-managed-disks-overview
[monitoring-and-diagnostics-guidance]: ../best-practices/monitoring.md
[resource-manager]: /azure/azure-resource-manager/resource-group-overview/
[retry-pattern]: ../patterns/retry.md
[retry-service-guidance]: ../best-practices/retry-service-specific.md
[search-optimization]: /azure/search/search-performance-optimization/
[sql-backup]: /azure/sql-database/sql-database-automated-backups/
[sql-restore]: /azure/sql-database/sql-database-recovery-using-backups/
[traffic-manager]: /azure/traffic-manager/traffic-manager-overview/
[traffic-manager-routing]: /azure/traffic-manager/traffic-manager-routing-methods/
[vm-manage-availability]: /azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set
[vmss-autoscale]: /azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview/
