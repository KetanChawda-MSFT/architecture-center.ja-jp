---
title: "Azure アプリケーションのディザスター リカバリー"
description: "Microsoft Azure でのディザスター リカバリーに対応したアプリケーションを設計するための方法に関する技術的概要と詳細。"
author: adamglick
ms.date: 05/26/2017
ms.openlocfilehash: d415b27dd7928996e2a6dc7fd8fcf6a77c835768
ms.sourcegitcommit: b0482d49aab0526be386837702e7724c61232c60
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/14/2017
---
[!INCLUDE [header](../_includes/header.md)]
# <a name="disaster-recovery-for-azure-applications"></a><span data-ttu-id="8c613-103">Azure アプリケーションのディザスター リカバリー</span><span class="sxs-lookup"><span data-stu-id="8c613-103">Disaster recovery for Azure applications</span></span>
<span data-ttu-id="8c613-104">回復性戦略および高可用性戦略は、一時的な障害状態を処理することを目的とします。</span><span class="sxs-lookup"><span data-stu-id="8c613-104">Resiliency and high availability strategies are intended to handling temporary failure conditions.</span></span> <span data-ttu-id="8c613-105">ディザスター リカバリー (DR) は、アプリケーションの機能の致命的な損失からの復旧に重点を置きます。</span><span class="sxs-lookup"><span data-stu-id="8c613-105">Disaster recovery (DR) is focused on recovering from a catastrophic loss of application functionality.</span></span> <span data-ttu-id="8c613-106">たとえば、アプリケーションをホストしている Azure リージョンが使用できなくなった場合は、アプリケーションの実行またはデータへのアクセスを別のリージョンで行うための計画が必要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-106">For example, if an Azure region hosting your application becomes unavailable, you need a plan for running your application or accessing your data in another region.</span></span> <span data-ttu-id="8c613-107">この計画の実行には、システムを継続的に機能できるようにするユーザー、プロセス、およびサポート アプリケーションが必要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-107">Executing this plan involves people, processes, and supporting applications that allow the system to continue functioning.</span></span> <span data-ttu-id="8c613-108">計画が完全かどうかを確認するために、計画には、障害のリハーサルおよびデータベースの復旧テストを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-108">Your plan should include rehearsing failures and testing the recovery of databases to ensure the plan is sound.</span></span> <span data-ttu-id="8c613-109">また、システムの障害運用モードを定義するビジネスおよびテクノロジの所有者は、障害発生中に必要なサービスの機能レベルも決定します。</span><span class="sxs-lookup"><span data-stu-id="8c613-109">The business and technology owners who define the system's operational mode for a disaster also determine the level of service functionality required during a disaster.</span></span> <span data-ttu-id="8c613-110">この機能レベルには、完全に使用不可能、機能制限または処理の遅延により部分的に使用可能、完全に使用可能など、いくつかの形態があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-110">This level of functionality can take a few forms: completely unavailable, partially available via reduced functionality or delayed processing, or fully available.</span></span>

## <a name="azure-disaster-recovery-features"></a><span data-ttu-id="8c613-111">Azure のディザスター リカバリー機能</span><span class="sxs-lookup"><span data-stu-id="8c613-111">Azure disaster recovery features</span></span>
<span data-ttu-id="8c613-112">可用性を考慮して、Azure にはディザスター リカバリーをサポートするために設計された[回復性技術ガイダンス](./index.md)が用意されています。</span><span class="sxs-lookup"><span data-stu-id="8c613-112">As with availability considerations, Azure provides [resiliency technical guidance](./index.md) designed to support disaster recovery.</span></span> <span data-ttu-id="8c613-113">また、Azure の可用性機能とディザスター リカバリーには関連性があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-113">There is also a relationship between availability features of Azure and disaster recovery.</span></span> <span data-ttu-id="8c613-114">たとえば、複数の障害ドメインを対象にロールを管理すると、アプリケーションの可用性が向上します。</span><span class="sxs-lookup"><span data-stu-id="8c613-114">For example, the management of roles across fault domains increases the availability of an application.</span></span> <span data-ttu-id="8c613-115">そのような管理を行わないと、ハンドルされないハードウェア障害が "障害" シナリオになります。</span><span class="sxs-lookup"><span data-stu-id="8c613-115">Without that management, an unhandled hardware failure would become a “disaster” scenario.</span></span> <span data-ttu-id="8c613-116">これらの可用性機能および可用性戦略を活用することは、ご利用のアプリケーションの障害対策における重要な側面です。</span><span class="sxs-lookup"><span data-stu-id="8c613-116">Leveraging these availability features and strategies is an important part of disaster-proofing your application.</span></span> <span data-ttu-id="8c613-117">ただし、この記事では、一般的な可用性の問題に留まらず、さらに重大な (かつまれな) 障害イベントについて考えます。</span><span class="sxs-lookup"><span data-stu-id="8c613-117">However, this article goes beyond general availability issues to more serious (and rarer) disaster events.</span></span>

## <a name="multiple-datacenter-regions"></a><span data-ttu-id="8c613-118">複数のデータセンター リージョン</span><span class="sxs-lookup"><span data-stu-id="8c613-118">Multiple datacenter regions</span></span>
<span data-ttu-id="8c613-119">Azure のデータセンターは、世界中のさまざまなリージョンにあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-119">Azure maintains datacenters in many regions around the world.</span></span> <span data-ttu-id="8c613-120">このインフラストラクチャにより、システムによって行われる Azure Storage のセカンダリ リージョンへの geo レプリケーションなど、複数のディザスター リカバリー シナリオがサポートされます。</span><span class="sxs-lookup"><span data-stu-id="8c613-120">This infrastructure supports several disaster recovery scenarios, such as system-provided geo-replication of Azure Storage to secondary regions.</span></span> <span data-ttu-id="8c613-121">また、世界中の複数の場所にクラウド サービスを簡単かつ安価にデプロイすることもできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-121">You can also easily and inexpensively deploy a cloud service to multiple locations around the world.</span></span> <span data-ttu-id="8c613-122">複数のリージョンで独自にデータセンターを構築し維持する場合のコストおよび難しさと比べてみてください。</span><span class="sxs-lookup"><span data-stu-id="8c613-122">Compare this with the cost and difficulty of building and maintaining your own datacenters in multiple regions.</span></span> <span data-ttu-id="8c613-123">複数のリージョンにデータとサービスをデプロイすると、1 つのリージョンでの大規模な停止からアプリケーションを保護するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="8c613-123">Deploying data and services to multiple regions helps protect your application from a major outage in a single region.</span></span> <span data-ttu-id="8c613-124">ディザスター リカバリー計画を策定するときには、ペアになっているリージョンの概念を理解することが重要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-124">As you design your disaster recovery plan, it’s important to understand the concept of paired regions.</span></span> <span data-ttu-id="8c613-125">詳細については、「[ビジネス継続性とディザスター リカバリー (BCDR): Azure のペアになっているリージョン](/azure/best-practices-availability-paired-regions)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="8c613-125">For more information, see [Business continuity and disaster recovery (BCDR): Azure Paired Regions](/azure/best-practices-availability-paired-regions).</span></span>

## <a name="azure-traffic-manager"></a><span data-ttu-id="8c613-126">Azure の Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="8c613-126">Azure Traffic Manager</span></span>
<span data-ttu-id="8c613-127">リージョンに固有の障害が発生した場合は、別のリージョンのサービスまたはデプロイにトラフィックをリダイレクトする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-127">When a region-specific failure occurs, you must redirect traffic to services or deployments in another region.</span></span> <span data-ttu-id="8c613-128">これについては、Azure の Traffic Manager (プライマリ リージョンで障害が発生した場合にユーザー トラフィックを別のリージョンに自動的にフェールオーバーする) などのサービスを介して処理するのが最も効果的です。</span><span class="sxs-lookup"><span data-stu-id="8c613-128">It is most effective to handle this via services such as Azure Traffic Manager, which automates the failover of user traffic to another region if the primary region fails.</span></span> <span data-ttu-id="8c613-129">効果的な DR 戦略を設計する場合には、Traffic Manager の基本を理解することが重要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-129">Understanding the fundamentals of Traffic Manager is important when designing an effective DR strategy.</span></span>

<span data-ttu-id="8c613-130">Traffic Manager では、ドメイン ネーム システム (DNS) を使用して、トラフィック ルーティング方法とエンドポイントの正常性に基づいて最適なエンドポイントにクライアント要求を送信します。</span><span class="sxs-lookup"><span data-stu-id="8c613-130">Traffic Manager uses the Domain Name System (DNS) to direct client requests to the most appropriate endpoint based on a traffic-routing method and the health of the endpoints.</span></span> <span data-ttu-id="8c613-131">次の図で、ユーザーは、実際のサイト URL (`http://app1URL.cloudapp.net` と `http://app2URL.cloudapp.net`) を抽象化した Traffic Manager URL (`http://myATMURL.trafficmanager.net`) に接続しています。</span><span class="sxs-lookup"><span data-stu-id="8c613-131">In the following diagram, users connect to a Traffic Manager URL (`http://myATMURL.trafficmanager.net`) which abstracts the actual site URLs (`http://app1URL.cloudapp.net` and `http://app2URL.cloudapp.net`).</span></span> <span data-ttu-id="8c613-132">ユーザー要求は、構成した [Traffic Manager のルーティング方法](/azure/traffic-manager/traffic-manager-routing-methods)に基づいて、適切な基になる URL にルーティングされます。</span><span class="sxs-lookup"><span data-stu-id="8c613-132">User requests are routed to the proper underlying URL based on your configured [Traffic Manager routing method](/azure/traffic-manager/traffic-manager-routing-methods).</span></span> <span data-ttu-id="8c613-133">この記事では、フェールオーバー オプションのみを考慮します。</span><span class="sxs-lookup"><span data-stu-id="8c613-133">For the sake of this article, we will be concerned with only the failover option.</span></span>

![Routing via Azure Traffic Manager](./images/disaster-recovery-azure-applications/routing-using-azure-traffic-manager.png)

<span data-ttu-id="8c613-135">Traffic Manager を構成する場合は、新しい Traffic Manager の DNS プレフィックスを指定します。ユーザーはこれを使用して所定のサービスにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="8c613-135">When configuring Traffic Manager, you provide a new Traffic Manager DNS prefix, which users will use to access your service.</span></span> <span data-ttu-id="8c613-136">これにより、Traffic Manager はリージョン レベルより 1 レベル上で負荷分散を抽象化します。</span><span class="sxs-lookup"><span data-stu-id="8c613-136">Traffic Manager now abstracts load balancing one level higher that the regional level.</span></span> <span data-ttu-id="8c613-137">Traffic Manager の DNS は、管理するすべてのデプロイの CNAME レコードに対応します。</span><span class="sxs-lookup"><span data-stu-id="8c613-137">The Traffic Manager DNS maps to a CNAME for all the deployments that it manages.</span></span>

<span data-ttu-id="8c613-138">Traffic Manager 内では、障害発生時にユーザーがルーティングされるデプロイの優先度リストを指定します。</span><span class="sxs-lookup"><span data-stu-id="8c613-138">Within Traffic Manager, you specify a prioritized list of deployments that users will be routed to when failure occurs.</span></span> <span data-ttu-id="8c613-139">Traffic Manager はデプロイのエンドポイントを監視します。</span><span class="sxs-lookup"><span data-stu-id="8c613-139">Traffic Manager monitors the deployment endpoints.</span></span> <span data-ttu-id="8c613-140">プライマリ デプロイが利用不可になった場合、Traffic Manager は優先度リストに登録されている次のデプロイにユーザーをルーティングします。</span><span class="sxs-lookup"><span data-stu-id="8c613-140">If the primary deployment becomes unavailable, Traffic Manager routes users to the next deployment on the priority list.</span></span>

<span data-ttu-id="8c613-141">フェールオーバー先は Traffic Manager が決定しますが、ユーザーはフェールオーバー モードではないときにフェールオーバー ドメインを休止状態にするかアクティブにするかを決定できます (これは Traffic Manager には関係ありません)。</span><span class="sxs-lookup"><span data-stu-id="8c613-141">Although Traffic Manager decides where to go during a failover, you can decide whether your failover domain is dormant or active while you're not in failover mode (which is unrelated to Traffic Manager).</span></span> <span data-ttu-id="8c613-142">プライマリ サイトが現在、ユーザーにサービスを提供しているかどうかに関係なく、Traffic Manager はプライマリ サイトでの障害を検出し、フェールオーバー サイトへのロールオーバーを実行します。</span><span class="sxs-lookup"><span data-stu-id="8c613-142">Traffic Manager detects a failure in the primary site and rolls over to the failover site, regardless of whether that site is currently serving users.</span></span>

<span data-ttu-id="8c613-143">Azure Traffic Manager の機能の詳細については、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-143">For more information on how Azure Traffic Manager works, refer to:</span></span>

* [<span data-ttu-id="8c613-144">Traffic Manager の概要</span><span class="sxs-lookup"><span data-stu-id="8c613-144">Traffic Manager overview</span></span>](/azure/traffic-manager/traffic-manager-overview/)
* [<span data-ttu-id="8c613-145">Traffic Manager のルーティング方法</span><span class="sxs-lookup"><span data-stu-id="8c613-145">Traffic Manager routing methods</span></span>](/azure/traffic-manager/traffic-manager-routing-methods)
* [<span data-ttu-id="8c613-146">フェールオーバーのルーティング方法の構成</span><span class="sxs-lookup"><span data-stu-id="8c613-146">Configure failover routing method</span></span>](/azure/traffic-manager/traffic-manager-configure-failover-routing-method/)

## <a name="azure-disaster-scenarios"></a><span data-ttu-id="8c613-147">Azure の障害シナリオ</span><span class="sxs-lookup"><span data-stu-id="8c613-147">Azure disaster scenarios</span></span>
<span data-ttu-id="8c613-148">以下のセクションでは、障害シナリオのさまざまな種類について説明します。</span><span class="sxs-lookup"><span data-stu-id="8c613-148">The following sections cover several different types of disaster scenarios.</span></span> <span data-ttu-id="8c613-149">リージョン全体にわたるサービスの中断が、アプリケーション全体の障害の唯一の原因ではありません。</span><span class="sxs-lookup"><span data-stu-id="8c613-149">Region-wide service disruptions are not the only cause of application-wide failures.</span></span> <span data-ttu-id="8c613-150">不適切な設計および管理エラーも停止の原因になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-150">Poor design and administrative errors can also lead to outages.</span></span> <span data-ttu-id="8c613-151">復旧計画の設計フェーズとテスト フェーズの両方で、障害が発生する可能性のある原因を検討することが重要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-151">It's important to consider the possible causes of a failure during both the design and testing phases of your recovery plan.</span></span> <span data-ttu-id="8c613-152">適切な計画を作成するには、Azure の機能を利用したうえで、アプリケーション固有の戦略に合わせて補強します。</span><span class="sxs-lookup"><span data-stu-id="8c613-152">A good plan takes advantage of Azure features and augments them with application-specific strategies.</span></span> <span data-ttu-id="8c613-153">どのような対応を選択するかは、アプリケーションの重要性、目標復旧時点 (RPO)、目標復旧時間 (RTO) によって決まります。</span><span class="sxs-lookup"><span data-stu-id="8c613-153">The chosen response is determined by the importance of the application, the recovery point objective (RPO), and the recovery time objective (RTO).</span></span>

### <a name="application-failure"></a><span data-ttu-id="8c613-154">アプリケーションの障害</span><span class="sxs-lookup"><span data-stu-id="8c613-154">Application failure</span></span>
<span data-ttu-id="8c613-155">Azure Traffic Manager は、ホスト仮想マシンの基になるハードウェアまたはオペレーティング システム ソフトウェアに起因する障害を自動的に処理します。</span><span class="sxs-lookup"><span data-stu-id="8c613-155">Azure Traffic Manager automatically handles failures that result from the underlying hardware or operating system software in the host virtual machine.</span></span> <span data-ttu-id="8c613-156">Azure は新しいロール インスタンスを作成し、使用可能なプールに追加します。</span><span class="sxs-lookup"><span data-stu-id="8c613-156">Azure creates a new role instance and adds it to the available pool.</span></span> <span data-ttu-id="8c613-157">複数のロール インスタンスが既に実行されている場合、Azure は、障害が発生したノードを交換している間、実行している他のロール インスタンスに処理を移動します。</span><span class="sxs-lookup"><span data-stu-id="8c613-157">If  more than one role instance was already running, Azure shifts processing to the other running role instances while replacing the failed node.</span></span>

<span data-ttu-id="8c613-158">ハードウェアまたはオペレーティング システムに基になる障害がなくても、重大なアプリケーション エラーが発生する場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-158">Serious application errors can occur without any underlying failure of the hardware or operating system.</span></span> <span data-ttu-id="8c613-159">不適切なロジックやデータ整合性の問題が原因の致命的な例外により、アプリケーションで障害が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-159">The application might fail due to catastrophic exceptions caused by bad logic or data integrity issues.</span></span> <span data-ttu-id="8c613-160">十分なテレメトリをアプリケーション コードに組み込み、監視システムが障害状態を検出して、アプリケーション管理者に通知できるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-160">You must include sufficient telemetry in the application code so that a monitoring system can detect failure conditions and notify an application administrator.</span></span> <span data-ttu-id="8c613-161">ディザスター リカバリー プロセスに関して豊富な知識を持つ管理者は、重大なエラーの解決中に、フェールオーバー プロセスを呼び出すか、可用性の停止を受け入れるかを決定することができます。</span><span class="sxs-lookup"><span data-stu-id="8c613-161">An administrator who has full knowledge of the disaster recovery processes can decide whether to trigger a failover process or accept an availability outage while resolving the critical errors.</span></span>

### <a name="data-corruption"></a><span data-ttu-id="8c613-162">データの破損</span><span class="sxs-lookup"><span data-stu-id="8c613-162">Data corruption</span></span>
<span data-ttu-id="8c613-163">Azure は自動的に、Azure SQL Database と Azure Storage のデータを、同じリージョン内の異なる障害ドメインに 3 回冗長的に格納します。</span><span class="sxs-lookup"><span data-stu-id="8c613-163">Azure automatically stores Azure SQL Database and Azure Storage data three times redundantly within different fault domains in the same region.</span></span> <span data-ttu-id="8c613-164">geo レプリケーションを使用している場合は、さらに 3 回、異なるリージョンに格納します。</span><span class="sxs-lookup"><span data-stu-id="8c613-164">If you use geo-replication, the data is stored three additional times in a different region.</span></span> <span data-ttu-id="8c613-165">ただし、ユーザーまたはアプリケーションがプライマリ コピーでデータを破損した場合は、たちまち他のコピーにレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="8c613-165">However, if your users or your application corrupts that data in the primary copy, the data quickly replicates to the other copies.</span></span> <span data-ttu-id="8c613-166">残念ながら、結果として破損したデータのコピーが複数作成されます。</span><span class="sxs-lookup"><span data-stu-id="8c613-166">Unfortunately, this results in multiple copies of corrupt data.</span></span>

<span data-ttu-id="8c613-167">データが破損する可能性を管理するには、2 つのオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-167">To manage potential corruption of your data, you have two options.</span></span> <span data-ttu-id="8c613-168">第 1 の方法は、カスタム バックアップの管理です。</span><span class="sxs-lookup"><span data-stu-id="8c613-168">First, you can manage a custom backup strategy.</span></span> <span data-ttu-id="8c613-169">ビジネス要件やガバナンス規定に応じて、Azure またはオンプレミスにバックアップを格納できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-169">You can store your backups in Azure or on-premises, depending on your business requirements or governance regulations.</span></span> <span data-ttu-id="8c613-170">第 2 の方法は、SQL Database を復旧するためのポイントインタイム リストア オプションの使用です。</span><span class="sxs-lookup"><span data-stu-id="8c613-170">Another option is to use the point-in-time restore option to recover a SQL database.</span></span> <span data-ttu-id="8c613-171">詳細については、後述する[ディザスター リカバリーのためのデータ戦略](#data-strategies-for-disaster-recovery)に関するセクションをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="8c613-171">For more information, see the [data strategies for disaster recovery](#data-strategies-for-disaster-recovery) section below.</span></span>

### <a name="network-outage"></a><span data-ttu-id="8c613-172">ネットワークの停止</span><span class="sxs-lookup"><span data-stu-id="8c613-172">Network outage</span></span>
<span data-ttu-id="8c613-173">Azure ネットワークの一部にアクセスできないと、アプリケーションまたはデータを利用できなくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-173">When parts of the Azure network are inaccessible, you may be unable to access your application or data.</span></span> <span data-ttu-id="8c613-174">ネットワークの問題のために利用できないロール インスタンスがある場合、Azure はアプリケーションの残りの使用可能なインスタンスを利用します。</span><span class="sxs-lookup"><span data-stu-id="8c613-174">If one or more role instances are unavailable due to network issues, Azure uses the remaining available instances of your application.</span></span> <span data-ttu-id="8c613-175">Azure ネットワークの停止のためにアプリケーションがデータにアクセスできない場合でも、キャッシュされているデータを使用すれば、アプリケーションの機能を制限した状態でローカルに実行できる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-175">If your application cannot access its data because of an Azure network outage, you can potentially run with reduced application functionality locally by using cached data.</span></span> <span data-ttu-id="8c613-176">アプリケーションの機能を制限して実行するには、ディザスター リカバリー戦略を設計する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-176">You need to design the disaster recovery strategy to run with reduced functionality in your application.</span></span> <span data-ttu-id="8c613-177">ただし、アプリケーションによっては現実的ではないことがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-177">For some applications, this might not be practical.</span></span>

<span data-ttu-id="8c613-178">もう 1 つのオプションは、接続が回復するまで別の場所にデータを格納することです。</span><span class="sxs-lookup"><span data-stu-id="8c613-178">Another option is to store data in an alternate location until connectivity is restored.</span></span> <span data-ttu-id="8c613-179">機能の制限を使用できない場合に残されているオプションは、アプリケーションのダウンタイムまたは代替リージョンへのフェールオーバーです。</span><span class="sxs-lookup"><span data-stu-id="8c613-179">If reducing functionality is not an option, the remaining options are application downtime or failover to an alternate region.</span></span> <span data-ttu-id="8c613-180">機能を制限して実行するアプリケーションの設計は、技術的な決定であると同時にビジネス上の決定でもあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-180">The design of an application running with reduced functionality is as much a business decision as a technical one.</span></span> <span data-ttu-id="8c613-181">この詳細については、「[アプリケーションの機能制限](#reduced-application-functionality)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-181">This is discussed further in the section on [reduced application functionality](#reduced-application-functionality).</span></span>

### <a name="failure-of-a-dependent-service"></a><span data-ttu-id="8c613-182">依存サービスの障害</span><span class="sxs-lookup"><span data-stu-id="8c613-182">Failure of a dependent service</span></span>
<span data-ttu-id="8c613-183">Azure では、定期的にダウンタイムが発生する可能性のある多くのサービスが提供されています。</span><span class="sxs-lookup"><span data-stu-id="8c613-183">Azure provides many services that can experience periodic downtime.</span></span> <span data-ttu-id="8c613-184">たとえば、[Azure Redis Cache](https://azure.microsoft.com/services/cache/) は、アプリケーションにキャッシュ機能を提供するマルチテナント サービスです。</span><span class="sxs-lookup"><span data-stu-id="8c613-184">For example, [Azure Redis Cache](https://azure.microsoft.com/services/cache/) is a multi-tenant service which provides caching capabilities to your application.</span></span> <span data-ttu-id="8c613-185">依存サービスが利用できない場合にアプリケーションがどのようになるかを考慮することが重要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-185">It's important to consider what happens in your application if the dependent service is unavailable.</span></span> <span data-ttu-id="8c613-186">多くの点で、このシナリオはネットワーク停止シナリオに似ています。</span><span class="sxs-lookup"><span data-stu-id="8c613-186">In many ways, this scenario is similar to the network outage scenario.</span></span> <span data-ttu-id="8c613-187">ただし、各サービスを個別に考慮することで、計画全体が向上する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-187">However, considering each service independently results in potential improvements to your overall plan.</span></span>

<span data-ttu-id="8c613-188">Azure Redis Cache は、クラウド サービスのデプロイ内からアプリケーションにキャッシュを提供し、ディザスター リカバリーのメリットがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-188">Azure Redis Cache provides caching to your application from within your cloud service deployment, which provides disaster recovery benefits.</span></span> <span data-ttu-id="8c613-189">何よりもまず、サービスはデプロイにローカルなロールで実行しています。</span><span class="sxs-lookup"><span data-stu-id="8c613-189">First, the service now runs on roles that are local to your deployment.</span></span> <span data-ttu-id="8c613-190">そのため、クラウド サービスの全体的な管理プロセスの一部として、キャッシュの状態を監視および管理できるようになります。</span><span class="sxs-lookup"><span data-stu-id="8c613-190">Therefore, you're better able to monitor and manage the status of the cache as part of your overall management processes for the cloud service.</span></span> <span data-ttu-id="8c613-191">この種のキャッシュでは、キャッシュされたデータの高可用性などの新しい機能も利用できます。この機能では、重複したコピーを他のノードで維持することにより、単一のノードで障害が発生した場合に、キャッシュされたデータを保護します。</span><span class="sxs-lookup"><span data-stu-id="8c613-191">This type of caching also exposes new features such as high availability for cached data, which preserves cached data if a single node fails by maintaining duplicate copies on other nodes.</span></span>

<span data-ttu-id="8c613-192">高可用性を使用すると、書き込み操作でセカンダリ コピーを更新することも必要であるため、スループットが低下し、待機時間が長くなることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-192">Note that high availability decreases throughput and increases latency because write operations must also upedate any secondary copies.</span></span> <span data-ttu-id="8c613-193">キャッシュされたデータを格納するために必要なメモリ量は事実上 2 倍になるので、容量計画の策定時には、このことを考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-193">The amount of memory required to store the cached data is effectively doubled, which must be taken into account during capacity planning.</span></span>  <span data-ttu-id="8c613-194">この例では、各依存サービスが、全体的な可用性と致命的な障害に対する抵抗力を高める可能性があることを示します。</span><span class="sxs-lookup"><span data-stu-id="8c613-194">This example demonstrates that each dependent service might have capabilities that improve your overall availability and resistance to catastrophic failures.</span></span>

<span data-ttu-id="8c613-195">各依存サービスについて、サービス中断の影響を理解する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-195">With each dependent service, you should understand the implications of a service disruption.</span></span> <span data-ttu-id="8c613-196">キャッシュの例では、キャッシュが復元されるまで、データベースのデータに直接アクセスできる場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-196">In the caching example, it might be possible to access the data directly from a database until you restore your cache.</span></span> <span data-ttu-id="8c613-197">その場合は、アプリケーション データへのフル アクセスを提供する間、パフォーマンスが低下することになります。</span><span class="sxs-lookup"><span data-stu-id="8c613-197">This would result in reduced performance while providing full access to application data.</span></span>

### <a name="region-wide-service-disruption"></a><span data-ttu-id="8c613-198">リージョン全体にわたるサービスの停止</span><span class="sxs-lookup"><span data-stu-id="8c613-198">Region-wide service disruption</span></span>
<span data-ttu-id="8c613-199">これまでの障害は主として、同じ Azure リージョン内で管理できる障害でした。</span><span class="sxs-lookup"><span data-stu-id="8c613-199">The previous failures have primarily been failures that can be managed within the same Azure region.</span></span> <span data-ttu-id="8c613-200">ただし、リージョン全体のサービスが中断する可能性に対しても準備する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-200">However, you must also prepare for the possibility that there is a service disruption of the entire region.</span></span> <span data-ttu-id="8c613-201">リージョン全体のサービス中断が発生した場合、データのローカルな冗長コピーは使用できません。</span><span class="sxs-lookup"><span data-stu-id="8c613-201">If a region-wide service disruption occurs, the locally redundant copies of your data are not available.</span></span> <span data-ttu-id="8c613-202">geo レプリケーションを有効にしてある場合は、BLOB とテーブルのコピーがさらに 3 つ、別のリージョン内に存在します。</span><span class="sxs-lookup"><span data-stu-id="8c613-202">If you have enabled geo-replication, there are three additional copies of your blobs and tables in a different region.</span></span> <span data-ttu-id="8c613-203">Microsoft によってリージョンの喪失が宣言された場合、Azure は geo レプリケートされたリージョンにすべての DNS エントリを再マッピングします。</span><span class="sxs-lookup"><span data-stu-id="8c613-203">If Microsoft declares the region lost, Azure remaps all of the DNS entries to the geo-replicated region.</span></span>

> [!NOTE]
> <span data-ttu-id="8c613-204">ユーザーはこのプロセスを制御できないこと、およびリージョン全体のサービス中断の場合にのみ行われることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-204">Be aware that you don't have any control over this process, and it will occur only for region-wide service disruption.</span></span> <span data-ttu-id="8c613-205">そのため、最高レベルの可用性を実現するには、アプリケーション固有の他のバックアップ戦略も利用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-205">Because of this, you must rely on other application-specific backup strategies to achieve the highest level of availability.</span></span> <span data-ttu-id="8c613-206">詳細については、「 [障害復旧のためのデータ戦略](#data-strategies-for-disaster-recovery)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-206">For more information, see the section on [data strategies for disaster recovery](#data-strategies-for-disaster-recovery).</span></span>
> 
> 

### <a name="azure-wide-service-disruption"></a><span data-ttu-id="8c613-207">Azure 全体にわたるサービスの中断</span><span class="sxs-lookup"><span data-stu-id="8c613-207">Azure-wide service disruption</span></span>
<span data-ttu-id="8c613-208">障害計画では、可能性のある障害の全範囲を考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-208">In disaster planning, you must consider the entire range of possible disasters.</span></span> <span data-ttu-id="8c613-209">最も重大なサービス中断の 1 つは、すべての Azure リージョンに同時に関係するものです。</span><span class="sxs-lookup"><span data-stu-id="8c613-209">One of the most severe service disruptions would involve all Azure regions simultaneously.</span></span> <span data-ttu-id="8c613-210">他のサービス中断と同様に、そのような場合は一時的なダウンタイムのリスクを受け入れる決断もあり得ます。</span><span class="sxs-lookup"><span data-stu-id="8c613-210">As with other service disruptions, you might decide to accept the risk of temporary downtime in that event.</span></span> <span data-ttu-id="8c613-211">複数のリージョンにまたがる広範囲のサービス中断が発生する可能性は、依存サービスや単一のリージョンが関係する部分的なサービス中断よりはるかに低いものです。</span><span class="sxs-lookup"><span data-stu-id="8c613-211">Widespread service disruptions that span regions are much rarer than isolated service disruptions involving dependent services or single regions.</span></span>

<span data-ttu-id="8c613-212">ただし、一部のミッション クリティカルなアプリケーションには複数リージョンのサービス中断に対応するバックアップ計画が必要であると判断できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-212">However, you may decide that certain mission-critical applications require a backup plan for a multi-region service disruption.</span></span> <span data-ttu-id="8c613-213">このような計画には、[代替クラウド](#alternative-cloud)または、[オンプレミスとクラウドのハイブリッド ソリューション](#hybrid-on-premises-and-cloud-solution)のサービスへのフェールオーバーが含まれます。</span><span class="sxs-lookup"><span data-stu-id="8c613-213">This plan might include failing over to services in an [alternative cloud](#alternative-cloud) or a [hybrid on-premises and cloud solution](#hybrid-on-premises-and-cloud-solution).</span></span>

### <a name="reduced-application-functionality"></a><span data-ttu-id="8c613-214">アプリケーションの機能制限</span><span class="sxs-lookup"><span data-stu-id="8c613-214">Reduced application functionality</span></span>
<span data-ttu-id="8c613-215">適切に設計されたアプリケーションは通常、疎結合された情報交換パターンの実装を介して相互に通信するサービスを使用します。</span><span class="sxs-lookup"><span data-stu-id="8c613-215">A well-designed application typically uses services that communicate with each other though the implementation of loosely coupled information-interchange patterns.</span></span> <span data-ttu-id="8c613-216">DR に適したアプリケーションには、サービス レベルでの役割の分離が必要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-216">A DR-friendly application requires separation of responsibilities at the service level.</span></span> <span data-ttu-id="8c613-217">これにより、依存サービスの中断によってアプリケーション全体がダウンするのを防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="8c613-217">This prevents the disruption of a dependent service from bringing down the entire application.</span></span> <span data-ttu-id="8c613-218">たとえば、会社 Y の Web コマース アプリケーションについて考えます。たとえば次のようなモジュールがアプリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="8c613-218">For example, consider a web commerce application for Company Y. The following modules might constitute the application:</span></span>

* <span data-ttu-id="8c613-219">**製品カタログ** : ユーザーが製品を参照できるようにします。</span><span class="sxs-lookup"><span data-stu-id="8c613-219">**Product Catalog** allows users to browse products.</span></span>
* <span data-ttu-id="8c613-220">**ショッピング カート** : ユーザーはショッピング カートの製品を追加/削除できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-220">**Shopping Cart** allows users to add/remove products in their shopping cart.</span></span>
* <span data-ttu-id="8c613-221">**注文状態** : ユーザーの注文の出荷状態を示します。</span><span class="sxs-lookup"><span data-stu-id="8c613-221">**Order Status** shows the shipping status of user orders.</span></span>
* <span data-ttu-id="8c613-222">**注文送信** : 支払いを含む注文を送信して、ショッピング セッションを終了します。</span><span class="sxs-lookup"><span data-stu-id="8c613-222">**Order Submission** finalizes the shopping session by submitting the order with payment.</span></span>
* <span data-ttu-id="8c613-223">**注文処理** : 注文のデータ整合性を確認し、在庫チェックを実行します。</span><span class="sxs-lookup"><span data-stu-id="8c613-223">**Order Processing** validates the order for data integrity and performs a quantity availability check.</span></span>

<span data-ttu-id="8c613-224">このアプリケーションにおけるサービスの依存関係が利用不可になった場合、依存関係が回復するまで、サービスはどのように機能するのでしょうか? </span><span class="sxs-lookup"><span data-stu-id="8c613-224">When a service dependency in this application becomes unavailable, how does the service function until the dependency recovers?</span></span> <span data-ttu-id="8c613-225">適切に設計されたシステムでは、設計時および実行時の両方で役割の分離によって分離境界が実装されます。</span><span class="sxs-lookup"><span data-stu-id="8c613-225">A well-designed system implements isolation boundaries through separation of responsibilities, both at design time and at runtime.</span></span> <span data-ttu-id="8c613-226">すべての障害は、回復可能または回復不可能として分類できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-226">You can categorize every failure as recoverable and non-recoverable.</span></span> <span data-ttu-id="8c613-227">回復不可能なエラーはサービスをダウンさせますが、回復可能なエラーは代替手段によって軽減できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-227">Non-recoverable errors will bring down the service, but you can mitigate a recoverable error through alternatives.</span></span> <span data-ttu-id="8c613-228">自動的なエラー処理と代替アクションによって対処される一部の問題は、ユーザーに対して透過的です。</span><span class="sxs-lookup"><span data-stu-id="8c613-228">Certain problems addressed by automatically handling faults and taking alternate actions are transparent to the user.</span></span> <span data-ttu-id="8c613-229">さらに重大なサービスの中断中は、アプリケーションが完全に利用できなくなることがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-229">During a more serious service disruption, the application might be completely unavailable.</span></span> <span data-ttu-id="8c613-230">3 番目のオプションは、機能を制限してユーザー要求の処理を続行するというものです。</span><span class="sxs-lookup"><span data-stu-id="8c613-230">A third option is to continue handling user requests with reduced functionality.</span></span>

<span data-ttu-id="8c613-231">たとえば、注文をホストするためのデータベースで障害が発生した場合、注文処理サービスは販売トランザクションを処理できなくなります。</span><span class="sxs-lookup"><span data-stu-id="8c613-231">For instance, if the database for hosting orders goes down, the Order Processing service loses its ability to process sales transactions.</span></span> <span data-ttu-id="8c613-232">アーキテクチャによっては、アプリケーションの注文送信と注文処理サービスの続行が困難または不可能になることがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-232">Depending on the architecture, it might be difficult or impossible for the Order Submission and Order Processing services of the application to continue.</span></span> <span data-ttu-id="8c613-233">このようなシナリオに対応するようにアプリケーションが設計されていない場合、アプリケーション全体がオフラインになる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-233">If the application is not designed to handle this scenario, the entire application might go offline.</span></span> <span data-ttu-id="8c613-234">ただし、製品のデータが別の場所に格納されている場合は、製品カタログ モジュールを使用して製品を表示できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-234">However, if the product data is stored in a different location, then the Product Catalog module can still be used for viewing products.</span></span> <span data-ttu-id="8c613-235">ただし、注文や在庫照会などのアプリケーションの他の部分は利用できません。</span><span class="sxs-lookup"><span data-stu-id="8c613-235">However, other parts of the application are unavailable, such as ordering or inventory queries.</span></span>

<span data-ttu-id="8c613-236">適用するアプリケーションの機能制限の内容については、ビジネス面と技術面の両方を考慮して決定します。</span><span class="sxs-lookup"><span data-stu-id="8c613-236">Deciding what reduced application functionality is available is both a business decision and a technical decision.</span></span> <span data-ttu-id="8c613-237">アプリケーションが一時的な問題をユーザーに通知する方法も決定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-237">You must decide how the application will inform the users of any temporary problems.</span></span> <span data-ttu-id="8c613-238">上記の例では、製品を表示し、ショッピング カートに製品を追加することができます。</span><span class="sxs-lookup"><span data-stu-id="8c613-238">In the example above, the application might allow viewing products and adding them to a shopping cart.</span></span> <span data-ttu-id="8c613-239">ただし、ユーザーが購入しようとすると、アプリケーションはユーザーに注文機能が一時的に利用不可であることを通知します。</span><span class="sxs-lookup"><span data-stu-id="8c613-239">However, when the user attempts to make a purchase, the application notifies the user that the ordering functionality is temporarily unavailable.</span></span> <span data-ttu-id="8c613-240">顧客にとって最善ではありませんが、アプリケーション全体のサービス中断は避けられます。</span><span class="sxs-lookup"><span data-stu-id="8c613-240">This isn't ideal for the customer, but it does prevent an application-wide service disruption.</span></span>

## <a name="data-strategies-for-disaster-recovery"></a><span data-ttu-id="8c613-241">障害復旧のためのデータ戦略</span><span class="sxs-lookup"><span data-stu-id="8c613-241">Data strategies for disaster recovery</span></span>
<span data-ttu-id="8c613-242">適切なデータ処理は、ディザスター リカバリー計画における難しい課題です。</span><span class="sxs-lookup"><span data-stu-id="8c613-242">Proper data handling is a challenging aspect of a disaster recovery plan.</span></span> <span data-ttu-id="8c613-243">通常、回復プロセス中はデータの復元に最も時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="8c613-243">During the recovery process, data restoration typically takes the most time.</span></span> <span data-ttu-id="8c613-244">機能を制限するうえでのさまざまな選択は、障害からのデータ復旧および障害後の整合性に対する困難な課題になります。</span><span class="sxs-lookup"><span data-stu-id="8c613-244">Different choices for reducing functionality result in difficult challenges for data recovery from failure and consistency after failure.</span></span>

<span data-ttu-id="8c613-245">考慮事項の 1 つは、アプリケーションのデータのコピーの復元または保持の必要性です。</span><span class="sxs-lookup"><span data-stu-id="8c613-245">One consideration is the need to restore or maintain a copy of the application’s data.</span></span> <span data-ttu-id="8c613-246">このデータは、セカンダリ サイトでの参照とトランザクションの目的に使用されます。</span><span class="sxs-lookup"><span data-stu-id="8c613-246">You will use this data for reference and transactional purposes at a secondary site.</span></span> <span data-ttu-id="8c613-247">オンプレミスのデプロイでは、複数リージョンのディザスター リカバリー戦略を実装するためにコストと時間のかかる計画プロセスが必要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-247">An on-premises deployment requires an expensive and lengthy planning process to implement a multiple-region disaster recovery strategy.</span></span> <span data-ttu-id="8c613-248">さいわい、Azure を含むほとんどのクラウド プロバイダーでは、複数のリージョンにアプリケーションを簡単にデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-248">Conveniently, most cloud providers, including Azure, readily allow the deployment of applications to multiple regions.</span></span> <span data-ttu-id="8c613-249">これらのリージョンは、複数リージョンのサービス中断が非常にまれになるように地理的に分散されています。</span><span class="sxs-lookup"><span data-stu-id="8c613-249">These regions are geographically distributed in such a way that multiple-region service disruption should be extremely rare.</span></span> <span data-ttu-id="8c613-250">異なるリージョン間でデータを処理するための戦略は、ディザスター リカバリー計画を成功に導く要素の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="8c613-250">The strategy for handling data across regions is one of the contributing factors for the success of any disaster recovery plan.</span></span>

<span data-ttu-id="8c613-251">以下のセクションでは、データのバックアップ、参照データ、およびトランザクション データに関連するディザスター リカバリー テクニックについて説明します。</span><span class="sxs-lookup"><span data-stu-id="8c613-251">The following sections discuss disaster recovery techniques related to data backups, reference data, and transactional data.</span></span>

### <a name="backup-and-restore"></a><span data-ttu-id="8c613-252">バックアップと復元</span><span class="sxs-lookup"><span data-stu-id="8c613-252">Backup and restore</span></span>
<span data-ttu-id="8c613-253">アプリケーション データの定期的なバックアップにより、一部のディザスター リカバリー シナリオに対応できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-253">Regular backups of application data can support some disaster recovery scenarios.</span></span> <span data-ttu-id="8c613-254">ストレージ リソースが異なると、必要な手法も異なります。</span><span class="sxs-lookup"><span data-stu-id="8c613-254">Different storage resources require different techniques.</span></span>

#### <a name="sql-database"></a><span data-ttu-id="8c613-255">SQL Database</span><span class="sxs-lookup"><span data-stu-id="8c613-255">SQL Database</span></span>
<span data-ttu-id="8c613-256">Basic、Standard、および Premium の SQL Database 階層の場合、データベースの復旧にポイントインタイム リストアを利用できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-256">For the Basic, Standard, and Premium SQL Database tiers, you can take advantage of point-in-time restore to recover your database.</span></span> <span data-ttu-id="8c613-257">詳細については、「[概要: SQL Database を使用したクラウド ビジネス継続性とデータベース ディザスター リカバリー](/azure/sql-database/sql-database-business-continuity/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-257">For more information, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span> <span data-ttu-id="8c613-258">もう 1 つのオプションは、SQL Database にアクティブ geo レプリケーションを使うことです。</span><span class="sxs-lookup"><span data-stu-id="8c613-258">Another option is to use Active Geo-Replication for SQL Database.</span></span> <span data-ttu-id="8c613-259">この機能は、データベースの変更を、同じ Azure リージョンまたは別の Azure リージョンのセカンダリ データベースに、自動的にレプリケートします。</span><span class="sxs-lookup"><span data-stu-id="8c613-259">This automatically replicates database changes to secondary databases in the same Azure region or even in a different Azure region.</span></span> <span data-ttu-id="8c613-260">これは、この記事で説明されている、より手動的なデータ同期技法の一部に対する代替手段になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-260">This provides a potential alternative to some of the more manual data synchronization techniques presented in this article.</span></span> <span data-ttu-id="8c613-261">詳細については、「 [概要: Azure SQL Database のアクティブ geo レプリケーション](/azure/sql-database/sql-database-geo-replication-overview/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-261">For more information, see [Overview: SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/).</span></span>

<span data-ttu-id="8c613-262">もっと手動的なバックアップおよび復元の方法を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-262">You can also use a more manual approach for backup and restore.</span></span> <span data-ttu-id="8c613-263">DATABASE COPY コマンドを使用して、トランザクションの一貫性を保つ、データベースのバックアップ コピーを作成できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-263">Use the DATABASE COPY command to create a backup copy of the database with transactional consistency.</span></span> <span data-ttu-id="8c613-264">Azure SQL Database のインポート/エクスポート サービスを使用することもできます。このサービスでは、Azure Blob Storage に格納されている BACPAC ファイル (ご利用のデータベース スキーマおよび関連するデータを含む圧縮されたファイル) へのデータベースのエクスポートをサポートします。</span><span class="sxs-lookup"><span data-stu-id="8c613-264">You can also use the import/export service of Azure SQL Database, which supports exporting databases to BACPAC files (compressed files containing your database schema and associated data) that are stored in Azure Blob storage.</span></span>

<span data-ttu-id="8c613-265">Azure Storage に組み込まれている冗長性により、バックアップ ファイルの 2 個のレプリカが同じリージョンに作成されます。</span><span class="sxs-lookup"><span data-stu-id="8c613-265">The built-in redundancy of Azure Storage creates two replicas of the backup file in the same region.</span></span> <span data-ttu-id="8c613-266">ただし、バックアップ プロセスを実行する頻度により、障害シナリオで失われる可能性があるデータ量を表す RPO が決まります。</span><span class="sxs-lookup"><span data-stu-id="8c613-266">However, the frequency of running the backup process determines your RPO, which is the amount of data you might lose in disaster scenarios.</span></span> <span data-ttu-id="8c613-267">たとえば、毎正時にバックアップを実行していて、正時の 2 分前に障害が発生したとすると、</span><span class="sxs-lookup"><span data-stu-id="8c613-267">For example, imagine that you perform a backup at the top of each hour, and a disaster occurs two minutes before the top of the hour.</span></span> <span data-ttu-id="8c613-268">最後のバックアップが実行されてからの 58 分間に記録されたデータは失われます。</span><span class="sxs-lookup"><span data-stu-id="8c613-268">You lose 58 minutes of data recorded after the last backup was performed.</span></span> <span data-ttu-id="8c613-269">また、リージョン全体のサービス中断を防ぐには、BACPAC ファイルを代替リージョンにコピーする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-269">Also, to protect against a region-wide service disruption, you should copy the BACPAC files to an alternate region.</span></span> <span data-ttu-id="8c613-270">その場合、代替リージョンのバックアップを復元することができます。</span><span class="sxs-lookup"><span data-stu-id="8c613-270">You then have the option of restoring those backups in the alternate region.</span></span> <span data-ttu-id="8c613-271">詳細については、「[概要: SQL Database を使用したクラウド ビジネス継続性とデータベース ディザスター リカバリー](/azure/sql-database/sql-database-business-continuity/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="8c613-271">For more details, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span>

#### <a name="azure-storage"></a><span data-ttu-id="8c613-272">Azure Storage (Azure Storage)</span><span class="sxs-lookup"><span data-stu-id="8c613-272">Azure Storage</span></span>
<span data-ttu-id="8c613-273">Azure Storage の場合、カスタム バックアップ プロセスを開発したり、多くのサード パーティ製バックアップ ツールのいずれかを使用したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="8c613-273">For Azure Storage, you can develop a custom backup process or use one of many third-party backup tools.</span></span> <span data-ttu-id="8c613-274">ストレージ リソース間に相互参照があるほとんどのアプリケーション設計では、複雑さが増すことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-274">Note that most application designs have additional complexities where storage resources reference each other.</span></span> <span data-ttu-id="8c613-275">たとえば、Azure Storage の BLOB にリンクしている列を含む SQL データベースがあるものとします。</span><span class="sxs-lookup"><span data-stu-id="8c613-275">For example, consider a SQL database that has a column that links to a blob in Azure Storage.</span></span> <span data-ttu-id="8c613-276">バックアップが同時に実行されない場合、データベースには、障害発生前にバックアップされなかった BLOB へのポインターが含まれる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-276">If the backups do not happen simultaneously, the database might have a pointer to a blob that was not backed up before the failure.</span></span> <span data-ttu-id="8c613-277">アプリケーションまたはディザスター リカバリー計画では、復旧後のこのような不整合を処理するプロセスを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-277">The application or disaster recovery plan must implement processes to handle this inconsistency after a recovery.</span></span>

#### <a name="other-data-platforms"></a><span data-ttu-id="8c613-278">他のデータ プラットフォーム</span><span class="sxs-lookup"><span data-stu-id="8c613-278">Other data platforms</span></span>
<span data-ttu-id="8c613-279">Elasticsearch や MongoDB など、サービスとしてのインフラストラクチャ (IaaS) でホストされる他のプラットフォームでバックアップと復元の統合プロセスを作成する場合は、独自の機能および考慮事項が存在します。</span><span class="sxs-lookup"><span data-stu-id="8c613-279">Other infrastructure-as-a-service (IaaS) hosted data platforms, such as Elasticsearch or MongoDB, have their own capabilities and considerations when creating an integrated backup and restore process.</span></span> <span data-ttu-id="8c613-280">これらのデータ プラットフォームに対して、一般的には、ネイティブの、または利用可能な統合ベースのレプリケーションまたはスナップショット機能を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8c613-280">For these data platforms, the general recommendation is to use any native or available integration-based replication or snapshotting capabilities.</span></span> <span data-ttu-id="8c613-281">それらの機能が存在しないか、または適切でない場合は、Azure Backup サービスまたはマネージ/アンマネージ ディスク スナップショットを使用して、アプリケーション データの特定時点のコピーを作成することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-281">If those capabilities do not exist or are not suitable, then consider using Azure Backup Service or managed/unmanaged disk snapshots to create a point-in-time copy of application data.</span></span> <span data-ttu-id="8c613-282">すべてのケースにおいて、一貫性のあるバックアップを実現する方法を決定することが重要です。特に、そのことは、アプリケーション データが複数のファイル システムにまたがる場合や、ボリューム マネージャーやソフトウェア ベースの RAID を使用して 1 つのファイル システムに複数のドライブを結合する場合に重要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-282">In all cases, it’s important to determine how to achieve consistent backups, especially when application data spans multiple files systems, or when multiple drives are combined into a single file system using volume managers or software-based RAID.</span></span>

### <a name="reference-data-pattern-for-disaster-recovery"></a><span data-ttu-id="8c613-283">障害復旧のための参照データ パターン</span><span class="sxs-lookup"><span data-stu-id="8c613-283">Reference data pattern for disaster recovery</span></span>
<span data-ttu-id="8c613-284">参照データはアプリケーションの機能をサポートする読み取り専用のデータです。</span><span class="sxs-lookup"><span data-stu-id="8c613-284">Reference data is read-only data that supports application functionality.</span></span> <span data-ttu-id="8c613-285">通常、頻繁に変更されることはありません。</span><span class="sxs-lookup"><span data-stu-id="8c613-285">It typically does not change frequently.</span></span> <span data-ttu-id="8c613-286">バックアップと復元はリージョン全体にわたるサービス中断を処理する 1 つの方法ですが、RTO は比較的長くなります。</span><span class="sxs-lookup"><span data-stu-id="8c613-286">Although backup and restore is one method to handle region-wide service disruptions, the RTO is relatively long.</span></span> <span data-ttu-id="8c613-287">セカンダリ リージョンにアプリケーションをデプロイする場合、参照データの RTO を改善する方法がいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-287">When you deploy the application to a secondary region, some strategies can improve the RTO for reference data.</span></span>

<span data-ttu-id="8c613-288">参照データは頻繁に変化しないので、参照データの永続的なコピーをセカンダリ リージョンに保持することで、RTO を改善できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-288">Because reference data changes infrequently, you can improve the RTO by maintaining a permanent copy of the reference data in the secondary region.</span></span> <span data-ttu-id="8c613-289">これにより、障害発生時にバックアップを復元するために必要な時間がなくなります。</span><span class="sxs-lookup"><span data-stu-id="8c613-289">This eliminates the time required to restore backups in the event of a disaster.</span></span> <span data-ttu-id="8c613-290">複数リージョンのディザスター リカバリーの要件を満たすには、アプリケーションと参照データを一緒に複数のリージョンにデプロイする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-290">To meet the multiple-region disaster recovery requirements, you must deploy the application and the reference data together in multiple regions.</span></span> <span data-ttu-id="8c613-291">「 [高可用性の参照データ パターン](high-availability-azure-applications.md#reference-data-pattern-for-high-availability)」で説明されているように、ロール自体、外部ストレージ、または両方の組み合わせに、参照データをデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-291">As mentioned in [Reference data pattern for high availability](high-availability-azure-applications.md#reference-data-pattern-for-high-availability), you can deploy reference data to the role itself, to external storage, or to a combination of both.</span></span>

<span data-ttu-id="8c613-292">コンピューティング ノード内の参照データ デプロイ モデルは、ディザスター リカバリーの要件を暗黙的に満たします。</span><span class="sxs-lookup"><span data-stu-id="8c613-292">The reference data deployment model within compute nodes implicitly satisfies the disaster recovery requirements.</span></span> <span data-ttu-id="8c613-293">SQL Database への参照データのデプロイでは、各リージョンに参照データのコピーをデプロイする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-293">Reference data deployment to SQL Database requires that you deploy a copy of the reference data to each region.</span></span> <span data-ttu-id="8c613-294">Azure Storage にも同じ方法が当てはまります。</span><span class="sxs-lookup"><span data-stu-id="8c613-294">The same strategy applies to Azure Storage.</span></span> <span data-ttu-id="8c613-295">Azure Storage に格納されている参照データのコピーを、プライマリ リージョンとセカンダリ リージョンにデプロイする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-295">You must deploy a copy of any reference data that's stored in Azure Storage to the primary and secondary regions.</span></span>

![プライマリ リージョンとセカンダリ リージョン両方への参照データの発行](./images/disaster-recovery-azure-applications/reference-data-publication-to-both-primary-and-secondary-regions.png)

<span data-ttu-id="8c613-297">参照データを含むすべてのデータに対して、アプリケーション固有のバックアップ ルーチンを独自に実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-297">You must implement your own application-specific backup routines for all data, including reference data.</span></span> <span data-ttu-id="8c613-298">リージョン間で geo レプリケートされたコピーは、リージョン全体のサービス中断においてのみ使用されます。</span><span class="sxs-lookup"><span data-stu-id="8c613-298">Geo-replicated copies across regions are used only in a region-wide service disruption.</span></span> <span data-ttu-id="8c613-299">長時間のダウンタイムを回避するには、アプリケーションのデータのミッション クリティカルな部分をセカンダリ リージョンにデプロイします。</span><span class="sxs-lookup"><span data-stu-id="8c613-299">To prevent extended downtime, deploy the mission-critical parts of the application’s data to the secondary region.</span></span> <span data-ttu-id="8c613-300">このトポロジの例については、 [アクティブ/パッシブ モデル](#active-passive)に関するセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-300">For an example of this topology, see the [active-passive model](#active-passive).</span></span>

### <a name="transactional-data-pattern-for-disaster-recovery"></a><span data-ttu-id="8c613-301">障害復旧のためのトランザクション データ パターン</span><span class="sxs-lookup"><span data-stu-id="8c613-301">Transactional data pattern for disaster recovery</span></span>
<span data-ttu-id="8c613-302">完全に機能する障害モード戦略の実装では、セカンダリ リージョンにトランザクション データを非同期にレプリケートする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-302">Implementation of a fully functional disaster mode strategy requires asynchronous replication of the transactional data to the secondary region.</span></span> <span data-ttu-id="8c613-303">レプリケーションを実行できる実際の時間枠により、アプリケーションの RPO 特性が決まります。</span><span class="sxs-lookup"><span data-stu-id="8c613-303">The practical time windows within which the replication can occur will determine the RPO characteristics of the application.</span></span> <span data-ttu-id="8c613-304">それでも、レプリケーションの時間枠の間にプライマリ リージョンから失われたデータを回復する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-304">You might still recover the data that was lost from the primary region during the replication window.</span></span> <span data-ttu-id="8c613-305">また、後でセカンダリ リージョンとマージできる場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-305">You might also be able to merge with the secondary region later.</span></span>

<span data-ttu-id="8c613-306">次のアーキテクチャの例では、フェールオーバー シナリオでのトランザクション データのさまざまな処理方法についてのアイデアを示します。</span><span class="sxs-lookup"><span data-stu-id="8c613-306">The following architecture examples provide some ideas on different ways of handling transactional data in a failover scenario.</span></span> <span data-ttu-id="8c613-307">すべての例を網羅しているわけではないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-307">It's important to note that these examples are not exhaustive.</span></span> <span data-ttu-id="8c613-308">たとえば、キューなどの中間ストレージの場所は、Azure SQL Database に置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="8c613-308">For example, intermediate storage locations such as queues might be replaced with Azure SQL Database.</span></span> <span data-ttu-id="8c613-309">キュー自体には、Azure Storage キューまたは Azure Service Bus キューを使用できます (「[Azure キューと Service Bus キューの比較](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/)」をご覧ください)。</span><span class="sxs-lookup"><span data-stu-id="8c613-309">The queues themselves might be either Azure Storage or Azure Service Bus queues (see [Azure queues and Service Bus queues - compared and contrasted](/azure/service-bus-messaging/service-bus-azure-and-service-bus-queues-compared-contrasted/)).</span></span> <span data-ttu-id="8c613-310">サーバー ストレージ先も変更できます (SQL Database の代わりに Azure テーブルなど)。</span><span class="sxs-lookup"><span data-stu-id="8c613-310">Server storage destinations might also vary, such as Azure tables instead of SQL Database.</span></span> <span data-ttu-id="8c613-311">さらに、さまざまな手順の途中に worker ロールが挿入される場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-311">In addition, worker roles might be inserted as intermediaries in various steps.</span></span> <span data-ttu-id="8c613-312">目的とするのは、これらのアーキテクチャを正確に模倣することではなく、トランザクション データおよび関連モジュールの復旧でさまざまな代替方法を検討することです。</span><span class="sxs-lookup"><span data-stu-id="8c613-312">The intent is not to emulate these architectures exactly, but to consider various alternatives in the recovery of transactional data and related modules.</span></span>

#### <a name="replication-of-transactional-data-in-preparation-for-disaster-recovery"></a><span data-ttu-id="8c613-313">障害復旧の準備でのトランザクション データのレプリケーション</span><span class="sxs-lookup"><span data-stu-id="8c613-313">Replication of transactional data in preparation for disaster recovery</span></span>
<span data-ttu-id="8c613-314">Azure Storage キューを使用してトランザクション データを保持するアプリケーションを検討してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-314">Consider an application that uses Azure Storage queues to hold transactional data.</span></span> <span data-ttu-id="8c613-315">これにより、worker ロールは別のアーキテクチャでサーバー データベースへのトランザクション データを処理できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-315">This allows worker roles to process the transactional data to the server database in a decoupled architecture.</span></span> <span data-ttu-id="8c613-316">フロントエンド ロールでデータのクエリをすぐに実行する必要がある場合は、トランザクションで何らかの一時的キャッシュを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-316">This requires the transactions to use some form of temporary caching if the front-end roles require the immediate query of that data.</span></span> <span data-ttu-id="8c613-317">データ損失の許容レベルに応じて、キュー、データベース、またはすべてのストレージ リソースをレプリケートできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-317">Depending on the level of data-loss tolerance, you might choose to replicate the queues, the database, or all of the storage resources.</span></span> <span data-ttu-id="8c613-318">データベース レプリケーションのみでも、プライマリ リージョンがダウンした場合、プライマリ リージョンが復旧した後でキューのデータを回復できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-318">With only database replication, if the primary region goes down, you can still recover the data in the queues when the primary region comes back.</span></span>

<span data-ttu-id="8c613-319">次の図では、リージョン間でサーバー データベースが同期されるアーキテクチャを示します。</span><span class="sxs-lookup"><span data-stu-id="8c613-319">The following diagram shows an architecture where the server database is synchronized across regions.</span></span>

![障害復旧の準備でのトランザクション データのレプリケーション](./images/disaster-recovery-azure-applications/replicate-transactional-data-in-preparation-for-disaster-recovery.png)

<span data-ttu-id="8c613-321">このアーキテクチャを実装するときの最大の課題は、リージョン間のレプリケーション戦略です。</span><span class="sxs-lookup"><span data-stu-id="8c613-321">The biggest challenge to implementing this architecture is the replication strategy between regions.</span></span> <span data-ttu-id="8c613-322">[Azure SQL データ同期](/azure/sql-database/sql-database-get-started-sql-data-sync/)サービスを使用して、この種のレプリケーションを実行できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-322">The [Azure SQL Data Sync](/azure/sql-database/sql-database-get-started-sql-data-sync/) service enables this type of replication.</span></span> <span data-ttu-id="8c613-323">このドキュメントの作成時点では、このサービスはまだプレビュー段階であり、運用環境には推奨されません。</span><span class="sxs-lookup"><span data-stu-id="8c613-323">As of this writing, the service is in preview and is not yet recommended for production environments.</span></span> <span data-ttu-id="8c613-324">詳細については、「[概要: SQL Database を使用したクラウド ビジネス継続性とデータベース ディザスター リカバリー](/azure/sql-database/sql-database-business-continuity/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-324">For more information, see [Overview: Cloud business continuity and database disaster recovery with SQL Database](/azure/sql-database/sql-database-business-continuity/).</span></span> <span data-ttu-id="8c613-325">運用アプリケーションの場合は、サードパーティ製のソリューションを利用するか、独自のレプリケーション ロジックのコードを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-325">For production applications, you must invest in a third-party solution or create your own replication logic in code.</span></span> <span data-ttu-id="8c613-326">アーキテクチャによっては、レプリケーションが双方向になる可能性があり、複雑さが増します。</span><span class="sxs-lookup"><span data-stu-id="8c613-326">Depending on the architecture, the replication might be bidirectional, which is more complex.</span></span>

<span data-ttu-id="8c613-327">可能性のある実装の 1 つは、前の例で中間キューを使用するものです。</span><span class="sxs-lookup"><span data-stu-id="8c613-327">One potential implementation might make use of the intermediate queue in the previous example.</span></span> <span data-ttu-id="8c613-328">最終的なストレージ先へのデータを処理する worker ロールは、プライマリ リージョンとセカンダリ リージョンの両方で変更を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="8c613-328">The worker role that processes the data to the final storage destination might make the change in both the primary region and the secondary region.</span></span> <span data-ttu-id="8c613-329">これらは簡単なタスクではなく、レプリケーション コードの詳細なガイダンスはこの記事の範囲を超えています。</span><span class="sxs-lookup"><span data-stu-id="8c613-329">These are not trivial tasks, and complete guidance for replication code is beyond the scope of this article.</span></span> <span data-ttu-id="8c613-330">セカンダリ リージョンにデータをレプリケートするためのアプローチには、十分な時間をかけて十分なテストを実施してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-330">Invest significant time and testing into the approach for replicating data to the secondary region.</span></span> <span data-ttu-id="8c613-331">さらに、可能性のあるデータの不整合や重複トランザクションがフェールオーバーおよび回復のプロセスで正しく処理されることを確認するために、追加の作業とテストを実行することもできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-331">Additional processing and testing can help ensure that the failover and recovery processes correctly handle any possible data inconsistencies or duplicate transactions.</span></span>

> [!NOTE]
> <span data-ttu-id="8c613-332">このドキュメントの大部分では、サービスとしてのプラットフォーム (PaaS) について説明します。</span><span class="sxs-lookup"><span data-stu-id="8c613-332">Most of this paper focuses on platform as a service (PaaS).</span></span> <span data-ttu-id="8c613-333">ただし、ハイブリッド アプリケーションのための追加のレプリケーション オプションおよび可用性オプションでは、Azure Virtual Machines を使用します。</span><span class="sxs-lookup"><span data-stu-id="8c613-333">However, additional replication and availability options for hybrid applications use Azure Virtual Machines.</span></span> <span data-ttu-id="8c613-334">これらのハイブリッド アプリケーションは、サービスとしてのインフラストラクチャ (IaaS) を使用して、Azure の仮想マシンで SQL Server をホストします。</span><span class="sxs-lookup"><span data-stu-id="8c613-334">These hybrid applications use infrastructure as a service (IaaS) to host SQL Server on virtual machines in Azure.</span></span> <span data-ttu-id="8c613-335">これにより、AlwaysOn 可用性グループやログ配布などの SQL Server の従来の可用性アプローチを使用できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-335">This allows traditional availability approaches in SQL Server, such as AlwaysOn Availability Groups or Log Shipping.</span></span> <span data-ttu-id="8c613-336">AlwaysOn などの一部のテクニックは、オンプレミスの SQL Server インスタンスと Azure Virtual Machines の間でのみ機能します。</span><span class="sxs-lookup"><span data-stu-id="8c613-336">Some techniques, such as AlwaysOn, work only between on-premises SQL Server instances and Azure virtual machines.</span></span> <span data-ttu-id="8c613-337">詳細については、「[Azure 仮想マシンにおける SQL Server の高可用性とディザスター リカバリー](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-337">For more information, see [High availability and disaster recovery for SQL Server in Azure Virtual Machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>
> 
> 

#### <a name="reduced-application-functionality-for-transaction-capture"></a><span data-ttu-id="8c613-338">トランザクション キャプチャに対するアプリケーション機能の制限</span><span class="sxs-lookup"><span data-stu-id="8c613-338">Reduced application functionality for transaction capture</span></span>
<span data-ttu-id="8c613-339">機能を制限して動作する第 2 のアーキテクチャを検討してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-339">Consider a second architecture that operates with reduced functionality.</span></span> <span data-ttu-id="8c613-340">セカンダリ リージョンのアプリケーションは、レポート、ビジネス インテリジェンス (BI)、キューのドレインなどのすべての機能を無効にします。</span><span class="sxs-lookup"><span data-stu-id="8c613-340">The application in the secondary region deactivates all the functionality, such as reporting, business intelligence (BI), or draining queues.</span></span> <span data-ttu-id="8c613-341">ビジネス要件によって定義されている、最も重要な種類のトランザクション ワークフローのみを受け付けます。</span><span class="sxs-lookup"><span data-stu-id="8c613-341">It accepts only the most important types of transactional workflows, as defined by business requirements.</span></span> <span data-ttu-id="8c613-342">システムはトランザクションをキャプチャし、キューに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="8c613-342">The system captures the transactions and writes them to queues.</span></span> <span data-ttu-id="8c613-343">システムは、サービス中断の初期段階でデータの処理を遅延できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-343">The system might postpone processing the data during the initial stage of the service disruption.</span></span> <span data-ttu-id="8c613-344">プライマリ リージョンのシステムが予想される時間枠内に再アクティブ化した場合、プライマリ リージョンの worker ロールはキューをドレインできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-344">If the system on the primary region is reactivated within the expected time window, the worker roles in the primary region can drain the queues.</span></span> <span data-ttu-id="8c613-345">このプロセスにより、データベースをマージする必要がなくなります。</span><span class="sxs-lookup"><span data-stu-id="8c613-345">This process eliminates the need for database merging.</span></span> <span data-ttu-id="8c613-346">プライマリ リージョンのサービス中断が許容時間枠を超えた場合、アプリケーションはキューの処理を開始できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-346">If the primary region service disruption goes beyond the tolerable window, the application can start processing the queues.</span></span>

<span data-ttu-id="8c613-347">このシナリオでは、セカンダリ リージョンのデータベースには、プライマリが再アクティブ化したらマージする必要がある増分トランザクション データが含まれます。</span><span class="sxs-lookup"><span data-stu-id="8c613-347">In this scenario, the database in the secondary region contains incremental transactional data that must be merged after the primary is reactivated.</span></span> <span data-ttu-id="8c613-348">次の図では、プライマリ リージョンが復元されるまで一時的にトランザクション データを格納するためのこの方法を示します。</span><span class="sxs-lookup"><span data-stu-id="8c613-348">The following diagram shows this strategy for temporarily storing transactional data until the primary region is restored.</span></span>

![トランザクション キャプチャに対するアプリケーション機能の制限](./images/disaster-recovery-azure-applications/reduced-application-functionality-for-transaction-capture.png)

<span data-ttu-id="8c613-350">回復力のある Azure アプリケーションのデータ管理手法の詳細については、「 [Failsafe: Guidance for Resilient Cloud Architectures (フェールセーフ: 回復力のあるクラウド アーキテクチャに関するガイダンス)](https://channel9.msdn.com/Series/FailSafe)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-350">For more discussion of data management techniques for resilient Azure applications, see [Failsafe: Guidance for Resilient Cloud Architectures](https://channel9.msdn.com/Series/FailSafe).</span></span>

## <a name="deployment-topologies-for-disaster-recovery"></a><span data-ttu-id="8c613-351">障害復旧のデプロイ トポロジ</span><span class="sxs-lookup"><span data-stu-id="8c613-351">Deployment topologies for disaster recovery</span></span>
<span data-ttu-id="8c613-352">リージョン全体のサービス中断に対処するにはミッション クリティカルなアプリケーションを準備する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-352">You must prepare mission-critical applications to handle region-wide service disruptions.</span></span> <span data-ttu-id="8c613-353">複数リージョン デプロイ戦略を運用計画に組み込みます。</span><span class="sxs-lookup"><span data-stu-id="8c613-353">Incorporate a multiple-region deployment strategy into the operational planning.</span></span>

<span data-ttu-id="8c613-354">複数リージョン デプロイには、障害発生後にセカンダリ リージョンにアプリケーションと参照データを発行する IT プロセスが含まれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-354">Multiple-region deployments might involve IT processes to publish the application and reference data to the secondary region after a disaster.</span></span> <span data-ttu-id="8c613-355">すばやいフェールオーバーを必要とするアプリケーションの場合、デプロイ プロセスにアクティブ/パッシブ セットアップまたはアクティブ/アクティブ セットアップを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="8c613-355">If the application requires instant failover, the deployment process might involve an active/passive setup or an active/active setup.</span></span> <span data-ttu-id="8c613-356">この種のデプロイには、代替リージョンで実行しているアプリケーションの既存のインスタンスがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-356">This type of deployment has existing instances of the application running in the alternate region.</span></span> <span data-ttu-id="8c613-357">Azure Traffic Manager などのルーティング サービスは、DNS レベルで負荷分散サービスを提供します。</span><span class="sxs-lookup"><span data-stu-id="8c613-357">A routing service such as Azure Traffic Manager provides load-balancing services at the DNS level.</span></span> <span data-ttu-id="8c613-358">サービスの中断を検出し、必要に応じてユーザーを異なるリージョンにルーティングできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-358">It can detect service disruptions and route the users to different regions when needed.</span></span>

<span data-ttu-id="8c613-359">Azure のディザスター リカバリーを成功させるためには、そのような復旧を最初からソリューションに組み込みます。</span><span class="sxs-lookup"><span data-stu-id="8c613-359">A successful Azure disaster recovery includes building that recovery into the solution from the start.</span></span> <span data-ttu-id="8c613-360">クラウドには、従来のホスティング プロバイダーでは使用できない、障害から復旧するための追加オプションがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-360">The cloud provides additional options for recovering from failures during a disaster that are not available in a traditional hosting provider.</span></span> <span data-ttu-id="8c613-361">具体的には、異なるリージョンにリソースを動的かつ迅速に割り当てることができます。そのため、障害の発生前には、未使用のリソースに対するコストは発生しません。</span><span class="sxs-lookup"><span data-stu-id="8c613-361">Specifically, you can dynamically and quickly allocate resources in a different region, avoiding the cost of idle resources prior to a failure.</span></span>

<span data-ttu-id="8c613-362">以下のセクションでは、障害復旧のためのさまざまなデプロイ トポロジについて説明します。</span><span class="sxs-lookup"><span data-stu-id="8c613-362">The following sections cover different deployment topologies for disaster recovery.</span></span> <span data-ttu-id="8c613-363">通常、可用性の向上には、コストや複雑さの増加というトレードオフがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-363">Typically, there's a tradeoff in increased cost or complexity for additional availability.</span></span>

### <a name="single-region-deployment"></a><span data-ttu-id="8c613-364">単一リージョンのデプロイ</span><span class="sxs-lookup"><span data-stu-id="8c613-364">Single-region deployment</span></span>
<span data-ttu-id="8c613-365">単一リージョンのデプロイは、実際にはディザスター リカバリー トポロジではありませんが、他のアーキテクチャと比較するために示してあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-365">A single-region deployment is not really a disaster recovery topology, but is meant to contrast with the other architectures.</span></span> <span data-ttu-id="8c613-366">単一リージョンのデプロイは Azure のアプリケーションでは一般的です。ただし、このデプロイはディザスター リカバリー トポロジの要件を満たしていません。</span><span class="sxs-lookup"><span data-stu-id="8c613-366">Single-region deployments are common for applications in Azure; however, they do not meet the requirements of a disaster recovery topology.</span></span>

<span data-ttu-id="8c613-367">次の図は、単一の Azure リージョンで実行するアプリケーションを示しています。</span><span class="sxs-lookup"><span data-stu-id="8c613-367">The following diagram depicts an application running in a single Azure region.</span></span> <span data-ttu-id="8c613-368">Azure Traffic Manager と、障害ドメインおよびアップグレード ドメインの使用により、リージョン内のアプリケーションの可用性が向上します。</span><span class="sxs-lookup"><span data-stu-id="8c613-368">Azure Traffic Manager and the use of fault and upgrade domains increase availability of the application within the region.</span></span>

![単一リージョンのデプロイ](./images/disaster-recovery-azure-applications/single-region-deployment.png)

<span data-ttu-id="8c613-370">このシナリオでは、データベースは単一障害点となります。</span><span class="sxs-lookup"><span data-stu-id="8c613-370">In this scenario, the database is a single point of failure.</span></span> <span data-ttu-id="8c613-371">Azure は異なる障害ドメインのデータを内部レプリカにレプリケートしますが、このレプリケーションは同じリージョン内でのみ実行されます。</span><span class="sxs-lookup"><span data-stu-id="8c613-371">Though Azure replicates the data across different fault domains to internal replicas, this replication occurs only within the same region.</span></span> <span data-ttu-id="8c613-372">アプリケーションは壊滅的な障害に対処することはできません。</span><span class="sxs-lookup"><span data-stu-id="8c613-372">The application cannot withstand a catastrophic failure.</span></span> <span data-ttu-id="8c613-373">リージョンが利用不可になると、障害ドメインも利用できなくなります。これには、すべてのサービス インスタンスやストレージ リソースが含まれます。</span><span class="sxs-lookup"><span data-stu-id="8c613-373">If the region becomes unavailable, then so do the fault domains, including all service instances and storage resources.</span></span>

<span data-ttu-id="8c613-374">最も重要性の低いアプリケーションを除き、複数のリージョンにアプリケーションをデプロイする計画を検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-374">For all but the least critical applications, you must devise a plan to deploy your applications across multiple regions.</span></span> <span data-ttu-id="8c613-375">また、使用するデプロイ トポロジを検討するときは、RTO とコストの制約も考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-375">You should also consider RTO and cost constraints in considering which deployment topology to use.</span></span>

<span data-ttu-id="8c613-376">それでは、異なるリージョン間のフェールオーバーをサポートする具体的なアプローチを見ていきましょう。</span><span class="sxs-lookup"><span data-stu-id="8c613-376">Let’s take a look now at specific approaches to supporting failover across different regions.</span></span> <span data-ttu-id="8c613-377">以下の例では、2 つのリージョンを使用してプロセスを説明します。</span><span class="sxs-lookup"><span data-stu-id="8c613-377">These examples all use two regions to describe the process.</span></span>

### <a name="redeployment-to-a-secondary-azure-region"></a><span data-ttu-id="8c613-378">セカンダリ Azure リージョンへの再デプロイ</span><span class="sxs-lookup"><span data-stu-id="8c613-378">Redeployment to a secondary Azure region</span></span>
<span data-ttu-id="8c613-379">セカンダリ リージョンへの再デプロイ アプローチの場合、プライマリ リージョンでのみアプリケーションとデータベースが実行されます。</span><span class="sxs-lookup"><span data-stu-id="8c613-379">For the approach of redeployment to a secondary region, only the primary region has applications and databases running.</span></span> <span data-ttu-id="8c613-380">セカンダリ リージョンは、自動フェールオーバー用に設定されていません。</span><span class="sxs-lookup"><span data-stu-id="8c613-380">The secondary region is not set up for an automatic failover.</span></span> <span data-ttu-id="8c613-381">したがって、障害が発生したときは、ユーザーが新しいリージョンでサービスのすべての部分を起動する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-381">So when a disaster occurs, you must spin up all the parts of the service in the new region.</span></span> <span data-ttu-id="8c613-382">これには、Azure へのクラウド サービスのアップロード、クラウド サービスのデプロイ、データの復元、およびトラフィックを再ルーティングするための DNS の変更が含まれます。</span><span class="sxs-lookup"><span data-stu-id="8c613-382">This includes uploading a cloud service to Azure, deploying the cloud service, restoring the data, and changing DNS to reroute the traffic.</span></span>

<span data-ttu-id="8c613-383">これは最もコストのかからない複数リージョン オプションですが、RTO 特性は最も劣ります。</span><span class="sxs-lookup"><span data-stu-id="8c613-383">Although this is the most affordable of the multiple-region options, it has the worst RTO characteristics.</span></span> <span data-ttu-id="8c613-384">このモデルでは、サービス パッケージとデータベース バックアップは、オンプレミスに、またはセカンダリ リージョンの Azure Blob Storage インスタンスに格納されます。</span><span class="sxs-lookup"><span data-stu-id="8c613-384">In this model, the service package and database backups are stored either on-premises or in the Azure Blob storage instance of the secondary region.</span></span> <span data-ttu-id="8c613-385">ただし、操作を再開する前に、新しいサービスをデプロイし、データを復元する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-385">However, you must deploy a new service and restore the data before it resumes operation.</span></span> <span data-ttu-id="8c613-386">バックアップ ストレージからのデータ転送を完全に自動化した場合でも、新しいデータベース環境のプロビジョニングには多くの時間を要します。</span><span class="sxs-lookup"><span data-stu-id="8c613-386">Even with full automation of the data transfer from backup storage, provisioning a new database environment consumes a lot of time.</span></span> <span data-ttu-id="8c613-387">復元プロセスで最も負荷の大きな部分は、バックアップ ディスク ストレージからセカンダリ リージョンの空のデータベースへのデータの移動です。</span><span class="sxs-lookup"><span data-stu-id="8c613-387">Moving data from the backup disk storage to the empty database on the secondary region is the most expensive part of the restore process.</span></span> <span data-ttu-id="8c613-388">ただし、データがレプリケートされていないので、新しいデータベースを動作状態にするには、これを行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-388">You must do this, however, to bring the new database to an operational state because it isn't replicated.</span></span>

<span data-ttu-id="8c613-389">最善のアプローチは、セカンダリ リージョンの Blob Storage にサービス パッケージを格納しておくことです。</span><span class="sxs-lookup"><span data-stu-id="8c613-389">The best approach is to store the service packages in Blob storage in the secondary region.</span></span> <span data-ttu-id="8c613-390">これにより、Azure にパッケージをアップロードする必要がなくなります。オンプレミスの開発用コンピューターからデプロイする場合は、これが行われます。</span><span class="sxs-lookup"><span data-stu-id="8c613-390">This eliminates the need to upload the package to Azure, which is what happens when you deploy from an on-premises development machine.</span></span> <span data-ttu-id="8c613-391">PowerShell スクリプトを使用することで、Blob Storage から新しいクラウド サービスにサービス パッケージをすばやくデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-391">You can quickly deploy the service packages to a new cloud service from Blob storage by using PowerShell scripts.</span></span>

<span data-ttu-id="8c613-392">このオプションは、高い RTO を許容できる重要ではないアプリケーションの場合にのみ実用的です。</span><span class="sxs-lookup"><span data-stu-id="8c613-392">This option is practical only for non-critical applications that can tolerate a high RTO.</span></span> <span data-ttu-id="8c613-393">たとえば、数時間停止していてもかまわないが、24 時間以内には利用可能になる必要のあるようなアプリケーションには適しています。</span><span class="sxs-lookup"><span data-stu-id="8c613-393">For instance, this might work for an application that can be down for several hours but is required to be available within 24 hours.</span></span>

![セカンダリ Azure リージョンへの再デプロイ](./images/disaster-recovery-azure-applications/redeploy-to-a-secondary-azure-region.png)

### <a name="active-passive"></a><span data-ttu-id="8c613-395">アクティブ/パッシブ</span><span class="sxs-lookup"><span data-stu-id="8c613-395">Active-passive</span></span>
<span data-ttu-id="8c613-396">アクティブ/パッシブ トポロジは多くの企業で好まれる選択です。</span><span class="sxs-lookup"><span data-stu-id="8c613-396">An active-passive topology is the choice that many companies favor.</span></span> <span data-ttu-id="8c613-397">このトポロジでは、再デプロイ アプローチより比較的少ないコスト増加で、RTO が向上します。</span><span class="sxs-lookup"><span data-stu-id="8c613-397">This topology provides improvements to the RTO with a relatively small increase in cost over the redeployment approach.</span></span> <span data-ttu-id="8c613-398">このシナリオにも、プライマリとセカンダリの Azure リージョンがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-398">In this scenario, there is again a primary and a secondary Azure region.</span></span> <span data-ttu-id="8c613-399">すべてのトラフィックは、プライマリ リージョンのアクティブなデプロイに送られます。</span><span class="sxs-lookup"><span data-stu-id="8c613-399">All of the traffic goes to the active deployment on the primary region.</span></span> <span data-ttu-id="8c613-400">データベースは両方のリージョンで動作しているため、セカンダリ リージョンはディザスター リカバリーの準備ができています。</span><span class="sxs-lookup"><span data-stu-id="8c613-400">The secondary region is better prepared for disaster recovery because the database is running on both regions.</span></span> <span data-ttu-id="8c613-401">さらに、両方のリージョンの間には同期メカニズムがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-401">Additionally, a synchronization mechanism is in place between them.</span></span> <span data-ttu-id="8c613-402">このスタンバイ アプローチには、データベースのみのアプローチと、セカンダリ リージョンへの完全なデプロイの、2 つのバリエーションがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-402">This standby approach can involve two variations: a database-only approach or a complete deployment in the secondary region.</span></span>

#### <a name="database-only"></a><span data-ttu-id="8c613-403">データベースのみ</span><span class="sxs-lookup"><span data-stu-id="8c613-403">Database only</span></span>
<span data-ttu-id="8c613-404">アクティブ/パッシブ トポロジの第 1 のバリエーションでは、プライマリ リージョンのみにクラウド サービス アプリケーションがデプロイされます。</span><span class="sxs-lookup"><span data-stu-id="8c613-404">In the first variation of the active-passive topology, only the primary region has a deployed cloud service application.</span></span> <span data-ttu-id="8c613-405">ただし、再デプロイのアプローチとは異なり、データベースの内容は両方のリージョン間で同期されています </span><span class="sxs-lookup"><span data-stu-id="8c613-405">However, unlike the redeployment approach, both regions are synchronized with the contents of the database.</span></span> <span data-ttu-id="8c613-406">(詳細については、「[障害復旧のためのトランザクション データ パターン](#transactional-data-pattern-for-disaster-recovery)」をご覧ください)。障害が発生したときにアクティブ化する必要のあるものが少なくなります。</span><span class="sxs-lookup"><span data-stu-id="8c613-406">(For more information, see the section on [transactional data pattern for disaster recovery](#transactional-data-pattern-for-disaster-recovery).) When a disaster occurs, there are fewer activation requirements.</span></span> <span data-ttu-id="8c613-407">セカンダリ リージョンでアプリケーションを起動し、接続文字列を新しいデータベースに変更して、トラフィックを再ルーティングするように DNS エントリを変更します。</span><span class="sxs-lookup"><span data-stu-id="8c613-407">You start the application in the secondary region, change connection strings to the new database, and change the DNS entries to reroute traffic.</span></span>

<span data-ttu-id="8c613-408">再デプロイ アプローチと同様に、デプロイの時間を短縮するには、セカンダリ リージョンの Azure Blob Storage にサービス パッケージを格納しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-408">Like the redeployment approach, you should have already stored the service packages in Azure Blob storage in the secondary region for faster deployment.</span></span> <span data-ttu-id="8c613-409">ただし、データベースは準備が整っていて、実行されているので、データベースの復元操作に必要なオーバーヘッドの多くは発生しません。</span><span class="sxs-lookup"><span data-stu-id="8c613-409">However, you don’t incur the majority of the overhead that database restore operation requires, because the database is ready and running.</span></span> <span data-ttu-id="8c613-410">これにより多くの時間が節約されるため、手頃なコストの DR パターンとなっています (最も頻繁に使用されています)。</span><span class="sxs-lookup"><span data-stu-id="8c613-410">This saves a significant amount of time, making this an affordable DR pattern (and the one most frequently used).</span></span>

![Active-passive, database only](./images/disaster-recovery-azure-applications/active-passive-database-only.png)

#### <a name="full-replica"></a><span data-ttu-id="8c613-412">完全なレプリカ</span><span class="sxs-lookup"><span data-stu-id="8c613-412">Full replica</span></span>
<span data-ttu-id="8c613-413">アクティブ/パッシブ トポロジの第 2 のバリエーションでは、プライマリ リージョンとセカンダリ リージョンの両方に完全なデプロイがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-413">In the second variation of the active-passive topology, both the primary region and the secondary region have a full deployment.</span></span> <span data-ttu-id="8c613-414">このデプロイには、クラウド サービスと同期化されたデータベースが含まれます。</span><span class="sxs-lookup"><span data-stu-id="8c613-414">This deployment includes the cloud services and a synchronized database.</span></span> <span data-ttu-id="8c613-415">ただし、プライマリ リージョンのみが、ユーザーからのネットワーク要求をアクティブに処理しています。</span><span class="sxs-lookup"><span data-stu-id="8c613-415">However, only the primary region is actively handling network requests from the users.</span></span> <span data-ttu-id="8c613-416">セカンダリ リージョンは、プライマリ リージョンでサービスの中断が発生した場合にのみアクティブになります。</span><span class="sxs-lookup"><span data-stu-id="8c613-416">The secondary region becomes active only when the primary region experiences a service disruption.</span></span> <span data-ttu-id="8c613-417">その場合、新しいネットワーク要求はすべて、セカンダリ リージョンにルーティングされます。</span><span class="sxs-lookup"><span data-stu-id="8c613-417">In that case, all new network requests route to the secondary region.</span></span> <span data-ttu-id="8c613-418">Azure Traffic Manager は、このフェールオーバーを自動的に管理できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-418">Azure Traffic Manager can manage this failover automatically.</span></span>

<span data-ttu-id="8c613-419">サービスが既にデプロイされているため、フェールオーバーはデータベースのみのバリエーションより高速に行われます。</span><span class="sxs-lookup"><span data-stu-id="8c613-419">Failover occurs faster than the database-only variation because the services are already deployed.</span></span> <span data-ttu-id="8c613-420">このトポロジの RTO は非常に低くなります。</span><span class="sxs-lookup"><span data-stu-id="8c613-420">This topology provides a very low RTO.</span></span> <span data-ttu-id="8c613-421">セカンダリ フェールオーバー リージョンは、プライマリ リージョンで障害が発生した直後に動作可能な状態になる必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-421">The secondary failover region must be ready to go immediately after failure of the primary region.</span></span>

<span data-ttu-id="8c613-422">このトポロジは、応答時間が速いだけでなく、バックアップ サービスを事前に割り当てておいてデプロイするため、障害発生時に新しいインスタンスを割り当てる領域が不足する可能性を回避することができます。</span><span class="sxs-lookup"><span data-stu-id="8c613-422">Along with a quicker response time, this topology pre-allocates and deploys backup services, avoiding the possibility of a lack of space to allocate new instances during a disaster.</span></span> <span data-ttu-id="8c613-423">セカンダリ Azure リージョンが容量に近づいている場合、これは重要なことです。</span><span class="sxs-lookup"><span data-stu-id="8c613-423">This is important if your secondary Azure region is nearing capacity.</span></span> <span data-ttu-id="8c613-424">サービス レベル アグリーメント (SLA) では、任意のリージョンに 1 つまたは複数の新しいクラウド サービスをすぐにデプロイできることを保証していません。</span><span class="sxs-lookup"><span data-stu-id="8c613-424">No service-level agreement (SLA) guarantees that you can instantly deploy one or more new cloud services in any region.</span></span>

<span data-ttu-id="8c613-425">このモデルの応答時間を最短にするには、プライマリ リージョンとセカンダリ リージョンを似たスケール (ロール インスタンスの数) にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-425">For the fastest response time with this model, you must have similar scale (number of role instances) in the primary and secondary regions.</span></span> <span data-ttu-id="8c613-426">以上のような利点はありますが、使用していないコンピューティング インスタンスの料金を払う必要があり、コスト的に最も妥当な選択肢とは限りません。</span><span class="sxs-lookup"><span data-stu-id="8c613-426">Despite the advantages, paying for unused compute instances is costly, and this might not be the most prudent financial choice.</span></span> <span data-ttu-id="8c613-427">このため、セカンダリ リージョンではややスケール ダウンしたバージョンのクラウド サービスを使用するのが一般的です。</span><span class="sxs-lookup"><span data-stu-id="8c613-427">Because of this, it's more common to use a slightly scaled-down version of cloud services on the secondary region.</span></span> <span data-ttu-id="8c613-428">その場合、必要に応じて迅速にセカンダリ デプロイをフェールオーバーおよびスケールアウトできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-428">Then you can quickly fail over and scale out the secondary deployment if necessary.</span></span> <span data-ttu-id="8c613-429">プライマリ リージョンにアクセスできなくなったら、負荷に応じて追加のインスタンスがアクティブ化されるよう、フェールオーバー プロセスを自動化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-429">You should automate the failover process so that after the primary region is inaccessible, you activate additional instances, depending on the load.</span></span> <span data-ttu-id="8c613-430">これには、 [仮想マシン スケール セット](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/)のような自動スケール メカニズムの使用が含まれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-430">This might involve the use of an autoscaling mechanism like [virtual machine scale sets](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/).</span></span>

<span data-ttu-id="8c613-431">次の図に示すモデルでは、プライマリ リージョンとセカンダリ リージョンに、アクティブ/パッシブ トポロジで完全にデプロイされたクラウド サービスが含まれます。</span><span class="sxs-lookup"><span data-stu-id="8c613-431">The following diagram shows the model where the primary and secondary regions contain a fully deployed cloud service in an active-passive topology.</span></span>

![Active-passive, full replica](./images/disaster-recovery-azure-applications/active-passive-full-replica.png)

### <a name="active-active"></a><span data-ttu-id="8c613-433">アクティブ/アクティブ</span><span class="sxs-lookup"><span data-stu-id="8c613-433">Active-active</span></span>
<span data-ttu-id="8c613-434">アクティブ/アクティブ トポロジでは、両方のリージョンにクラウド サービスとデータベースが完全にデプロイされます。</span><span class="sxs-lookup"><span data-stu-id="8c613-434">In an active-active topology, the cloud services and database are fully deployed in both regions.</span></span> <span data-ttu-id="8c613-435">アクティブ/パッシブ モデルとは異なりは、両方のリージョンがユーザー トラフィックを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="8c613-435">Unlike the active-passive model, both regions receive user traffic.</span></span> <span data-ttu-id="8c613-436">このオプションでは、最も短い復旧時間を実現できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-436">This option yields the quickest recovery time.</span></span> <span data-ttu-id="8c613-437">サービスは既に、各リージョンでの負荷の一部を処理できるスケールが設定されています。</span><span class="sxs-lookup"><span data-stu-id="8c613-437">The services are already scaled to handle a portion of the load at each region.</span></span> <span data-ttu-id="8c613-438">DNS は既にセカンダリ リージョンを使用できる状態になっています。</span><span class="sxs-lookup"><span data-stu-id="8c613-438">DNS is already enabled to use the secondary region.</span></span> <span data-ttu-id="8c613-439">ユーザーを適切なリージョンにルーティングする方法の決定については複雑さが増します。</span><span class="sxs-lookup"><span data-stu-id="8c613-439">There's additional complexity in determining how to route users to the appropriate region.</span></span> <span data-ttu-id="8c613-440">ラウンドロビン スケジューリングを使用できる場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-440">Round-robin scheduling might be possible.</span></span> <span data-ttu-id="8c613-441">さらに可能性が高いのは、特定のユーザーが、データのプライマリ コピーが存在する特定のリージョンを使用する方法です。</span><span class="sxs-lookup"><span data-stu-id="8c613-441">It's more likely that certain users would use a specific region where the primary copy of their data resides.</span></span>

<span data-ttu-id="8c613-442">フェールオーバーの場合は、プライマリ リージョンへの DNS を無効にするだけで、</span><span class="sxs-lookup"><span data-stu-id="8c613-442">In case of failover, simply disable DNS to the primary region.</span></span> <span data-ttu-id="8c613-443">すべてのトラフィックがセカンダリ リージョンにルーティングされます。</span><span class="sxs-lookup"><span data-stu-id="8c613-443">This routes all traffic to the secondary region.</span></span>

<span data-ttu-id="8c613-444">このモデルにもいくつかのバリエーションがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-444">Even in this model, there are some variations.</span></span> <span data-ttu-id="8c613-445">たとえば、次の図に示すプライマリ リージョンは、データベースのマスター コピーを所有しています。</span><span class="sxs-lookup"><span data-stu-id="8c613-445">For example, the following diagram depicts a primary region which owns the master copy of the database.</span></span> <span data-ttu-id="8c613-446">両方のリージョンのクラウド サービスが、そのプライマリ データベースに書き込みます。</span><span class="sxs-lookup"><span data-stu-id="8c613-446">The cloud services in both regions write to that primary database.</span></span> <span data-ttu-id="8c613-447">セカンダリ デプロイは、プライマリ データベースまたはレプリケートされたデータベースから読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="8c613-447">The secondary deployment can read from the primary or replicated database.</span></span> <span data-ttu-id="8c613-448">この例のレプリケーションは 1 方向となります。</span><span class="sxs-lookup"><span data-stu-id="8c613-448">Replication in this example is one-way.</span></span>

![アクティブ/アクティブ](./images/disaster-recovery-azure-applications/active-active.png)

<span data-ttu-id="8c613-450">前の図のアクティブ/アクティブ アーキテクチャには欠点があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-450">There is a downside to the active-active architecture in the preceding diagram.</span></span> <span data-ttu-id="8c613-451">第 1 のリージョンにマスター コピーがあるため、第 2 のリージョンは第 1 のリージョンのデータベースにアクセスする必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-451">The second region must access the database in the first region because the master copy resides there.</span></span> <span data-ttu-id="8c613-452">リージョン外からデータにアクセスすると、パフォーマンスが大幅に低下します。</span><span class="sxs-lookup"><span data-stu-id="8c613-452">Performance significantly drops off when you access data from outside a region.</span></span> <span data-ttu-id="8c613-453">クロスリージョンのデータベース呼び出しでは、呼び出しのパフォーマンスが向上するように、何らかのバッチ処理方式を検討する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-453">In cross-region database calls, you should consider some type of batching strategy to improve the performance of these calls.</span></span> <span data-ttu-id="8c613-454">詳細については、「 [バッチ処理を使用して SQL Database アプリケーションのパフォーマンスを強化する方法](/azure/sql-database/sql-database-use-batching-to-improve-performance/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-454">For more information, see [How to use batching to improve SQL Database application performance](/azure/sql-database/sql-database-use-batching-to-improve-performance/).</span></span>

<span data-ttu-id="8c613-455">代わりのアーキテクチャとしては、各リージョンが専用のデータベースに直接アクセスする方法があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-455">An alternative architecture might involve each region accessing its own database directly.</span></span> <span data-ttu-id="8c613-456">このモデルでは、各リージョンのデータベースを同期するため、何らかの種類の双方向レプリケーションが必要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-456">In that model, some type of bidirectional replication is required to synchronize the databases in each region.</span></span>

<span data-ttu-id="8c613-457">前述のトポロジでは、RTO を短縮すると、一般的にコストと複雑さが増します。</span><span class="sxs-lookup"><span data-stu-id="8c613-457">With the previous topologies, decreasing RTO generally increases costs and complexity.</span></span> <span data-ttu-id="8c613-458">アクティブ/アクティブ トポロジは、このコスト パターンから逸脱します。</span><span class="sxs-lookup"><span data-stu-id="8c613-458">The active-active topology deviates from this cost pattern.</span></span> <span data-ttu-id="8c613-459">アクティブ/アクティブ トポロジでは、プライマリ リージョンのインスタンス数がアクティブ/パッシブ トポロジほど多くなくて済む場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-459">In the active-active topology, you might not need as many instances on the primary region as you would in the active-passive topology.</span></span> <span data-ttu-id="8c613-460">アクティブ/パッシブ アーキテクチャのプライマリ リージョンに 10 個のインスタンスがある場合、アクティブ/アクティブ アーキテクチャの各リージョンでは 5 個しか必要ないかもしれません。</span><span class="sxs-lookup"><span data-stu-id="8c613-460">If you have 10 instances on the primary region in an active-passive architecture, you might need only 5 in each region in an active-active architecture.</span></span> <span data-ttu-id="8c613-461">このモデルでは、両方のリージョンが負荷を共有します。</span><span class="sxs-lookup"><span data-stu-id="8c613-461">Both regions now share the load.</span></span> <span data-ttu-id="8c613-462">パッシブ リージョンでフェールオーバーを待機する 10 個のインスタンスを使用してウォーム スタンバイを維持する場合、アクティブ/パッシブ トポロジよりコストが節約されることがあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-462">This might be a cost savings over the active-passive topology if you keep a warm standby on the passive region with 10 instances waiting for failover.</span></span>

<span data-ttu-id="8c613-463">プライマリ リージョンを復元するまで、セカンダリ リージョンで新しいユーザーが急激に増加する可能性があることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-463">Realize that until you restore the primary region, the secondary region might receive a sudden surge of new users.</span></span> <span data-ttu-id="8c613-464">プライマリ リージョンでサービスが中断したときに各サーバーに 10,000 人のユーザーがいた場合、セカンダリ リージョンは突然 20,000 人のユーザーを処理しなければならなくなります。</span><span class="sxs-lookup"><span data-stu-id="8c613-464">If there are 10,000 users on each server when the primary region experiences a service disruption, the secondary region suddenly has to handle 20,000 users.</span></span> <span data-ttu-id="8c613-465">セカンダリ リージョンの監視ルールは、セカンダリ リージョンでのインスタンスの倍増を検出する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-465">Monitoring rules on the secondary region must detect this increase and double the instances in the secondary region.</span></span> <span data-ttu-id="8c613-466">これに関する詳細については、「 [障害の検出](#failure-detection)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-466">For more information on this, see the section on [failure detection](#failure-detection).</span></span>

## <a name="hybrid-on-premises-and-cloud-solution"></a><span data-ttu-id="8c613-467">オンプレミスとクラウドのハイブリッド ソリューション</span><span class="sxs-lookup"><span data-stu-id="8c613-467">Hybrid on-premises and cloud solution</span></span>
<span data-ttu-id="8c613-468">ディザスター リカバリーのもう 1 つの戦略は、オンプレミスとクラウドで実行するハイブリッド アプリケーションを設計することです。</span><span class="sxs-lookup"><span data-stu-id="8c613-468">One additional strategy for disaster recovery is to architect a hybrid application that runs on-premises and in the cloud.</span></span> <span data-ttu-id="8c613-469">アプリケーションによっては、プライマリ リージョンがどちらの場所にあってもかまいません。</span><span class="sxs-lookup"><span data-stu-id="8c613-469">Depending on the application, the primary region might be either location.</span></span> <span data-ttu-id="8c613-470">前のアーキテクチャで、プライマリ リージョンまたはセカンダリ リージョンがオンプレミスにある場合を考えてみてください。</span><span class="sxs-lookup"><span data-stu-id="8c613-470">Consider the previous architectures and imagine the primary or secondary region as an on-premises location.</span></span>

<span data-ttu-id="8c613-471">このようなハイブリッド アーキテクチャには、いくつかの課題があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-471">There are some challenges in these hybrid architectures.</span></span> <span data-ttu-id="8c613-472">まず、この記事のほとんどでは、PaaS アーキテクチャ パターンについて説明しています。</span><span class="sxs-lookup"><span data-stu-id="8c613-472">First, most of this article has addressed PaaS architecture patterns.</span></span> <span data-ttu-id="8c613-473">Azure の一般的な PaaS アプリケーションは、ロール、クラウド サービス、Traffic Manager などの Azure 固有の構造に依存します。</span><span class="sxs-lookup"><span data-stu-id="8c613-473">Typical PaaS applications in Azure rely on Azure-specific constructs such as roles, cloud services, and Traffic Manager.</span></span> <span data-ttu-id="8c613-474">この種の PaaS アプリケーション用のオンプレミス ソリューションを作成する場合は、大幅に異なるアーキテクチャが必要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-474">Creating an on-premises solution for this type of PaaS application would require a significantly different architecture.</span></span> <span data-ttu-id="8c613-475">これは、管理やコストの点で実現できない場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-475">This might not be feasible from a management or cost perspective.</span></span>

<span data-ttu-id="8c613-476">一方、ディザスター リカバリー用のハイブリッド ソリューションでは、クラウドに移行された従来のアーキテクチャ (IaaS ベースのアーキテクチャなど) に対する課題はほとんどありません。</span><span class="sxs-lookup"><span data-stu-id="8c613-476">However, a hybrid solution for disaster recovery has fewer challenges for traditional architectures that have been migrated to the cloud, such as IaaS-based architectures.</span></span> <span data-ttu-id="8c613-477">IaaS アプリケーションは、オンプレミスに同等の機能を直接持つことができるクラウド内の仮想マシンを使用します。</span><span class="sxs-lookup"><span data-stu-id="8c613-477">IaaS applications use virtual machines in the cloud that can have direct on-premises equivalents.</span></span> <span data-ttu-id="8c613-478">仮想ネットワークの使用により、クラウドのマシンをオンプレミスのネットワーク リソースと接続することもできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-478">You can also use virtual networks to connect machines in the cloud with on-premises network resources.</span></span> <span data-ttu-id="8c613-479">これにより、PaaS のみのアプリケーションでは実現できない複数の可能性が生まれます。</span><span class="sxs-lookup"><span data-stu-id="8c613-479">This allows several possibilities that are not possible with PaaS-only applications.</span></span> <span data-ttu-id="8c613-480">たとえば、SQL Server は、AlwaysOn 可用性グループやデータベース ミラーリングなどのディザスター リカバリー ソリューションを利用できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-480">For example, SQL Server can take advantage of disaster recovery solutions such as AlwaysOn Availability Groups and database mirroring.</span></span> <span data-ttu-id="8c613-481">詳細については、「[Azure 仮想マシンにおける SQL Server の高可用性とディザスター リカバリー](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-481">For details, see [High availability and disaster recovery for SQL Server in Azure virtual machines](/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr/).</span></span>

<span data-ttu-id="8c613-482">また、IaaS ソリューションは、フェールオーバー オプションとして Azure を使用する簡単なパスをオンプレミスのアプリケーションに提供します。</span><span class="sxs-lookup"><span data-stu-id="8c613-482">IaaS solutions also provide an easier path for on-premises applications to use Azure as the failover option.</span></span> <span data-ttu-id="8c613-483">既存のオンプレミス リージョンに完全に機能するアプリケーションがあるかもしれません。</span><span class="sxs-lookup"><span data-stu-id="8c613-483">You might have a fully functioning application in an existing on-premises region.</span></span> <span data-ttu-id="8c613-484">しかし、フェールオーバーのために地理的に別のリージョンを維持するためのリソースがなかったらどうでしょう。</span><span class="sxs-lookup"><span data-stu-id="8c613-484">However, what if you lack the resources to maintain a geographically separate region for failover?</span></span> <span data-ttu-id="8c613-485">仮想マシンと仮想ネットワークを使用して、Azure でアプリケーションを実行できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-485">You might decide to use virtual machines and virtual networks to get your application running in Azure.</span></span> <span data-ttu-id="8c613-486">その場合は、クラウドにデータを同期するプロセスを定義します。</span><span class="sxs-lookup"><span data-stu-id="8c613-486">In that case, define processes that synchronize data to the cloud.</span></span> <span data-ttu-id="8c613-487">Azure のデプロイはフェールオーバーに使用するセカンダリ リージョンになります。</span><span class="sxs-lookup"><span data-stu-id="8c613-487">The Azure deployment then becomes the secondary region to use for failover.</span></span> <span data-ttu-id="8c613-488">プライマリ リージョンはオンプレミスのアプリケーションのままです。</span><span class="sxs-lookup"><span data-stu-id="8c613-488">The primary region remains the on-premises application.</span></span> <span data-ttu-id="8c613-489">IaaS のアーキテクチャと機能の詳細については、 [Virtual Machines のドキュメント](https://azure.microsoft.com/documentation/services/virtual-machines/)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-489">For more information about IaaS architectures and capabilities, see the [Virtual Machines documentation](https://azure.microsoft.com/documentation/services/virtual-machines/).</span></span>

## <a name="alternative-cloud"></a><span data-ttu-id="8c613-490">代替クラウド</span><span class="sxs-lookup"><span data-stu-id="8c613-490">Alternative cloud</span></span>
<span data-ttu-id="8c613-491">Microsoft Azure の広範な機能でも、組織によって求められる内部的なコンプライアンス規則またはポリシーを満たしていない場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-491">There are situations where the broad capabilities of Microsoft Azure still may not meet internal compliance rules or policies required by your organization.</span></span> <span data-ttu-id="8c613-492">十分に準備し、障害時のバックアップ システムを実装するように設計しても、クラウド サービス プロバイダーのグローバル サービスに中断があった場合は不十分です。</span><span class="sxs-lookup"><span data-stu-id="8c613-492">Even the best preparation and design to implement backup systems during a disaster are inadequate during a global service disruption of a cloud service provider.</span></span>

<span data-ttu-id="8c613-493">可用性の要件と、可用性を高めることによるコストと複雑さの上昇を比較する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-493">You should compare availability requirements with the cost and complexity of increased availability.</span></span> <span data-ttu-id="8c613-494">リスク分析を実行し、ソリューションの RTO と RPO を定義します。</span><span class="sxs-lookup"><span data-stu-id="8c613-494">Perform a risk analysis, and define the RTO and RPO for your solution.</span></span> <span data-ttu-id="8c613-495">アプリケーションがダウンタイムを許容できない場合は、追加のクラウド ソリューションの使用を検討してみてください。</span><span class="sxs-lookup"><span data-stu-id="8c613-495">If your application cannot tolerate any downtime, you might consider using an additional cloud solution.</span></span> <span data-ttu-id="8c613-496">インターネット全体がダウンしない限り、Azure がグローバルにアクセスできなくなっても、別のクラウド ソリューションはまだ使用できる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-496">Unless the entire Internet goes down, another cloud solution might still be available if Azure becomes globally inaccessible.</span></span>

<span data-ttu-id="8c613-497">ハイブリッド シナリオと同様に、前のディザスター リカバリー アーキテクチャのフェールオーバー デプロイは、別のクラウド ソリューションにも存在できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-497">As with the hybrid scenario, the failover deployments in the previous disaster recovery architectures can also exist within another cloud solution.</span></span> <span data-ttu-id="8c613-498">代替クラウドの DR サイトは、(あったとしても) 非常に小さいダウンタイムを許す RTO のソリューションに対してのみ使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-498">Alternative cloud DR sites should be used only for solutions whose RTO allows very little, if any, downtime.</span></span> <span data-ttu-id="8c613-499">Azure の外部の DR サイトを使用するソリューションでは、構成、開発、デプロイ、保守の作業が増えることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-499">Note that a solution that uses a DR site outside Azure will require more work to configure, develop, deploy, and maintain.</span></span> <span data-ttu-id="8c613-500">クロスクラウド アーキテクチャに実証済みのプラクティスを実装することもさらに困難になります。</span><span class="sxs-lookup"><span data-stu-id="8c613-500">It's also more difficult to implement proven practices in a cross-cloud architecture.</span></span> <span data-ttu-id="8c613-501">クラウド プラットフォームの上位レベルの概念は似ていますが、API とアーキテクチャは異なります。</span><span class="sxs-lookup"><span data-stu-id="8c613-501">Although cloud platforms have similar high-level concepts, the APIs and architectures are different.</span></span>

<span data-ttu-id="8c613-502">DR 戦略が複数のクラウド プラットフォームに依存している場合は、ソリューションの設計に抽象化レイヤーを含めることが大事です。</span><span class="sxs-lookup"><span data-stu-id="8c613-502">If your DR strategy relies upon multiple cloud platforms, it's valuable to include abstraction layers in the design of the solution.</span></span> <span data-ttu-id="8c613-503">これにより、障害に備えて、異なるクラウド プラットフォーム用に同じアプリケーションの 2 つの異なるバージョンを開発して管理する必要はなくなります。</span><span class="sxs-lookup"><span data-stu-id="8c613-503">This eliminates the need to develop and maintain two different versions of the same application for different cloud platforms in case of disaster.</span></span> <span data-ttu-id="8c613-504">ハイブリッド シナリオと同様に、これらのケースでは、Azure Virtual Machines か Azure コンテナー サービスを使用する方が、クラウド固有の PaaS 設計を使用するより簡単な場合があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-504">As with the hybrid scenario, the use of Azure Virtual Machines or Azure Container Service might be easier in these cases than the use of cloud-specific PaaS designs.</span></span>

## <a name="automation"></a><span data-ttu-id="8c613-505">Automation</span><span class="sxs-lookup"><span data-stu-id="8c613-505">Automation</span></span>
<span data-ttu-id="8c613-506">ここで説明したパターンの一部では、オフライン デプロイの迅速なアクティブ化と、システムの特定の部分の復元が必要になります。</span><span class="sxs-lookup"><span data-stu-id="8c613-506">Some of the patterns that we just discussed require quick activation of offline deployments as well as restoration of specific parts of a system.</span></span> <span data-ttu-id="8c613-507">Automation スクリプトを使用すると、必要に応じてリソースをアクティブ化し、ソリューションをすばやくデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-507">Automation scripts can activate resources on demand and deploy solutions rapidly.</span></span> <span data-ttu-id="8c613-508">以下に示す DR 関連の自動化の例では、[Azure PowerShell](https://msdn.microsoft.com/library/azure/jj156055.aspx) を使用していますが、[Azure CLI](https://docs.microsoft.com/en-us/cli/azure/get-started-with-azure-cli) または [Service Management REST API](https://msdn.microsoft.com/library/azure/ee460799.aspx) を使用する方法もお勧めします。</span><span class="sxs-lookup"><span data-stu-id="8c613-508">The DR-related automation examples below use [Azure PowerShell](https://msdn.microsoft.com/library/azure/jj156055.aspx), but using the [Azure CLI](https://docs.microsoft.com/en-us/cli/azure/get-started-with-azure-cli) or the [Service Management REST API](https://msdn.microsoft.com/library/azure/ee460799.aspx) are also good options.</span></span>

<span data-ttu-id="8c613-509">自動化スクリプトでは、Azure によって透過的に処理されない DR の側面を管理します。</span><span class="sxs-lookup"><span data-stu-id="8c613-509">Automation scripts manage aspects of DR not transparently handled by Azure.</span></span> <span data-ttu-id="8c613-510">これにより、一貫性のある反復可能な結果がもたらされ、人為的なミスを最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="8c613-510">This produces consistent and repeatable results, minimizing human error.</span></span> <span data-ttu-id="8c613-511">事前定義された DR スクリプトを使用すると、障害発生時にシステムとその構成要素を再構築するのに要する時間も短縮されます。</span><span class="sxs-lookup"><span data-stu-id="8c613-511">Predefined DR scripts also reduce the time to rebuild a system and its constituent parts during a disaster.</span></span> <span data-ttu-id="8c613-512">ダウンして 1 分ごとにお金が失われているのにサイトの復元方法を手動で見つけるようなことはしたくありません。</span><span class="sxs-lookup"><span data-stu-id="8c613-512">You don’t want to try to manually figure out how to restore your site while it's down and losing money every minute.</span></span>

<span data-ttu-id="8c613-513">開始から終了までスクリプトを繰り返しテストします。</span><span class="sxs-lookup"><span data-stu-id="8c613-513">Test your scripts repeatedly from start to finish.</span></span> <span data-ttu-id="8c613-514">基本的な機能を確認した後は、[障害のシミュレーション](#disaster-simulation)でそれらを必ずテストします。</span><span class="sxs-lookup"><span data-stu-id="8c613-514">After verifying their basic functionality, make sure to test them in [disaster simulation](#disaster-simulation).</span></span> <span data-ttu-id="8c613-515">これにより、スクリプトやプロセスの不備が検出されます。</span><span class="sxs-lookup"><span data-stu-id="8c613-515">This helps uncover defects in the scripts or processes.</span></span>

<span data-ttu-id="8c613-516">Automation に関するベスト プラクティスとしては、Azure 障害復旧のための PowerShell スクリプトまたはコマンド ライン インターフェイス (CLI) スクリプトのリポジトリを作成します。</span><span class="sxs-lookup"><span data-stu-id="8c613-516">A best practice with automation is to create a repository of PowerShell scripts or command-line interface (CLI) scripts for Azure disaster recovery.</span></span> <span data-ttu-id="8c613-517">すばやくアクセスできるように明確にマークして分類します。</span><span class="sxs-lookup"><span data-stu-id="8c613-517">Clearly mark and categorize them for quick access.</span></span> <span data-ttu-id="8c613-518">スクリプトのリポジトリとバージョンを管理するプライマリ ユーザーを指定します。</span><span class="sxs-lookup"><span data-stu-id="8c613-518">Designate a primary person to manage the repository and versioning of the scripts.</span></span> <span data-ttu-id="8c613-519">パラメーターの説明とスクリプトの使用例をドキュメントにします。</span><span class="sxs-lookup"><span data-stu-id="8c613-519">Document them well with explanations of parameters and examples of script use.</span></span> <span data-ttu-id="8c613-520">また、このドキュメントと Azure のデプロイの同期を保ちます。</span><span class="sxs-lookup"><span data-stu-id="8c613-520">Also ensure that you keep this documentation in sync with your Azure deployments.</span></span> <span data-ttu-id="8c613-521">これが、リポジトリのすべての部分を担当するプライマリ ユーザーを配置する目的です。</span><span class="sxs-lookup"><span data-stu-id="8c613-521">This underscores the purpose of having a primary person in charge of all parts of the repository.</span></span>

## <a name="failure-detection"></a><span data-ttu-id="8c613-522">障害の検出</span><span class="sxs-lookup"><span data-stu-id="8c613-522">Failure detection</span></span>
<span data-ttu-id="8c613-523">可用性と障害復旧に関する問題を正しく処理するには、障害を検出して診断できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-523">To correctly handle problems with availability and disaster recovery, you must be able to detect and diagnose failures.</span></span> <span data-ttu-id="8c613-524">システムまたはそのコンポーネントが突然利用不可になったタイミングを迅速に認識するために、サーバーとデプロイの詳細な監視を実行します。</span><span class="sxs-lookup"><span data-stu-id="8c613-524">Perform advanced server and deployment monitoring to quickly recognize when a system or its components suddenly become unavailable.</span></span> <span data-ttu-id="8c613-525">クラウド サービスとその依存関係の全体的な正常性を評価する監視ツールで、この作業の一部を実行できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-525">Monitoring tools that assess the overall health of the cloud service and its dependencies can perform part of this work.</span></span> <span data-ttu-id="8c613-526">適切な Microsoft のツールの 1 つは [System Center 2016](https://www.microsoft.com/en-us/server-cloud/products/system-center-2016/) です。</span><span class="sxs-lookup"><span data-stu-id="8c613-526">One suitable Microsoft tool is [System Center 2016](https://www.microsoft.com/en-us/server-cloud/products/system-center-2016/).</span></span> <span data-ttu-id="8c613-527">サード パーティ製ツールも監視機能を提供できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-527">Third-party tools can also provide monitoring capabilities.</span></span> <span data-ttu-id="8c613-528">ほとんどの監視ソリューションは、主要なパフォーマンス カウンターとサービスの可用性を追跡します。</span><span class="sxs-lookup"><span data-stu-id="8c613-528">Most monitoring solutions track key performance counters and service availability.</span></span>

<span data-ttu-id="8c613-529">これらのツールは不可欠ですが、クラウド サービスでの障害検出およびレポートについて計画を立てることも必要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-529">Although these tools are vital, you must plan for fault detection and reporting within a cloud service.</span></span> <span data-ttu-id="8c613-530">また、Azure 診断の適切な使用を計画する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-530">You must also plan to properly use Azure Diagnostics.</span></span> <span data-ttu-id="8c613-531">カスタム パフォーマンス カウンターまたはイベント ログ エントリも、全体的な戦略に組み込むことができます。</span><span class="sxs-lookup"><span data-stu-id="8c613-531">Custom performance counters or event-log entries can also be part of the overall strategy.</span></span> <span data-ttu-id="8c613-532">これらは障害の間により多くのデータを提供し、問題をすばやく診断して完全な機能を復元するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="8c613-532">This provides more data during failures to quickly diagnose the problem and restore full capabilities.</span></span> <span data-ttu-id="8c613-533">また、監視ツールがアプリケーションの正常性の判断に使用できる追加メトリックも提供します。</span><span class="sxs-lookup"><span data-stu-id="8c613-533">It also provides additional metrics that the monitoring tools can use to determine application health.</span></span> <span data-ttu-id="8c613-534">詳細については、「 [Azure Cloud Services での Azure 診断の有効化](/azure/cloud-services/cloud-services-dotnet-diagnostics/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-534">For more information, see [Enabling Azure Diagnostics in Azure Cloud Services](/azure/cloud-services/cloud-services-dotnet-diagnostics/).</span></span> <span data-ttu-id="8c613-535">総合的な "正常性モデル" を計画する方法の詳細については、「 [Failsafe: Guidance for Resilient Cloud Architectures (フェールセーフ: 回復力のあるクラウド アーキテクチャに関するガイダンス)](https://channel9.msdn.com/Series/FailSafe)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8c613-535">For a discussion of how to plan for an overall “health model,” see [Failsafe: Guidance for Resilient Cloud Architectures](https://channel9.msdn.com/Series/FailSafe).</span></span>

## <a name="disaster-simulation"></a><span data-ttu-id="8c613-536">障害のシミュレーション</span><span class="sxs-lookup"><span data-stu-id="8c613-536">Disaster simulation</span></span>
<span data-ttu-id="8c613-537">シミュレーション テストでは、作業現場で小規模な現実的状況を作成し、チーム メンバーがどのように反応するかを観察します。</span><span class="sxs-lookup"><span data-stu-id="8c613-537">Simulation testing involves creating small real-life situations on the work floor to observe how the team members react.</span></span> <span data-ttu-id="8c613-538">また、シミュレーションでは、復旧計画で示されているソリューションの有効性もわかります。</span><span class="sxs-lookup"><span data-stu-id="8c613-538">Simulations also show how effective the solutions are in the recovery plan.</span></span> <span data-ttu-id="8c613-539">作成されたシナリオが実際のビジネスを中断することなく、それでいて実際の状況に近いものになるように、シミュレーションを実行します。</span><span class="sxs-lookup"><span data-stu-id="8c613-539">Execute simulations so that the created scenarios don't disrupt actual business, while still feeling like real situations.</span></span>

<span data-ttu-id="8c613-540">手動で可用性の問題をシミュレートできるように、アプリケーションに一種の "スイッチボード" を組み込むことを検討します。</span><span class="sxs-lookup"><span data-stu-id="8c613-540">Consider architecting a type of “switchboard” in the application to manually simulate availability issues.</span></span> <span data-ttu-id="8c613-541">たとえば、ソフト スイッチを使用し、誤動作を発生させることにより、注文モジュールのデータベース アクセス例外をトリガーします。</span><span class="sxs-lookup"><span data-stu-id="8c613-541">For instance, through a soft switch, trigger database access exceptions for an ordering module by causing it to malfunction.</span></span> <span data-ttu-id="8c613-542">ネットワーク インターフェイス レベルで他のモジュールに対しても同様の簡単な方法を実施できます。</span><span class="sxs-lookup"><span data-stu-id="8c613-542">You can take similar lightweight approaches for other modules at the network interface level.</span></span>

<span data-ttu-id="8c613-543">シミュレーションでは、不適切に処理されたすべての問題が明確に示されます。</span><span class="sxs-lookup"><span data-stu-id="8c613-543">The simulation highlights any issues that were inadequately addressed.</span></span> <span data-ttu-id="8c613-544">シミュレートされるシナリオは、完全に制御できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-544">The simulated scenarios must be completely controllable.</span></span> <span data-ttu-id="8c613-545">つまり、復旧計画が失敗したと思われる場合でも、重大な損害を発生させずに状況を正常な状態に戻せる必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-545">This means that, even if the recovery plan seems to be failing, you can restore the situation back to normal without causing any significant damage.</span></span> <span data-ttu-id="8c613-546">また、シミュレーション訓練を実施するタイミングと方法を、上級管理者に通知することが重要です。</span><span class="sxs-lookup"><span data-stu-id="8c613-546">It’s also important that you inform higher-level management about when and how the simulation exercises will be executed.</span></span> <span data-ttu-id="8c613-547">この計画では、シミュレーション中に影響を受ける時刻またはリソースを具体的に示す必要があります。</span><span class="sxs-lookup"><span data-stu-id="8c613-547">This plan should detail the time or resources affected during the simulation.</span></span> <span data-ttu-id="8c613-548">また、ディザスター リカバリーをテストするときの成功の尺度も定義します。</span><span class="sxs-lookup"><span data-stu-id="8c613-548">Also define the measures of success when testing your disaster recovery plan.</span></span>

<span data-ttu-id="8c613-549">他にもいくつかの手法で、ディザスター リカバリー計画をテストできます。</span><span class="sxs-lookup"><span data-stu-id="8c613-549">Several other techniques can test disaster recovery plans.</span></span> <span data-ttu-id="8c613-550">ただし、そのほとんどは、これらの基本的な手法を単に変形させたものです。</span><span class="sxs-lookup"><span data-stu-id="8c613-550">However, most of them are simply variations of these basic techniques.</span></span> <span data-ttu-id="8c613-551">このテストの目的は、復旧計画の実現可能性を評価することにあります。</span><span class="sxs-lookup"><span data-stu-id="8c613-551">The intent of this testing is to evaluate the feasibility of the recovery plan.</span></span> <span data-ttu-id="8c613-552">ディザスター リカバリー テストでは、細部に注目して、基本的な復旧計画に不足している部分を発見します。</span><span class="sxs-lookup"><span data-stu-id="8c613-552">Disaster recovery testing focuses on the details to discover gaps in the basic recovery plan.</span></span>

## <a name="service-specific-guidance"></a><span data-ttu-id="8c613-553">サービス固有のガイダンス</span><span class="sxs-lookup"><span data-stu-id="8c613-553">Service-specific guidance</span></span>

<span data-ttu-id="8c613-554">次のトピックでは、ディザスター リカバリーに特化した Azure サービスについて説明します。</span><span class="sxs-lookup"><span data-stu-id="8c613-554">The following topics describe disaster recovery specific Azure services:</span></span>

| <span data-ttu-id="8c613-555">サービス</span><span class="sxs-lookup"><span data-stu-id="8c613-555">Service</span></span> | <span data-ttu-id="8c613-556">トピック</span><span class="sxs-lookup"><span data-stu-id="8c613-556">Topic</span></span> |
|---------|-------|
| <span data-ttu-id="8c613-557">Cloud Services</span><span class="sxs-lookup"><span data-stu-id="8c613-557">Cloud Services</span></span> | [<span data-ttu-id="8c613-558">Azure Cloud Services に影響を与える Azure サービスの中断が発生した場合の対処方法</span><span class="sxs-lookup"><span data-stu-id="8c613-558">What to do in the event of an Azure service disruption that impacts Azure Cloud Services</span></span>](/azure/cloud-services/cloud-services-disaster-recovery-guidance) |
| <span data-ttu-id="8c613-559">Key Vault</span><span class="sxs-lookup"><span data-stu-id="8c613-559">Key Vault</span></span> | [<span data-ttu-id="8c613-560">Azure Key Vault の可用性と冗長性</span><span class="sxs-lookup"><span data-stu-id="8c613-560">Azure Key Vault availability and redundancy</span></span>](/azure/key-vault/key-vault-disaster-recovery-guidance) |
|<span data-ttu-id="8c613-561">ストレージ</span><span class="sxs-lookup"><span data-stu-id="8c613-561">Storage</span></span> | [<span data-ttu-id="8c613-562">Azure Storage の停止が発生した場合の対処方法</span><span class="sxs-lookup"><span data-stu-id="8c613-562">What to do if an Azure Storage outage occurs</span></span>](/azure/storage/storage-disaster-recovery-guidance) |
| <span data-ttu-id="8c613-563">SQL Database</span><span class="sxs-lookup"><span data-stu-id="8c613-563">SQL Database</span></span> | [<span data-ttu-id="8c613-564">Azure SQL Database を復元する、またはセカンダリにフェールオーバーする</span><span class="sxs-lookup"><span data-stu-id="8c613-564">Restore an Azure SQL Database or failover to a secondary</span></span>](/azure/sql-database/sql-database-disaster-recovery) |
| <span data-ttu-id="8c613-565">仮想マシン</span><span class="sxs-lookup"><span data-stu-id="8c613-565">Virtual machines</span></span> | [<span data-ttu-id="8c613-566">Azure サービスの中断が Azure 仮想マシンに影響を与える場合の対処方法</span><span class="sxs-lookup"><span data-stu-id="8c613-566">What to do in the event that an Azure service disruption impacts Azure virtual machines</span></span>](/azure/virtual-machines/virtual-machines-disaster-recovery-guidance) |
| <span data-ttu-id="8c613-567">仮想ネットワーク</span><span class="sxs-lookup"><span data-stu-id="8c613-567">Virtual networks</span></span> | [<span data-ttu-id="8c613-568">Virtual Network – ビジネス継続性</span><span class="sxs-lookup"><span data-stu-id="8c613-568">Virtual Network – Business Continuity</span></span>](/azure/virtual-network/virtual-network-disaster-recovery-guidance) |


