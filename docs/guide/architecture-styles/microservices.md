---
title: "マイクロサービス アーキテクチャ スタイル"
description: "Azure のマイクロサービス アーキテクチャのメリット、課題、ベスト プラクティスを説明します"
author: MikeWasson
ms.openlocfilehash: 08fd39b6cf0b3c88af654b27e21b2d7dd9fb19b1
ms.sourcegitcommit: 7764a804f000180c37a4f8dbab946b525f784f58
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/09/2018
---
# <a name="microservices-architecture-style"></a><span data-ttu-id="38f67-103">マイクロサービス アーキテクチャ スタイル</span><span class="sxs-lookup"><span data-stu-id="38f67-103">Microservices architecture style</span></span>

<span data-ttu-id="38f67-104">マイクロサービス アーキテクチャは、小さな自律サービスのコレクションで構成されています。</span><span class="sxs-lookup"><span data-stu-id="38f67-104">A microservices architecture consists of a collection of small, autonomous services.</span></span> <span data-ttu-id="38f67-105">各サービスは自己完結型であり、1 つのビジネス機能を実装している必要があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-105">Each service is self-contained and should implement a single business capability.</span></span> <span data-ttu-id="38f67-106">Azure でのマイクロサービス アーキテクチャの構築に関する詳細なガイダンスいついては、「[Azure でのマイクロサービスの設計、構築、および操作](../../microservices/index.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="38f67-106">For detailed guidance about building a microservices architecture on Azure, see [Designing, building, and operating microservices on Azure](../../microservices/index.md).</span></span>

![](./images/microservices-logical.svg)
 
<span data-ttu-id="38f67-107">いくつかの点で、マイクロサービスはサービス指向アーキテクチャ (SOA) の自然な進化形と言えますが、マイクロサービスと SOA にはいくつかの違いがあります。</span><span class="sxs-lookup"><span data-stu-id="38f67-107">In some ways, microservices are the natural evolution of service oriented architectures (SOA), but there are differences between microservices and SOA.</span></span> <span data-ttu-id="38f67-108">次に、マイクロサービスの特徴を定義します。</span><span class="sxs-lookup"><span data-stu-id="38f67-108">Here are some defining characteristics of a microservice:</span></span>

- <span data-ttu-id="38f67-109">マイクロサービス アーキテクチャでは、サービスは小さく、独立的で、疎結合しています。</span><span class="sxs-lookup"><span data-stu-id="38f67-109">In a microservices architecture, services are small, independent, and loosely coupled.</span></span>

- <span data-ttu-id="38f67-110">各サービスは個別のコードベースであり、小規模な開発チームで管理できます。</span><span class="sxs-lookup"><span data-stu-id="38f67-110">Each service is a separate codebase, which can be managed by a small development team.</span></span>

- <span data-ttu-id="38f67-111">サービスは個別にデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="38f67-111">Services can be deployed independently.</span></span> <span data-ttu-id="38f67-112">チームは、アプリケーション全体を再構築したり再デプロイしたりすることなく、既存のサービスを更新できます。</span><span class="sxs-lookup"><span data-stu-id="38f67-112">A team can update an existing service without rebuilding and redeploying the entire application.</span></span>

- <span data-ttu-id="38f67-113">サービスはサービスのデータや外部の状態を保持する役割を担います。</span><span class="sxs-lookup"><span data-stu-id="38f67-113">Services are responsible for persisting their own data or external state.</span></span> <span data-ttu-id="38f67-114">これは、個別のデータ層でデータを保持する従来のモデルと異なる点です。</span><span class="sxs-lookup"><span data-stu-id="38f67-114">This differs from the traditional model, where a separate data layer handles data persistence.</span></span>

- <span data-ttu-id="38f67-115">サービスは、明確に定義された API を使用して、互いに通信します。</span><span class="sxs-lookup"><span data-stu-id="38f67-115">Services communicate with each other by using well-defined APIs.</span></span> <span data-ttu-id="38f67-116">各サービス内部の実装の詳細は、他のサービスに開示されません。</span><span class="sxs-lookup"><span data-stu-id="38f67-116">Internal implementation details of each service are hidden from other services.</span></span>

- <span data-ttu-id="38f67-117">サービスは、同じテクノロジ スタック、ライブラリ、またはフレームワークを共有する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="38f67-117">Services don't need to share the same technology stack, libraries, or frameworks.</span></span>

<span data-ttu-id="38f67-118">また、サービス自体については、いくつかの他のコンポーネントが次のような一般的なマイクロサービス アーキテクチャで使用されます。</span><span class="sxs-lookup"><span data-stu-id="38f67-118">Besides for the services themselves, some other components appear in a typical microservices architecture:</span></span>

<span data-ttu-id="38f67-119">**管理**。</span><span class="sxs-lookup"><span data-stu-id="38f67-119">**Management**.</span></span> <span data-ttu-id="38f67-120">管理コンポーネントは、ノードへのサービスの配置、障害の特定、ノード間のサービスの再調整などを行う役割を担います。</span><span class="sxs-lookup"><span data-stu-id="38f67-120">The management component is responsible for placing services on nodes, identifying failures, rebalancing services across nodes, and so forth.</span></span>  

<span data-ttu-id="38f67-121">**サービスの探索**。</span><span class="sxs-lookup"><span data-stu-id="38f67-121">**Service Discovery**.</span></span>  <span data-ttu-id="38f67-122">サービスのリストとサービスが配置されているノードを保持します。</span><span class="sxs-lookup"><span data-stu-id="38f67-122">Maintains a list of services and which nodes they are located on.</span></span> <span data-ttu-id="38f67-123">サービスがサービスのためにエンドポイントを探索できるようにします。</span><span class="sxs-lookup"><span data-stu-id="38f67-123">Enables service lookup to find the endpoint for a service.</span></span> 

<span data-ttu-id="38f67-124">**API ゲートウェイ**。</span><span class="sxs-lookup"><span data-stu-id="38f67-124">**API Gateway**.</span></span> <span data-ttu-id="38f67-125">API ゲートウェイは、クライアントのエントリ ポイントです。</span><span class="sxs-lookup"><span data-stu-id="38f67-125">The API gateway is the entry point for clients.</span></span> <span data-ttu-id="38f67-126">クライアントは直接サービスを呼び出すことはしません。</span><span class="sxs-lookup"><span data-stu-id="38f67-126">Clients don't call services directly.</span></span> <span data-ttu-id="38f67-127">代わりに API ゲートウェイを呼び出し、その呼び出しをバック エンドの適切なサービスに転送します。</span><span class="sxs-lookup"><span data-stu-id="38f67-127">Instead, they call the API gateway, which forwards the call to the appropriate services on the back end.</span></span> <span data-ttu-id="38f67-128">API ゲートウェイは、複数のサービスからの応答を集計して、集計された応答を返すことがあります。</span><span class="sxs-lookup"><span data-stu-id="38f67-128">The API gateway might aggregate the responses from several services and return the aggregated response.</span></span> 

<span data-ttu-id="38f67-129">API ゲートウェイを使用することには次のようなメリットがあります。</span><span class="sxs-lookup"><span data-stu-id="38f67-129">The advantages of using an API gateway include:</span></span>

- <span data-ttu-id="38f67-130">サービスからクライアントを切り離します。</span><span class="sxs-lookup"><span data-stu-id="38f67-130">It decouples clients from services.</span></span> <span data-ttu-id="38f67-131">サービスのバージョン管理とリファクタリングを、すべてのクライアントを更新する必要なく行うことができます。</span><span class="sxs-lookup"><span data-stu-id="38f67-131">Services can be versioned or refactored without needing to update all of the clients.</span></span>

-  <span data-ttu-id="38f67-132">サービスは、AMQP などの Web フレンドリではないメッセージング プロトコルを使用できます。</span><span class="sxs-lookup"><span data-stu-id="38f67-132">Services can use messaging protocols that are not web friendly, such as AMQP.</span></span>

- <span data-ttu-id="38f67-133">API ゲートウェイは、認証、ログ記録、SSL 終了、負荷分散などの他の横断的な関数を実行できます。</span><span class="sxs-lookup"><span data-stu-id="38f67-133">The API Gateway can perform other cross-cutting functions such as authentication, logging, SSL termination, and load balancing.</span></span>

## <a name="when-to-use-this-architecture"></a><span data-ttu-id="38f67-134">このアーキテクチャを使用する状況</span><span class="sxs-lookup"><span data-stu-id="38f67-134">When to use this architecture</span></span>

<span data-ttu-id="38f67-135">次の場合に、このアーキテクチャ スタイルを検討してください。</span><span class="sxs-lookup"><span data-stu-id="38f67-135">Consider this architecture style for:</span></span>

- <span data-ttu-id="38f67-136">リリースの早さが要求される大規模アプリケーション。</span><span class="sxs-lookup"><span data-stu-id="38f67-136">Large applications that require a high release velocity.</span></span>

- <span data-ttu-id="38f67-137">高い拡張性が必要とされる複雑なアプリケーション。</span><span class="sxs-lookup"><span data-stu-id="38f67-137">Complex applications that need to be highly scalable.</span></span>

- <span data-ttu-id="38f67-138">ドメインが豊富な、またはサブドメインが多いアプリケーション。</span><span class="sxs-lookup"><span data-stu-id="38f67-138">Applications with rich domains or many subdomains.</span></span>

- <span data-ttu-id="38f67-139">小規模な開発チームから構成されている組織。</span><span class="sxs-lookup"><span data-stu-id="38f67-139">An organization that consists of small development teams.</span></span>


## <a name="benefits"></a><span data-ttu-id="38f67-140">メリット</span><span class="sxs-lookup"><span data-stu-id="38f67-140">Benefits</span></span> 

- <span data-ttu-id="38f67-141">**独立したデプロイ**。</span><span class="sxs-lookup"><span data-stu-id="38f67-141">**Independent deployments**.</span></span> <span data-ttu-id="38f67-142">アプリケーション全体を再デプロイしなくてもサービスを更新できたり、問題が生じた場合に更新プログラムをロールバックまたはロールフォワードできたりします。</span><span class="sxs-lookup"><span data-stu-id="38f67-142">You can update a service without redeploying the entire application, and roll back or roll forward an update if something goes wrong.</span></span> <span data-ttu-id="38f67-143">バグ修正プログラムと機能のリリースがより管理しやすく、リスクが低くなります。</span><span class="sxs-lookup"><span data-stu-id="38f67-143">Bug fixes and feature releases are more manageable and less risky.</span></span>

- <span data-ttu-id="38f67-144">**独立した開発**。</span><span class="sxs-lookup"><span data-stu-id="38f67-144">**Independent development**.</span></span> <span data-ttu-id="38f67-145">1 つの開発チームでサービスのビルド、テスト、デプロイが可能です。</span><span class="sxs-lookup"><span data-stu-id="38f67-145">A single development team can build, test, and deploy a service.</span></span> <span data-ttu-id="38f67-146">その結果、イノベーションを継続し、より早い周期でリリースが可能になります。</span><span class="sxs-lookup"><span data-stu-id="38f67-146">The result is continuous innovation and a faster release cadence.</span></span> 

- <span data-ttu-id="38f67-147">**集中的な小規模チーム**。</span><span class="sxs-lookup"><span data-stu-id="38f67-147">**Small, focused teams**.</span></span> <span data-ttu-id="38f67-148">チームは 1 つのサービスに専念できます。</span><span class="sxs-lookup"><span data-stu-id="38f67-148">Teams can focus on one service.</span></span> <span data-ttu-id="38f67-149">各サービスの範囲が狭いことでコード ベースが理解しやすく、新しいチーム メンバーを増員しやすくなります。</span><span class="sxs-lookup"><span data-stu-id="38f67-149">The smaller scope of each service makes the code base easier to understand, and it's easier for new team members to ramp up.</span></span>

- <span data-ttu-id="38f67-150">**障害の分離**。</span><span class="sxs-lookup"><span data-stu-id="38f67-150">**Fault isolation**.</span></span> <span data-ttu-id="38f67-151">サービスがダウンしても、アプリケーション全体を停止することはありません。</span><span class="sxs-lookup"><span data-stu-id="38f67-151">If a service goes down, it won't take out the entire application.</span></span> <span data-ttu-id="38f67-152">ただし、無料で回復性を得られるという意味ではありません。</span><span class="sxs-lookup"><span data-stu-id="38f67-152">However, that doesn't mean you get resiliency for free.</span></span> <span data-ttu-id="38f67-153">回復性のベスト プラクティスと設計パターンに従う必要があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-153">You still need to follow resiliency best practices and design patterns.</span></span> <span data-ttu-id="38f67-154">「[Designing resilient applications for Azure (回復性に優れた Azure 用アプリケーションの設計)][resiliency-overview]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="38f67-154">See [Designing resilient applications for Azure][resiliency-overview].</span></span>

- <span data-ttu-id="38f67-155">**混在テクノロジ スタック**。</span><span class="sxs-lookup"><span data-stu-id="38f67-155">**Mixed technology stacks**.</span></span> <span data-ttu-id="38f67-156">チームは、自分たちのサービスに最適なテクノロジを選択できます。</span><span class="sxs-lookup"><span data-stu-id="38f67-156">Teams can pick the technology that best fits their service.</span></span> 

- <span data-ttu-id="38f67-157">**詳細なスケーリング**。</span><span class="sxs-lookup"><span data-stu-id="38f67-157">**Granular scaling**.</span></span> <span data-ttu-id="38f67-158">サービスは個別にスケールできます。</span><span class="sxs-lookup"><span data-stu-id="38f67-158">Services can be scaled independently.</span></span> <span data-ttu-id="38f67-159">同時に、VM あたりのサービスの密度が高いということは、VM リソースがフルに活用されるということです。</span><span class="sxs-lookup"><span data-stu-id="38f67-159">At the same time, the higher density of services per VM means that VM resources are fully utilized.</span></span> <span data-ttu-id="38f67-160">配置の制約を使用して、サービスを VM プロファイル (高 CPU、ハイ メモリなど) に合わせることができます。</span><span class="sxs-lookup"><span data-stu-id="38f67-160">Using placement constraints, a services can be matched to a VM profile (high CPU, high memory, and so on).</span></span>

## <a name="challenges"></a><span data-ttu-id="38f67-161">課題</span><span class="sxs-lookup"><span data-stu-id="38f67-161">Challenges</span></span>

- <span data-ttu-id="38f67-162">**複雑さ**。</span><span class="sxs-lookup"><span data-stu-id="38f67-162">**Complexity**.</span></span> <span data-ttu-id="38f67-163">マイクロサービス アプリケーションは、同等のモノリシック アプリケーションよりも多くの動的パーツで構成されています。</span><span class="sxs-lookup"><span data-stu-id="38f67-163">A microservices application has more moving parts than the equivalent monolithic application.</span></span> <span data-ttu-id="38f67-164">各サービスはより単純ですが、システム全体としてはより複雑です。</span><span class="sxs-lookup"><span data-stu-id="38f67-164">Each service is simpler, but the entire system as a whole is more complex.</span></span>

- <span data-ttu-id="38f67-165">**開発とテスト**。</span><span class="sxs-lookup"><span data-stu-id="38f67-165">**Development and test**.</span></span> <span data-ttu-id="38f67-166">サービスの依存関係に対する開発では、別のアプローチが必要です。</span><span class="sxs-lookup"><span data-stu-id="38f67-166">Developing against service dependencies requires a different approach.</span></span> <span data-ttu-id="38f67-167">既存のツールは、必ずしもサービスの依存関係を処理するようには設計されていません。</span><span class="sxs-lookup"><span data-stu-id="38f67-167">Existing tools are not necessarily designed to work with service dependencies.</span></span> <span data-ttu-id="38f67-168">サービス間の境界にまたがってリファクタリングを行うことは困難です。</span><span class="sxs-lookup"><span data-stu-id="38f67-168">Refactoring across service boundaries can be difficult.</span></span> <span data-ttu-id="38f67-169">また、アプリケーションの進化が早い場合は特に、サービスの依存関係をテストすることは困難です。</span><span class="sxs-lookup"><span data-stu-id="38f67-169">It is also challenging to test service dependencies, especially when the application is evolving quickly.</span></span>

- <span data-ttu-id="38f67-170">**ガバナンスの欠如**。</span><span class="sxs-lookup"><span data-stu-id="38f67-170">**Lack of governance**.</span></span> <span data-ttu-id="38f67-171">マイクロサービスを構築する際に分散アプローチをとることにはメリットがありますが、問題が発生しやすくもなります。</span><span class="sxs-lookup"><span data-stu-id="38f67-171">The decentralized approach to building microservices has advantages, but it can also lead to problems.</span></span> <span data-ttu-id="38f67-172">多くの異なる言語やフレームワークを使用するために、アプリケーションの維持が難しくなることがあります。</span><span class="sxs-lookup"><span data-stu-id="38f67-172">You may end up with so many different languages and frameworks that the application becomes hard to maintain.</span></span> <span data-ttu-id="38f67-173">プロジェクト全体に適用される標準を導入する方が役立ち、チームの柔軟性を過度に制限せずに済むということもあります。</span><span class="sxs-lookup"><span data-stu-id="38f67-173">It may be useful to put some project-wide standards in place, without overly restricting teams' flexibility.</span></span> <span data-ttu-id="38f67-174">これは特に、ログ記録などの横断的な機能に適用されます。</span><span class="sxs-lookup"><span data-stu-id="38f67-174">This especially applies to cross-cutting functionality such as logging.</span></span>

- <span data-ttu-id="38f67-175">**ネットワークの輻輳と待機時間**。</span><span class="sxs-lookup"><span data-stu-id="38f67-175">**Network congestion and latency**.</span></span> <span data-ttu-id="38f67-176">多くの小さく細分化されたサービスを使用すると、よりインタラクティブな通信が可能になります。</span><span class="sxs-lookup"><span data-stu-id="38f67-176">The use of many small, granular services can result in more interservice communication.</span></span> <span data-ttu-id="38f67-177">また、サービスの依存関係のチェーンが長すぎる (サービス A が B を呼び出し、その B が C を呼び出すなどの) 場合、追加される待機時間が問題になることがあります。</span><span class="sxs-lookup"><span data-stu-id="38f67-177">Also, if the chain of service dependencies gets too long (service A calls B, which calls C...), the additional latency can become a problem.</span></span> <span data-ttu-id="38f67-178">API は慎重に設計する必要があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-178">You will need to design APIs carefully.</span></span> <span data-ttu-id="38f67-179">API を過度に使用することを避け、シリアル化形式について検討し、非同期通信パターンを使用する場所を探してください。</span><span class="sxs-lookup"><span data-stu-id="38f67-179">Avoid overly chatty APIs, think about serialization formats, and look for places to use asynchronous communication patterns.</span></span>

- <span data-ttu-id="38f67-180">**データ整合性**。</span><span class="sxs-lookup"><span data-stu-id="38f67-180">**Data integrity**.</span></span> <span data-ttu-id="38f67-181">独自のデータを永続化する各マイクロサービスを使用します。</span><span class="sxs-lookup"><span data-stu-id="38f67-181">With each microservice responsible for its own data persistence.</span></span> <span data-ttu-id="38f67-182">結果として、データの整合性をとることが難しくなることがあります。</span><span class="sxs-lookup"><span data-stu-id="38f67-182">As a result, data consistency can be a challenge.</span></span> <span data-ttu-id="38f67-183">可能であれば、最終的な整合性を優先します。</span><span class="sxs-lookup"><span data-stu-id="38f67-183">Embrace eventual consistency where possible.</span></span>

- <span data-ttu-id="38f67-184">**管理**。</span><span class="sxs-lookup"><span data-stu-id="38f67-184">**Management**.</span></span> <span data-ttu-id="38f67-185">マイクロサービスを成功させるには、成熟した DevOps カルチャが必要です。</span><span class="sxs-lookup"><span data-stu-id="38f67-185">To be successful with microservices requires a mature DevOps culture.</span></span> <span data-ttu-id="38f67-186">サービス間で相互に関連付けられたログを記録することは難しい場合があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-186">Correlated logging across services can be challenging.</span></span> <span data-ttu-id="38f67-187">通常、ログ記録は単一のユーザー操作を要求するために複数のサービスの呼び出しを関連付ける必要があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-187">Typically, logging must correlate multiple service calls for a single user operation.</span></span>

- <span data-ttu-id="38f67-188">**バージョン管理**。</span><span class="sxs-lookup"><span data-stu-id="38f67-188">**Versioning**.</span></span> <span data-ttu-id="38f67-189">サービスの更新プログラムは、依存しているサービスを中断してはいけません。</span><span class="sxs-lookup"><span data-stu-id="38f67-189">Updates to a service must not break services that depend on it.</span></span> <span data-ttu-id="38f67-190">複数のサービスが特定の時点で更新される場合があるため、慎重に設計しないと下位互換性または上位互換性に問題が生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-190">Multiple services could be updated at any given time, so without careful design, you might have problems with backward or forward compatibility.</span></span>

- <span data-ttu-id="38f67-191">**スキルセット**。</span><span class="sxs-lookup"><span data-stu-id="38f67-191">**Skillset**.</span></span> <span data-ttu-id="38f67-192">マイクロサービスは高度な分散システムです。</span><span class="sxs-lookup"><span data-stu-id="38f67-192">Microservices are highly distributed systems.</span></span> <span data-ttu-id="38f67-193">成功のために必要なスキルと経験がチームにあるかどうかを慎重に評価してください。</span><span class="sxs-lookup"><span data-stu-id="38f67-193">Carefully evaluate whether the team has the skills and experience to be successful.</span></span>

## <a name="best-practices"></a><span data-ttu-id="38f67-194">ベスト プラクティス</span><span class="sxs-lookup"><span data-stu-id="38f67-194">Best practices</span></span>

- <span data-ttu-id="38f67-195">ビジネス分野周辺のモデル サービス。</span><span class="sxs-lookup"><span data-stu-id="38f67-195">Model services around the business domain.</span></span> 

- <span data-ttu-id="38f67-196">すべてを分散化します。</span><span class="sxs-lookup"><span data-stu-id="38f67-196">Decentralize everything.</span></span> <span data-ttu-id="38f67-197">個々のチームがサービスの設計と構築を担います。</span><span class="sxs-lookup"><span data-stu-id="38f67-197">Individual teams are responsible for designing and building services.</span></span> <span data-ttu-id="38f67-198">コードまたはデータのスキーマを共有しないようにします。</span><span class="sxs-lookup"><span data-stu-id="38f67-198">Avoid sharing code or data schemas.</span></span> 

- <span data-ttu-id="38f67-199">データ ストレージは、そのデータを所有するサービス専用にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-199">Data storage should be private to the service that owns the data.</span></span> <span data-ttu-id="38f67-200">各サービスとデータの種類に最適なストレージを使用します。</span><span class="sxs-lookup"><span data-stu-id="38f67-200">Use the best storage for each service and data type.</span></span> 

- <span data-ttu-id="38f67-201">サービスが、適切に設計された API を介して通信するようにします。</span><span class="sxs-lookup"><span data-stu-id="38f67-201">Services communicate through well-designed APIs.</span></span> <span data-ttu-id="38f67-202">実装の詳細が漏えいしないようにします。</span><span class="sxs-lookup"><span data-stu-id="38f67-202">Avoid leaking implementation details.</span></span> <span data-ttu-id="38f67-203">API は、サービス内部の実装ではなく、ドメインをモデル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-203">APIs should model the domain, not the internal implementation of the service.</span></span>

- <span data-ttu-id="38f67-204">サービス間の結合は行わないようにします。</span><span class="sxs-lookup"><span data-stu-id="38f67-204">Avoid coupling between services.</span></span> <span data-ttu-id="38f67-205">結合の原因には、共有データベース スキーマや固定の通信プロトコルなどがあります。</span><span class="sxs-lookup"><span data-stu-id="38f67-205">Causes of coupling include shared database schemas and rigid communication protocols.</span></span>

- <span data-ttu-id="38f67-206">認証や SSL 終了などの横断的な懸念事項をゲートウェイにオフロードします。</span><span class="sxs-lookup"><span data-stu-id="38f67-206">Offload cross-cutting concerns, such as authentication and SSL termination, to the gateway.</span></span>

- <span data-ttu-id="38f67-207">ドメインのナレッジをゲートウェイの外部で保持します。</span><span class="sxs-lookup"><span data-stu-id="38f67-207">Keep domain knowledge out of the gateway.</span></span> <span data-ttu-id="38f67-208">ゲートウェイは、ビジネス ルールやドメイン ロジックのナレッジを使用せずに、クライアントの要求を処理し、ルーティングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-208">The gateway should handle and route client requests without any knowledge of the business rules or domain logic.</span></span> <span data-ttu-id="38f67-209">そうしなければ、ゲートウェイが依存関係となり、サービス間の結合が生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-209">Otherwise, the gateway becomes a dependency and can cause coupling between services.</span></span>

- <span data-ttu-id="38f67-210">サービスには、疎結合と機能の高い凝集度が必要です。</span><span class="sxs-lookup"><span data-stu-id="38f67-210">Services should have loose coupling and high functional cohesion.</span></span> <span data-ttu-id="38f67-211">まとめて変更される可能性がある機能は、まとめてパッケージ化してデプロイする必要があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-211">Functions that are likely to change together should be packaged and deployed together.</span></span> <span data-ttu-id="38f67-212">それらの機能が別々のサービスに格納された場合、1 つのサービスの変更には他のサービスの更新が必要であるため、結果として密接に結合されることになります。</span><span class="sxs-lookup"><span data-stu-id="38f67-212">If they reside in separate services, those services end up being tightly coupled, because a change in one service will require updating the other service.</span></span> <span data-ttu-id="38f67-213">2 つのサービス間で過度に通信が行われると、密接な結合と低い凝集度の問題が生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-213">Overly chatty communication between two services may be a symptom of tight coupling and low cohesion.</span></span> 

- <span data-ttu-id="38f67-214">障害を分離します。</span><span class="sxs-lookup"><span data-stu-id="38f67-214">Isolate failures.</span></span> <span data-ttu-id="38f67-215">回復性戦略を使用して、サービス内の障害が連鎖しないようにします。</span><span class="sxs-lookup"><span data-stu-id="38f67-215">Use resiliency strategies to prevent failures within a service from cascading.</span></span> <span data-ttu-id="38f67-216">「[Resiliency patterns (回復性パターン)][resiliency-patterns]」と「[Designing resilient applications (回復性に優れたアプリケーションの設計)][resiliency-overview]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="38f67-216">See [Resiliency patterns][resiliency-patterns] and [Designing resilient applications][resiliency-overview].</span></span>

## <a name="microservices-using-azure-container-service"></a><span data-ttu-id="38f67-217">Azure Container Service を使用したマイクロサービス</span><span class="sxs-lookup"><span data-stu-id="38f67-217">Microservices using Azure Container Service</span></span> 

<span data-ttu-id="38f67-218">[Azure Container Service](/azure/container-service/) を使用して、Docker クラスターを構成およびプロビジョニングできます。</span><span class="sxs-lookup"><span data-stu-id="38f67-218">You can use [Azure Container Service](/azure/container-service/) to configure and provision a Docker cluster.</span></span> <span data-ttu-id="38f67-219">Azure Container Service では、Kubernetes、DC/OS、Docker Swarm などのよく利用されているコンテナー オーケストレーターがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="38f67-219">Azure Container Services supports several popular container orchestrators, including Kubernetes, DC/OS, and Docker Swarm.</span></span>

![](./images/microservices-acs.png)
 
<span data-ttu-id="38f67-220">**公開ノード**。</span><span class="sxs-lookup"><span data-stu-id="38f67-220">**Public nodes**.</span></span> <span data-ttu-id="38f67-221">公開ノードには、公開されたロード バランサーを使用してアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="38f67-221">These nodes are reachable through a public-facing load balancer.</span></span> <span data-ttu-id="38f67-222">API ゲートウェイは公開ノードでホストされます。</span><span class="sxs-lookup"><span data-stu-id="38f67-222">The API gateway is hosted on these nodes.</span></span>

<span data-ttu-id="38f67-223">**バックエンド ノード**。</span><span class="sxs-lookup"><span data-stu-id="38f67-223">**Backend nodes**.</span></span> <span data-ttu-id="38f67-224">バックエンド ノードは、クライアントが API ゲートウェイを経由してアクセスするサービスを実行します。</span><span class="sxs-lookup"><span data-stu-id="38f67-224">These nodes run services that clients reach via the API gateway.</span></span> <span data-ttu-id="38f67-225">バックエンド ノードは、インターネット トラフィックを直接は受信しません。</span><span class="sxs-lookup"><span data-stu-id="38f67-225">These nodes don't receive Internet traffic directly.</span></span> <span data-ttu-id="38f67-226">バックエンド ノードには、VM の 1 つ以上のプールが、それぞれ異なるハードウェア プロファイルとともに含まれる場合があります。</span><span class="sxs-lookup"><span data-stu-id="38f67-226">The backend nodes might include more than one pool of VMs, each with a different hardware profile.</span></span> <span data-ttu-id="38f67-227">たとえば、一般的なコンピューティング ワークロード、高 CPU ワークロード、ハイ メモリ ワークロードについて個別のプールを作成できます。</span><span class="sxs-lookup"><span data-stu-id="38f67-227">For example, you could create separate pools for general compute workloads, high CPU workloads, and high memory workloads.</span></span> 

<span data-ttu-id="38f67-228">**管理 VM**。</span><span class="sxs-lookup"><span data-stu-id="38f67-228">**Management VMs**.</span></span> <span data-ttu-id="38f67-229">管理 VM は、コンテナー オーケストレーター用のマスター ノードを実行します。</span><span class="sxs-lookup"><span data-stu-id="38f67-229">These VMs run the master nodes for the container orchestrator.</span></span> 

<span data-ttu-id="38f67-230">**ネットワーク**。</span><span class="sxs-lookup"><span data-stu-id="38f67-230">**Networking**.</span></span> <span data-ttu-id="38f67-231">公開ノード、バックエンド ノード、管理 VM は、同じ仮想ネットワーク (VNet) 内の別のサブネットに配置されます。</span><span class="sxs-lookup"><span data-stu-id="38f67-231">The public nodes, backend nodes, and management VMs are placed in separate subnets within the same virtual network (VNet).</span></span> 

<span data-ttu-id="38f67-232">**ロード バランサー**。</span><span class="sxs-lookup"><span data-stu-id="38f67-232">**Load balancers**.</span></span>  <span data-ttu-id="38f67-233">外部に公開されたロード バランサーは、公開ノードの前に配置されます。</span><span class="sxs-lookup"><span data-stu-id="38f67-233">An externally facing load balancer sits in front of the public nodes.</span></span> <span data-ttu-id="38f67-234">ロード バランサーは公開ノードにインターネット要求を配分します。</span><span class="sxs-lookup"><span data-stu-id="38f67-234">It distributes internet requests to the public nodes.</span></span> <span data-ttu-id="38f67-235">別のロード バランサーは管理 VM の前に配置され、NAT ルールを使用して管理 VM への Secure Shell (ssh) トラフィックを許可します。</span><span class="sxs-lookup"><span data-stu-id="38f67-235">Another load balancer is placed in front of the management VMs, to allow secure shell (ssh) traffic to the management VMs, using NAT rules.</span></span>

<span data-ttu-id="38f67-236">信頼性と拡張性を確保するため、各サービスは複数の VM 間でレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="38f67-236">For reliability and scalability, each service is replicated across multiple VMs.</span></span> <span data-ttu-id="38f67-237">ただし、サービスは (モノリシック アプリケーションと比較して) 比較的軽量でもあるため、複数のサービスは通常 1 つの VM にまとめられます。</span><span class="sxs-lookup"><span data-stu-id="38f67-237">However, because services are also relatively lightweight (compared with a monolithic application), multiple services are usually packed into a single VM.</span></span> <span data-ttu-id="38f67-238">密度が高いことで、リソース使用率が向上します。</span><span class="sxs-lookup"><span data-stu-id="38f67-238">Higher density allows better resource utilization.</span></span> <span data-ttu-id="38f67-239">特定のサービスが多くのリソースを使用しない場合、そのサービスの実行に VM 全体を専念させる必要はありません。</span><span class="sxs-lookup"><span data-stu-id="38f67-239">If a particular service doesn't use a lot of resources, you don't need to dedicate an entire VM to running that service.</span></span>

<span data-ttu-id="38f67-240">次の図は、4 つの異なるサービスを実行する 3 つのノードを示しています (異なる形で示されています)。</span><span class="sxs-lookup"><span data-stu-id="38f67-240">The following diagram shows three nodes running four different services (indicated by different shapes).</span></span> <span data-ttu-id="38f67-241">各サービスは少なくとも 2 つのインスタンスを持っていることに注目してください。</span><span class="sxs-lookup"><span data-stu-id="38f67-241">Notice that each service has at least two instances.</span></span> 
 
![](./images/microservices-node-density.png)

## <a name="microservices-using-azure-service-fabric"></a><span data-ttu-id="38f67-242">Azure Service Fabric を使用したマイクロサービス</span><span class="sxs-lookup"><span data-stu-id="38f67-242">Microservices using Azure Service Fabric</span></span>

<span data-ttu-id="38f67-243">次の図は、[Azure Service Fabric](/azure/service-fabric/) を使用したマイクロサービス アーキテクチャを示しています。</span><span class="sxs-lookup"><span data-stu-id="38f67-243">The following diagram shows a microservices architecture using [Azure Service Fabric](/azure/service-fabric/).</span></span>

![](./images/service-fabric.png)

<span data-ttu-id="38f67-244">Service Fabric クラスターは、1 つ以上の VM スケール セットにデプロイされます。</span><span class="sxs-lookup"><span data-stu-id="38f67-244">The Service Fabric cluster is deployed to one or more VM scale sets.</span></span> <span data-ttu-id="38f67-245">さまざまな VM の種類を混在させるために、クラスター内に 1 つ以上の VM スケール セットがある場合もあります。</span><span class="sxs-lookup"><span data-stu-id="38f67-245">You might have more than one VM scale set in the cluster, in order to have a mix of VM types.</span></span> <span data-ttu-id="38f67-246">API ゲートウェイは、クライアント要求を受信する外部のロード バランサーとともに、Service Fabric クラスターの前に配置されます。</span><span class="sxs-lookup"><span data-stu-id="38f67-246">An API Gateway is placed in front of the Service Fabric cluster, with an external load balancer to receive client requests.</span></span>

<span data-ttu-id="38f67-247">Service Fabric ランタイムは、サービスの配置、ノードのフェールオーバー、正常性の監視などのクラスター管理を実行します。</span><span class="sxs-lookup"><span data-stu-id="38f67-247">The Service Fabric runtime performs cluster management, including service placement, node failover, and health monitoring.</span></span> <span data-ttu-id="38f67-248">このランタイムは、クラスター ノード自体にデプロイされます。</span><span class="sxs-lookup"><span data-stu-id="38f67-248">The runtime is deployed on the cluster nodes themselves.</span></span> <span data-ttu-id="38f67-249">個別のクラスター管理 VM のセットはありません。</span><span class="sxs-lookup"><span data-stu-id="38f67-249">There isn't a separate set of cluster management VMs.</span></span>

<span data-ttu-id="38f67-250">サービスは、Service Fabric に組み込まれているリバース プロキシを使用して、相互に通信します。</span><span class="sxs-lookup"><span data-stu-id="38f67-250">Services communicate with each other using the reverse proxy that is built into Service Fabric.</span></span> <span data-ttu-id="38f67-251">Service Fabric は、名前付きサービスのエンドポイントを解決できる探索サービスを提供します。</span><span class="sxs-lookup"><span data-stu-id="38f67-251">Service Fabric provides a discovery service that can resolve the endpoint for a named service.</span></span>


<!-- links -->

[resiliency-overview]: ../../resiliency/index.md
[resiliency-patterns]: ../../patterns/category/resiliency.md



