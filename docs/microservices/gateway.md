---
title: "API ゲートウェイ"
description: "マイクロサービスでの API ゲートウェイ"
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: 6483d416363e24f4084d6b856847a740bf4054d9
ms.sourcegitcommit: a8453c4bc7c870fa1a12bb3c02e3b310db87530c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/29/2017
---
# <a name="designing-microservices-api-gateways"></a><span data-ttu-id="86358-103">マイクロサービスの設計: API ゲートウェイ</span><span class="sxs-lookup"><span data-stu-id="86358-103">Designing microservices: API gateways</span></span>

<span data-ttu-id="86358-104">マイクロサービス アーキテクチャでは、クライアントは、1 つ以上のフロント エンド サービスと対話する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="86358-104">In a microservices architecture, a client might interact with more than one front-end service.</span></span> <span data-ttu-id="86358-105">この事実を前提として、クライアントは、呼び出し先のエンドポイントをどのような方法で知るのでしょうか。</span><span class="sxs-lookup"><span data-stu-id="86358-105">Given this fact, how does a client know what endpoints to call?</span></span> <span data-ttu-id="86358-106">新しいサービスが導入されたり、既存のサービスがリファクタリングされた場合は何が起こるのでしょうか。</span><span class="sxs-lookup"><span data-stu-id="86358-106">What happens when new services are introduced, or existing services are refactored?</span></span> <span data-ttu-id="86358-107">サービスは、SSL 終了、認証、およびその他の問題をどのように処理するのでしょうか。</span><span class="sxs-lookup"><span data-stu-id="86358-107">How do services handle SSL termination, authentication, and other concerns?</span></span> <span data-ttu-id="86358-108">"*API ゲートウェイ*" は、これらの課題に対処するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="86358-108">An *API gateway* can help to address these challenges.</span></span> 

![](./images/gateway.png)

## <a name="what-is-an-api-gateway"></a><span data-ttu-id="86358-109">API ゲートウェイとは</span><span class="sxs-lookup"><span data-stu-id="86358-109">What is an API gateway?</span></span>

<span data-ttu-id="86358-110">API ゲートウェイは、クライアントとサービスの間に位置します。</span><span class="sxs-lookup"><span data-stu-id="86358-110">An API gateway sits between clients and services.</span></span> <span data-ttu-id="86358-111">それは、要求をクライアントからサービスにルーティングするリバース プロキシとして機能します。</span><span class="sxs-lookup"><span data-stu-id="86358-111">It acts as a reverse proxy, routing requests from clients to services.</span></span> <span data-ttu-id="86358-112">さらに、認証、SSL 終了、レート制限などのさまざまな横断的タスクを実行できます。</span><span class="sxs-lookup"><span data-stu-id="86358-112">It may also perform various cross-cutting tasks such as authentication, SSL termination, and rate limiting.</span></span> <span data-ttu-id="86358-113">ゲートウェイをデプロイしない場合、クライアントは、フロント エンド サービスに直接要求を送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="86358-113">If you don't deploy a gateway, clients must send requests directly to front-end services.</span></span> <span data-ttu-id="86358-114">ただし、クライアントにサービスを直接公開することには潜在的な問題があります。</span><span class="sxs-lookup"><span data-stu-id="86358-114">However, there are some potential problems with exposing services directly to clients:</span></span>

- <span data-ttu-id="86358-115">クライアント コードが複雑になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="86358-115">It can result in complex client code.</span></span> <span data-ttu-id="86358-116">クライアントは、複数のエンドポイントを追跡し、回復力のある方法でエラーを処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="86358-116">The client must keep track of multiple endpoints, and handle failures in a resilient way.</span></span> 
- <span data-ttu-id="86358-117">クライアントとバックエンド間の結合が作成されます。</span><span class="sxs-lookup"><span data-stu-id="86358-117">It creates coupling between the client and the backend.</span></span> <span data-ttu-id="86358-118">クライアントは、個々のサービスを分解する方法を知る必要があります。</span><span class="sxs-lookup"><span data-stu-id="86358-118">The client needs to know how the individual services are decomposed.</span></span> <span data-ttu-id="86358-119">これにより、クライアントの管理がますます困難になり、同時にサービスのリファクターも難しくなります。</span><span class="sxs-lookup"><span data-stu-id="86358-119">That makes it harder to maintain the client and also harder to refactor services.</span></span>
- <span data-ttu-id="86358-120">単一の操作で、複数のサービスの呼び出しが必要な場合があります。</span><span class="sxs-lookup"><span data-stu-id="86358-120">A single operation might require calls to multiple services.</span></span> <span data-ttu-id="86358-121">これにより、クライアントとサーバー間で複数のネットワーク ラウンド トリップが発生し、待機時間が大幅に長くなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="86358-121">That can result in multiple network round trips between the client and the server, adding significant latency.</span></span> 
- <span data-ttu-id="86358-122">各公開サービスで、認証、SSL、クライアントのレート制限などの問題を処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="86358-122">Each public-facing service must handle concerns such as authentication, SSL, and client rate limiting.</span></span> 
- <span data-ttu-id="86358-123">サービスは、HTTP や WebSocket などのクライアントに適したプロトコルを公開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="86358-123">Services must expose a client-friendly protocol such as HTTP or WebSocket.</span></span> <span data-ttu-id="86358-124">これにより、[通信プロトコル](./interservice-communication.md)の選択肢が制限されます。</span><span class="sxs-lookup"><span data-stu-id="86358-124">This limits the choice of [communication protocols](./interservice-communication.md).</span></span> 
- <span data-ttu-id="86358-125">パブリック エンドポイントを使用するサービスは潜在的な攻撃対象であるため、セキュリティで保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="86358-125">Services with public endpoints are a potential attack surface, and must be hardened.</span></span>

<span data-ttu-id="86358-126">ゲートウェイは、サービスからクライアントを分離することによって、これらの問題に対処するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="86358-126">A gateway helps to address these issues by decoupling clients from services.</span></span> <span data-ttu-id="86358-127">ゲートウェイは、多数の異なる機能を実行できますが、そのすべてが必要であるわけではありません。</span><span class="sxs-lookup"><span data-stu-id="86358-127">Gateways can perform a number of different functions, and you may not need all of them.</span></span> <span data-ttu-id="86358-128">機能は、次のデザイン パターンに分類できます。</span><span class="sxs-lookup"><span data-stu-id="86358-128">The functions can be grouped into the following design patterns:</span></span>

<span data-ttu-id="86358-129">[ゲートウェイ ルーティング](../patterns/gateway-routing.md)。</span><span class="sxs-lookup"><span data-stu-id="86358-129">[Gateway Routing](../patterns/gateway-routing.md).</span></span> <span data-ttu-id="86358-130">第 7 層のルーティングを使用して、1 つ以上のバックエンド サービスに要求をルーティングするリバース プロキシとしてゲートウェイを使用します。</span><span class="sxs-lookup"><span data-stu-id="86358-130">Use the gateway as a reverse proxy to route requests to one or more backend services, using layer 7 routing.</span></span> <span data-ttu-id="86358-131">ゲートウェイは、クライアントに単一のエンドポイントを提供し、サービスからクライアントを分離するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="86358-131">The gateway provides a single endpoint for clients, and helps to decouple clients from services.</span></span> 

<span data-ttu-id="86358-132">[ゲートウェイ集約](../patterns/gateway-aggregation.md)。</span><span class="sxs-lookup"><span data-stu-id="86358-132">[Gateway Aggregation](../patterns/gateway-aggregation.md).</span></span> <span data-ttu-id="86358-133">ゲートウェイを使用して、複数の個々の要求を 1 つの要求に集約します。</span><span class="sxs-lookup"><span data-stu-id="86358-133">Use the gateway to aggregate multiple individual requests into a single request.</span></span> <span data-ttu-id="86358-134">このパターンは、単一の操作で複数のバックエンド サービスを呼び出す必要がある場合に適用されます。</span><span class="sxs-lookup"><span data-stu-id="86358-134">This pattern applies when a single operation requires calls to multiple backend services.</span></span> <span data-ttu-id="86358-135">クライアントは、1 つの要求をゲートウェイに送信します。</span><span class="sxs-lookup"><span data-stu-id="86358-135">The client sends one request to the gateway.</span></span> <span data-ttu-id="86358-136">ゲートウェイはさまざまなバックエンド サービスに要求をディスパッチし、結果を集計し、それらをクライアントに送り返します。</span><span class="sxs-lookup"><span data-stu-id="86358-136">The gateway dispatches requests to the various backend services, and then aggregates the results and sends them back to the client.</span></span> <span data-ttu-id="86358-137">これにより、クライアントとバックエンド間の頻繁な通信を削減できます。</span><span class="sxs-lookup"><span data-stu-id="86358-137">This helps to reduce chattiness between the client and the backend.</span></span> 

<span data-ttu-id="86358-138">[ゲートウェイ オフロード](../patterns/gateway-offloading.md)。</span><span class="sxs-lookup"><span data-stu-id="86358-138">[Gateway Offloading](../patterns/gateway-offloading.md).</span></span> <span data-ttu-id="86358-139">ゲートウェイを使用して、個々 のサービスからゲートウェイに機能をオフロードします。これは特に横断的問題に適用します。</span><span class="sxs-lookup"><span data-stu-id="86358-139">Use the gateway to offload functionality from individual services to the gateway, particularly cross-cutting concerns.</span></span> <span data-ttu-id="86358-140">すべてのサービスに機能を実装する責任を負わせるよりも、機能を 1 か所に統合するほうが有用である可能性があります。</span><span class="sxs-lookup"><span data-stu-id="86358-140">It can be useful to consolidate these functions into one place, rather than making every service responsible for implementing them.</span></span> <span data-ttu-id="86358-141">これは、認証や承認など、正しく実装するには専門的な技能を必要とする機能に特に当てはまります。</span><span class="sxs-lookup"><span data-stu-id="86358-141">This is particularly true for features that requires specialized skills to implement correctly, such as authentication and authorization.</span></span> 

<span data-ttu-id="86358-142">ゲートウェイにオフロードすることができる機能のいくつかの例を次に示します。</span><span class="sxs-lookup"><span data-stu-id="86358-142">Here are some examples of functionality that could be offloaded to a gateway:</span></span>

- <span data-ttu-id="86358-143">SSL 終了</span><span class="sxs-lookup"><span data-stu-id="86358-143">SSL termination</span></span>
- <span data-ttu-id="86358-144">認証</span><span class="sxs-lookup"><span data-stu-id="86358-144">Authentication</span></span>
- <span data-ttu-id="86358-145">IP ホワイトリスト登録</span><span class="sxs-lookup"><span data-stu-id="86358-145">IP whitelisting</span></span>
- <span data-ttu-id="86358-146">クライアントのレート制限 (調整)</span><span class="sxs-lookup"><span data-stu-id="86358-146">Client rate limiting (throttling)</span></span>
- <span data-ttu-id="86358-147">ログ記録と監視</span><span class="sxs-lookup"><span data-stu-id="86358-147">Logging and monitoring</span></span>
- <span data-ttu-id="86358-148">応答のキャッシュ</span><span class="sxs-lookup"><span data-stu-id="86358-148">Response caching</span></span>
- <span data-ttu-id="86358-149">Web アプリケーション ファイアウォール</span><span class="sxs-lookup"><span data-stu-id="86358-149">Web application firewall</span></span>
- <span data-ttu-id="86358-150">GZIP 圧縮</span><span class="sxs-lookup"><span data-stu-id="86358-150">GZIP compression</span></span>
- <span data-ttu-id="86358-151">静的コンテンツの処理</span><span class="sxs-lookup"><span data-stu-id="86358-151">Servicing static content</span></span>

## <a name="choosing-a-gateway-technology"></a><span data-ttu-id="86358-152">ゲートウェイ テクノロジの選択</span><span class="sxs-lookup"><span data-stu-id="86358-152">Choosing a gateway technology</span></span>

<span data-ttu-id="86358-153">アプリケーションで API ゲートウェイを実装するためのいくつかのオプションを示します。</span><span class="sxs-lookup"><span data-stu-id="86358-153">Here are some options for implementing an API gateway in your application.</span></span>

- <span data-ttu-id="86358-154">**リバース プロキシ サーバー**。</span><span class="sxs-lookup"><span data-stu-id="86358-154">**Reverse proxy server**.</span></span> <span data-ttu-id="86358-155">Nginx と HAProxy は、負荷分散、SSL、第 7 層のルーティングなどの機能をサポートする一般的なリバース プロキシ サーバーです。</span><span class="sxs-lookup"><span data-stu-id="86358-155">Nginx and HAProxy are popular reverse proxy servers that support features such as load balancing, SSL, and layer 7 routing.</span></span> <span data-ttu-id="86358-156">どちらも無料のオープン ソース製品であり、有償エディションで追加機能とサポート オプションが提供されます。</span><span class="sxs-lookup"><span data-stu-id="86358-156">They are both free, open-source products, with paid editions that provide additional features and support options.</span></span> <span data-ttu-id="86358-157">Nginx と HAProxy は、どちらも豊富な機能セットと高パフォーマンスを備えた完成度の高い製品です。</span><span class="sxs-lookup"><span data-stu-id="86358-157">Nginx and HAProxy are both mature products with rich feature sets and high performance.</span></span> <span data-ttu-id="86358-158">サードパーティ モジュールの使用や Lua でのカスタム スクリプトの記述によって、それらを拡張できます。</span><span class="sxs-lookup"><span data-stu-id="86358-158">You can extend them with third-party modules or by writing custom scripts in Lua.</span></span> <span data-ttu-id="86358-159">Nginx では、NginScript と呼ばれる JavaScript ベースのスクリプト モジュールもサポートしています。</span><span class="sxs-lookup"><span data-stu-id="86358-159">Nginx also supports a JavaScript-based scripting module called NginScript.</span></span>

- <span data-ttu-id="86358-160">**サービス メッシュ イングレス コントローラー**。</span><span class="sxs-lookup"><span data-stu-id="86358-160">**Service mesh ingress controller**.</span></span> <span data-ttu-id="86358-161">linkerd や Istio などのサービス メッシュを使用している場合は、そのサービス メッシュのイングレス コントローラーによって提供される機能を検討します。</span><span class="sxs-lookup"><span data-stu-id="86358-161">If you are using a service mesh such as linkerd or Istio, consider the features that are provided by the ingress controller for that service mesh.</span></span> <span data-ttu-id="86358-162">たとえば、Istio イングレス コントローラーは、第 7 層のルーティング、HTTP リダイレクト、再試行、およびその他の機能をサポートしています。</span><span class="sxs-lookup"><span data-stu-id="86358-162">For example, the Istio ingress controller supports layer 7 routing, HTTP redirects, retries, and other features.</span></span> 

- <span data-ttu-id="86358-163">[Azure Application Gateway](/azure/application-gateway/)。</span><span class="sxs-lookup"><span data-stu-id="86358-163">[Azure Application Gateway](/azure/application-gateway/).</span></span> <span data-ttu-id="86358-164">Application Gateway は、第 7 層のルーティングと SSL 終了を実行できる負荷分散管理対象サービスです。</span><span class="sxs-lookup"><span data-stu-id="86358-164">Application Gateway is a managed load balancing service that can perform layer-7 routing and SSL termination.</span></span> <span data-ttu-id="86358-165">Web アプリケーション ファイアウォール (WAF) も提供します。</span><span class="sxs-lookup"><span data-stu-id="86358-165">It also provides a web application firewall (WAF).</span></span>

- <span data-ttu-id="86358-166">[Azure API Management](/azure/api-management/)。</span><span class="sxs-lookup"><span data-stu-id="86358-166">[Azure API Management](/azure/api-management/).</span></span> <span data-ttu-id="86358-167">API Management は、API を外部顧客と内部顧客に公開するためのターンキー ソリューションです。</span><span class="sxs-lookup"><span data-stu-id="86358-167">API Management is a turnkey solution for publishing APIs to external and internal customers.</span></span> <span data-ttu-id="86358-168">公開 API を管理するために役立つ機能 (レート制限、IP ホワイトリスト登録、Azure Active Directory やその他の ID プロバイダーを使用した認証など) を提供します。</span><span class="sxs-lookup"><span data-stu-id="86358-168">It provides features that are useful for managing a public-facing API, including rate limiting, IP white listing, and authentication using Azure Active Directory or other identity providers.</span></span> <span data-ttu-id="86358-169">API Management は負荷分散を実行しないため、Application Gateway やリバース プロキシなどのロード バランサーと組み合わせて使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="86358-169">API Management doesn't perform any load balancing, so it should be used in conjunction with a load balancer such as Application Gateway or a reverse proxy.</span></span>

<span data-ttu-id="86358-170">ゲートウェイ テクノロジを選択するときは、以下を考慮してください。</span><span class="sxs-lookup"><span data-stu-id="86358-170">When choosing a gateway technology, consider the following:</span></span>

<span data-ttu-id="86358-171">**機能**。</span><span class="sxs-lookup"><span data-stu-id="86358-171">**Features**.</span></span> <span data-ttu-id="86358-172">上記のオプションはすべてが第 7 層のルーティングをサポートしますが、その他の機能に対するサポートは異なっています。</span><span class="sxs-lookup"><span data-stu-id="86358-172">The options listed above all support layer 7 routing, but support for other features will vary.</span></span> <span data-ttu-id="86358-173">必要な機能に応じて、複数のゲートウェイをデプロイできます。</span><span class="sxs-lookup"><span data-stu-id="86358-173">Depending on the features that you need, you might deploy more than one gateway.</span></span> 

<span data-ttu-id="86358-174">**デプロイ**。</span><span class="sxs-lookup"><span data-stu-id="86358-174">**Deployment**.</span></span> <span data-ttu-id="86358-175">Azure Application Gateway と API Management は管理対象サービスです。</span><span class="sxs-lookup"><span data-stu-id="86358-175">Azure Application Gateway and API Management are managed services.</span></span> <span data-ttu-id="86358-176">Nginx と HAProxy は通常、クラスター内のコンテナーで実行されますが、クラスター外の専用 VM にデプロイすることもできます。</span><span class="sxs-lookup"><span data-stu-id="86358-176">Nginx and HAProxy will typically run in containers inside the cluster, but can also be deployed to dedicated VMs outside of the cluster.</span></span> <span data-ttu-id="86358-177">これを行うと、ゲートウェイはワークロードの残りの部分から分離されますが、高い管理オーバーヘッドが発生します。</span><span class="sxs-lookup"><span data-stu-id="86358-177">This isolates the gateway from the rest of the workload, but incurs higher management overhead.</span></span>

<span data-ttu-id="86358-178">**管理**。</span><span class="sxs-lookup"><span data-stu-id="86358-178">**Management**.</span></span> <span data-ttu-id="86358-179">サービスが更新されたり、新しいサービスが追加されたりした場合、ゲートウェイのルーティング規則の更新が必要になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="86358-179">When services are updated or new services are added, the gateway routing rules may need to be updated.</span></span> <span data-ttu-id="86358-180">このプロセスを管理する方法を検討してください。</span><span class="sxs-lookup"><span data-stu-id="86358-180">Consider how this process will be managed.</span></span> <span data-ttu-id="86358-181">類似の検討が、SSL 証明書、IP ホワイトリスト登録、および構成の他の側面の管理にも適用されます。</span><span class="sxs-lookup"><span data-stu-id="86358-181">Similar considerations apply to managing SSL certificates, IP whitelists, and other aspects of configuration.</span></span>

## <a name="deployment-considerations"></a><span data-ttu-id="86358-182">デプロイに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="86358-182">Deployment considerations</span></span>

### <a name="deploying-nginx-or-haproxy-to-kubernetes"></a><span data-ttu-id="86358-183">Nginx または HAProxy の Kubernetes へのデプロイ</span><span class="sxs-lookup"><span data-stu-id="86358-183">Deploying Nginx or HAProxy to Kubernetes</span></span>

<span data-ttu-id="86358-184">Nginx または HAProxy は、Nginx または HAProxy コンテナー イメージを指定する [ReplicaSet](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/) または [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) として Kubernetes に デプロイできます。</span><span class="sxs-lookup"><span data-stu-id="86358-184">You can deploy Nginx or HAProxy to Kubernetes as a [ReplicaSet](https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/) or [DaemonSet](https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/) that specifies the Nginx or HAProxy container image.</span></span> <span data-ttu-id="86358-185">ConfigMap を使用してプロキシの構成ファイルを格納し、ConfigMap をボリュームとしてマウントします。</span><span class="sxs-lookup"><span data-stu-id="86358-185">Use a ConfigMap to store the configuration file for the proxy, and mount the ConfigMap as a volume.</span></span> <span data-ttu-id="86358-186">LoadBalancer という種類のサービスを作成し、Azure Load Balancer 経由でゲートウェイを公開します。</span><span class="sxs-lookup"><span data-stu-id="86358-186">Create a service of type LoadBalancer to expose the gateway through an Azure Load Balancer.</span></span> 

<!-- - Configure a readiness probe that serves a static file from the gateway (rather than routing to another service). -->

<span data-ttu-id="86358-187">別の方法は、Ingress Controller の作成です。</span><span class="sxs-lookup"><span data-stu-id="86358-187">An alternative is to create an Ingress Controller.</span></span> <span data-ttu-id="86358-188">Ingress Controller は、ロード バランサーまたはリバース プロキシ サーバーをデプロイする Kubernetes リソースです。</span><span class="sxs-lookup"><span data-stu-id="86358-188">An Ingress Controller is a Kubernetes resource that deploys a load balancer or reverse proxy server.</span></span> <span data-ttu-id="86358-189">Nginx と HAProxy を含むさまざまな実装が存在します。</span><span class="sxs-lookup"><span data-stu-id="86358-189">Several implementations exist, including Nginx and HAProxy.</span></span> <span data-ttu-id="86358-190">Ingress と呼ばれる別のリソースが、Ingress Controller のルーティング規則や TLS 証明書などの設定を定義します。</span><span class="sxs-lookup"><span data-stu-id="86358-190">A separate resource called an Ingress defines settings for the Ingress Controller, such as routing rules and TLS certificates.</span></span> <span data-ttu-id="86358-191">つまり、特定のプロキシ サーバー テクノロジに固有の複雑な構成ファイルを管理する必要はありません。</span><span class="sxs-lookup"><span data-stu-id="86358-191">That way, you don't need to manage complex configuration files that are specific to a particular proxy server technology.</span></span> <span data-ttu-id="86358-192">この記事の執筆時点では、Ingress Controller はまだ Kubernetes のベータ機能であり、今後も進化し続けるでしょう。</span><span class="sxs-lookup"><span data-stu-id="86358-192">Ingress Controllers are still a beta feature of Kubernetes at the time of this writing, and the feature will continue to evolve.</span></span>

<span data-ttu-id="86358-193">ゲートウェイは、システム内の潜在的なボトルネックまたは単一障害点であるため、高可用性のためには、常に少なくとも 2 つのレプリカをデプロイします。</span><span class="sxs-lookup"><span data-stu-id="86358-193">The gateway is a potential bottleneck or single point of failure in the system, so always deploy at least two replicas for high availability.</span></span> <span data-ttu-id="86358-194">負荷に応じて、レプリカをさらにスケールアウトしなければならない場合があります。</span><span class="sxs-lookup"><span data-stu-id="86358-194">You may need to scale out the replicas further, depending on the load.</span></span> 

<span data-ttu-id="86358-195">また、ゲートウェイをクラスター内の専用ノード セットで実行することを検討します。</span><span class="sxs-lookup"><span data-stu-id="86358-195">Also consider running the gateway on a dedicated set of nodes in the cluster.</span></span> <span data-ttu-id="86358-196">この方法には次のような利点があります。</span><span class="sxs-lookup"><span data-stu-id="86358-196">Benefits to this approach include:</span></span>

- <span data-ttu-id="86358-197">分離。</span><span class="sxs-lookup"><span data-stu-id="86358-197">Isolation.</span></span> <span data-ttu-id="86358-198">すべての着信トラフィックは、バックエンド サービスから分離できるノードの固定セットに送信されます。</span><span class="sxs-lookup"><span data-stu-id="86358-198">All inbound traffic goes to a fixed set of nodes, which can be isolated from backend services.</span></span>

- <span data-ttu-id="86358-199">安定した構成。</span><span class="sxs-lookup"><span data-stu-id="86358-199">Stable configuration.</span></span> <span data-ttu-id="86358-200">ゲートウェイが正しく構成されていない場合、アプリケーション全体が使用できなくなる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="86358-200">If the gateway is misconfigured, the entire application may become unavailable.</span></span> 

- <span data-ttu-id="86358-201">パフォーマンス。</span><span class="sxs-lookup"><span data-stu-id="86358-201">Performance.</span></span> <span data-ttu-id="86358-202">パフォーマンス上の理由から、ゲートウェイ用の特定の VM 構成を使用できます。</span><span class="sxs-lookup"><span data-stu-id="86358-202">You may want to use a specific VM configuration for the gateway for performance reasons.</span></span>

<!-- - Load balancing. You can configure the external load balancer so that requests always go to a gateway node. That can save a network hop, which would otherwise happen whenever a request lands on a node that isn't running a gateway pod. This consideration applies mainly to large clusters, where the gateway runs on a relatively small fraction of the total nodes. In Azure Container Service (ACS), this approach currently requires [ACS Engine](https://github.com/Azure/acs-engine)) which allows you to create multiple agent pools. Then you can deploy the gateway as a DaemonSet to the front-end pool. -->

### <a name="azure-application-gateway"></a><span data-ttu-id="86358-203">Azure Application Gateway</span><span class="sxs-lookup"><span data-stu-id="86358-203">Azure Application Gateway</span></span>

<span data-ttu-id="86358-204">Azure で Application Gateway を Kubernetes クラスターに接続するには:</span><span class="sxs-lookup"><span data-stu-id="86358-204">To connect Application Gateway to a Kubernetes cluster in Azure:</span></span>

1. <span data-ttu-id="86358-205">クラスター VNet に空のサブネットを作成します。</span><span class="sxs-lookup"><span data-stu-id="86358-205">Create an empty subnet in the cluster VNet.</span></span>
2. <span data-ttu-id="86358-206">Application Gateway をデプロイします。</span><span class="sxs-lookup"><span data-stu-id="86358-206">Deploy Application Gateway.</span></span>
3. <span data-ttu-id="86358-207">Kubernetes サービスを type=[NodePort](https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport) で作成します。</span><span class="sxs-lookup"><span data-stu-id="86358-207">Create a Kubernetes service with type=[NodePort](https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport).</span></span> <span data-ttu-id="86358-208">これで、各ノードのサービスが公開され、クラスターの外部からアクセスできるようになります。</span><span class="sxs-lookup"><span data-stu-id="86358-208">This exposes the service on each node so that it can be reached from outside the cluster.</span></span> <span data-ttu-id="86358-209">ロード バランサーは作成されません。</span><span class="sxs-lookup"><span data-stu-id="86358-209">It does not create a load balancer.</span></span>
5. <span data-ttu-id="86358-210">サービスに割り当てられたポート番号を取得します。</span><span class="sxs-lookup"><span data-stu-id="86358-210">Get the assigned port number for the service.</span></span>
6. <span data-ttu-id="86358-211">次の内容の Application Gateway 規則を追加します。</span><span class="sxs-lookup"><span data-stu-id="86358-211">Add an Application Gateway rule where:</span></span>
    - <span data-ttu-id="86358-212">バックエンド プールにエージェント VM が含まれる。</span><span class="sxs-lookup"><span data-stu-id="86358-212">The backend pool contains the agent VMs.</span></span>
    - <span data-ttu-id="86358-213">HTTP 設定で、サービスのポート番号が指定される。</span><span class="sxs-lookup"><span data-stu-id="86358-213">The HTTP setting specifies the service port number.</span></span>
    - <span data-ttu-id="86358-214">ゲートウェイ リスナーはポート 80/443 でリッスンする。</span><span class="sxs-lookup"><span data-stu-id="86358-214">The gateway listener listens on ports 80/443</span></span>
    
<span data-ttu-id="86358-215">高可用性のために、2 以上のインスタンス数を設定します。</span><span class="sxs-lookup"><span data-stu-id="86358-215">Set the instance count to 2 or more for high availability.</span></span>

### <a name="azure-api-management"></a><span data-ttu-id="86358-216">Azure API Management</span><span class="sxs-lookup"><span data-stu-id="86358-216">Azure API Management</span></span> 

<span data-ttu-id="86358-217">Azure で API Management を Kubernetes クラスターに接続するには:</span><span class="sxs-lookup"><span data-stu-id="86358-217">To connect API Management to a Kubernetes cluster in Azure:</span></span>

1. <span data-ttu-id="86358-218">クラスター VNet に空のサブネットを作成します。</span><span class="sxs-lookup"><span data-stu-id="86358-218">Create an empty subnet in the cluster VNet.</span></span>
2. <span data-ttu-id="86358-219">API Management をそのサブネットにデプロイします。</span><span class="sxs-lookup"><span data-stu-id="86358-219">Deploy API Management to that subnet.</span></span>
3. <span data-ttu-id="86358-220">LoadBalancer という種類の Kubernetes サービスを作成します。</span><span class="sxs-lookup"><span data-stu-id="86358-220">Create a Kubernetes service of type LoadBalancer.</span></span> <span data-ttu-id="86358-221">既定のインターネットに接続するロード バランサーではなく、[内部ロード バランサー](https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer)の注釈を使用して内部ロード バランサーを作成します。</span><span class="sxs-lookup"><span data-stu-id="86358-221">Use the [internal load balancer](https://kubernetes.io/docs/concepts/services-networking/service/#internal-load-balancer) annotation to create an internal load balancer, instead of an Internet-facing load balancer, which is the default.</span></span>
4. <span data-ttu-id="86358-222">kubectl または Azure CLI を使用して、内部ロード バランサーのプライベート IP を検索します。</span><span class="sxs-lookup"><span data-stu-id="86358-222">Find the private IP of the internal load balancer, using kubectl or the Azure CLI.</span></span>
5. <span data-ttu-id="86358-223">API Management を使用して、ロード バランサーの IP アドレスにアクセスする API を作成します。</span><span class="sxs-lookup"><span data-stu-id="86358-223">Use API Management to create an API that directs to the private IP address of the load balancer.</span></span>

<span data-ttu-id="86358-224">API Management とリバース プロキシ (Nginx、HAProxy、または Azure Application Gateway) を組み合わせることを検討してください。</span><span class="sxs-lookup"><span data-stu-id="86358-224">Consider combining API Management with a reverse proxy, whether Nginx, HAProxy, or Azure Application Gateway.</span></span> <span data-ttu-id="86358-225">API Management と Application Gateway の使用の詳細については、「[内部 VNET 内の API Management と Application Gateway の統合](/azure/api-management/api-management-howto-integrate-internal-vnet-appgateway)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="86358-225">For information about using API Management with Application Gateway, see [Integrate API Management in an internal VNET with Application Gateway](/azure/api-management/api-management-howto-integrate-internal-vnet-appgateway).</span></span>

> [!div class="nextstepaction"]
> [<span data-ttu-id="86358-226">ログ記録と監視</span><span class="sxs-lookup"><span data-stu-id="86358-226">Logging and monitoring</span></span>](./logging-monitoring.md)
